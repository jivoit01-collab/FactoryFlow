import{u as B,a as v}from"./useMutation-CDDQmGrZ.js";import{H as x,J as g,K as f,z as Y,r as A,j as e,D as F,m as O,n as U,o as K,L as _,I as E,as as V,q as k,B as N}from"./index-Dt2C4nB0.js";import{S as H}from"./SearchableSelect-CBLIZDPT.js";import{u as z,a as J}from"./materialType.queries-C8OMQQH5.js";const C={async getByMaterialType(a){return(await x.get(g.QUALITY_CONTROL_V2.MATERIAL_TYPE_PARAMETERS(a))).data},async getById(a){return(await x.get(g.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a))).data},async create(a,s){return(await x.post(g.QUALITY_CONTROL_V2.MATERIAL_TYPE_PARAMETERS(a),s)).data},async update(a,s){return(await x.put(g.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a),s)).data},async delete(a){await x.delete(g.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a))}},y={all:["qcParameters"],byMaterialType:a=>[...y.all,"byMaterialType",a],detail:a=>[...y.all,"detail",a]};function X(a){return B({queryKey:y.byMaterialType(a),queryFn:()=>C.getByMaterialType(a),enabled:!!a})}function ee(){const a=f();return v({mutationFn:({materialTypeId:s,data:o})=>C.create(s,o),onSuccess:(s,{materialTypeId:o})=>{a.invalidateQueries({queryKey:y.byMaterialType(o)})}})}function ae(){const a=f();return v({mutationFn:({id:s,data:o})=>C.update(s,o),onSuccess:()=>{a.invalidateQueries({queryKey:y.all})}})}function se(){const a=f();return v({mutationFn:s=>C.delete(s),onSuccess:()=>{a.invalidateQueries({queryKey:y.all})}})}function te({value:a,onChange:s,placeholder:o="Select Material Type",disabled:M=!1,error:b,label:P,required:L=!1}){const{hasAnyPermission:R}=Y(),h=R(["quality_control.can_manage_material_types","quality_control.add_materialtype"]),{data:Q=[],isLoading:I,isError:w}=z(),u=J(),[l,T]=A.useState({code:"",name:"",description:""}),[i,m]=A.useState({}),j=()=>{T({code:"",name:"",description:""}),m({})},S=async(t,d)=>{const p={};if(l.code.trim()?/^[A-Z0-9_]+$/.test(l.code)||(p.code="Code must be uppercase letters, numbers, and underscores only"):p.code="Code is required",l.name.trim()||(p.name="Name is required"),Object.keys(p).length>0){m(p);return}try{m({});const r=await u.mutateAsync({code:l.code,name:l.name,description:l.description});t(r.id,r.name),s(r),j(),d(!1)}catch(r){const c=r;if(c.errors){const n={};Object.entries(c.errors).forEach(([q,D])=>{n[q]=D[0]}),m(n)}else m({general:c.message||"Failed to create material type"})}};return e.jsx(H,{value:a?String(a):void 0,items:Q,isLoading:I,isError:w,placeholder:o,disabled:M,error:b,label:P,required:L,inputId:"material-type-select",getItemKey:t=>t.id,getItemLabel:t=>t.name,filterFn:(t,d)=>t.name.toLowerCase().includes(d.toLowerCase())||t.code.toLowerCase().includes(d.toLowerCase()),renderItem:t=>e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:t.name}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",t.code,")"]})]}),loadingText:"Loading...",emptyText:"No material types available",notFoundText:"No material types found",addNewLabel:h?"Add New Material Type":void 0,onItemSelect:t=>{s(t)},onClear:()=>{s(null)},renderCreateDialog:h?(t,d,p)=>e.jsx(F,{open:t,onOpenChange:r=>{r||j(),d(r)},children:e.jsxs(O,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(K,{children:"Add Material Type"})}),i.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:i.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{children:["Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{value:l.code,onChange:r=>{const c=r.target.value.toUpperCase().replace(/\s+/g,"_");T(n=>({...n,code:c})),i.code&&m(n=>({...n,code:""}))},placeholder:"e.g., CAP_BLUE",disabled:u.isPending,className:i.code?"border-destructive focus-visible:ring-destructive":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All caps, no spaces. Use underscores to separate words."}),i.code&&e.jsx("p",{className:"text-sm text-destructive",children:i.code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{value:l.name,onChange:r=>{const c=r.target.value.split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" ");T(n=>({...n,name:c})),i.name&&m(n=>({...n,name:""}))},placeholder:"e.g., Cap Blue Plain",disabled:u.isPending,className:i.name?"border-destructive focus-visible:ring-destructive":""}),i.name&&e.jsx("p",{className:"text-sm text-destructive",children:i.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Description"}),e.jsx(V,{value:l.description,onChange:r=>T(c=>({...c,description:r.target.value})),placeholder:"e.g., Blue plain caps for water bottles",rows:3,disabled:u.isPending})]})]}),e.jsxs(k,{children:[e.jsx(N,{variant:"outline",onClick:()=>d(!1),disabled:u.isPending,children:"Cancel"}),e.jsx(N,{onClick:()=>S(p,d),disabled:u.isPending,children:u.isPending?"Creating...":"Create"})]})]})}):void 0})}export{te as M,ee as a,ae as b,se as c,X as u};
