import{a as b,E as w,r as v,j as e,B as a,_ as P}from"./index-_Sfdy-kJ.js";import{b as S,G as r}from"./status.constants-Dx3nRswF.js";import{a as k}from"./grpo.queries-DuEIYU8o.js";import{A as y}from"./arrow-left-GMhswg_J.js";import{R as x,S as A}from"./shield-x-BF_5sR6j.js";import{C as E}from"./circle-alert-g97mPIxl.js";import"./triangle-alert-DDbvsqNJ.js";import"./circle-x-Dqawni1P.js";import"./circle-check-D0318yXf.js";import"./clock-f8PItCJE.js";import"./useMutation-pgUcGbpY.js";const o={all:{label:"All",filter:()=>!0},pending:{label:"Pending",filter:t=>t.status===r.PENDING},posted:{label:"Posted",filter:t=>t.status===r.POSTED},failed:{label:"Failed",filter:t=>t.status===r.FAILED||t.status===r.PARTIALLY_POSTED}},C=t=>{switch(t){case r.POSTED:return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case r.FAILED:return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case r.PARTIALLY_POSTED:return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400";case r.PENDING:default:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"}},_=t=>{if(!t)return"-";try{return new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t}};function H(){const t=b(),[u,h]=w(),{data:g=[],isLoading:d,refetch:c,error:l}=k(),f=u.get("status")||"all",i=o[f]||o.all,n=v.useMemo(()=>g.filter(i.filter),[g,i]),j=s=>{h(s==="all"?{}:{status:s})},m=l,p=m?.status===403;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(a,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>t("/grpo"),children:e.jsx(y,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Posting History"})]}),e.jsx("p",{className:"text-muted-foreground",children:"View all GRPO postings to SAP"})]}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>c(),className:"w-full sm:w-auto",children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(o).map(s=>e.jsx(a,{variant:f===s?"default":"outline",size:"sm",className:"h-8",onClick:()=>j(s),children:o[s].label},s))}),p&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-destructive/50 bg-destructive/5",children:[e.jsx(A,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permission Denied"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:m?.message||"You do not have permission to view posting history."})]}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>c(),children:e.jsx(x,{className:"h-4 w-4"})})]}),l&&!p&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-yellow-500/50 bg-yellow-50 dark:bg-yellow-900/10",children:[e.jsx(E,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Failed to Load"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:m?.message||"An error occurred while loading posting history."})]}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>c(),children:e.jsx(x,{className:"h-4 w-4"})})]}),d&&e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}),!d&&!l&&n.length===0&&e.jsxs("div",{className:"flex items-center justify-center h-24 text-sm text-muted-foreground border rounded-lg",children:["No ",i.label.toLowerCase()," postings"]}),!d&&!l&&n.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:[i.label," (",n.length,")"]})}),e.jsx("div",{className:"space-y-2",children:n.map(s=>{const N=S[s.status];return e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>t(`/grpo/history/${s.id}`),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s.entry_no}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.po_number}),e.jsx("span",{className:`inline-flex items-center rounded-full px-1.5 py-0.5 text-[10px] font-medium flex-shrink-0 ${C(s.status)}`,children:N?.label||s.status}),s.sap_doc_num&&e.jsxs("span",{className:"text-xs text-muted-foreground hidden md:inline",children:["SAP #",s.sap_doc_num]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:_(s.posted_at||s.created_at)}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]})]},s.id)})})]})]})}export{H as default};
