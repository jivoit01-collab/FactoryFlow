import{r as h,j as e,D as Y,m as J,n as Q,o as Z,p as W,L as C,I as w,J as P,q as X,B as E,M as I,K as B,k as G,Z as ee,_ as se,$ as te,a as ne,z as le,C as M,b as U,c as z,e as K,U as oe}from"./index-BJbr7dGT.js";import{b as $}from"./validation.constants-DHFF3fUR.js";import{u as ce}from"./useScrollToError-ByUJimjt.js";import{e as de,f as me,d as ue,g as pe,h as xe,P as T,i as he}from"./personGateIn.queries-DOxe0tNP.js";import{I as fe,a as H}from"./driver.schema-DO7pkEio.js";import{u as re,C as ae}from"./SearchableSelect-Clq-UFxm.js";import{C as ve}from"./ContractorSelect-CDEHNry8.js";import{P as ie}from"./plus-CkmVnUnI.js";import{A as je}from"./arrow-left-CSneh59K.js";import{C as ge}from"./circle-alert-DDfM1UF8.js";import{U as be}from"./users-BlltWX0P.js";import"./useMutation-B7kknB8H.js";import"./schemas-D8ebsZBL.js";function Ne({open:c,onOpenChange:N,onSuccess:k,defaultContractorId:d}){const[f,s]=h.useState({}),[o,i]=h.useState({name:"",contractor:d||0,mobile:"",id_proof_no:"",skill_type:"",permit_valid_till:""}),u=de();h.useEffect(()=>{c&&(i({name:"",contractor:d||0,mobile:"",id_proof_no:"",skill_type:"",permit_valid_till:""}),s({}))},[c,d]);const n=async r=>{r.preventDefault();const a={};if(o.name.trim()||(a.name="Name is required"),o.contractor||(a.contractor="Contractor is required"),o.mobile?.trim()&&!$.phone.test(o.mobile.trim())&&(a.mobile="Please enter a valid 10-digit phone number"),Object.keys(a).length>0){s(a);return}s({});try{const p=await u.mutateAsync({name:o.name,contractor:o.contractor,mobile:o.mobile||void 0,id_proof_no:o.id_proof_no||void 0,skill_type:o.skill_type||void 0,permit_valid_till:o.permit_valid_till||void 0,is_active:!0});N(!1),k?.(p)}catch(p){const b=p;if(b.errors){const _={};Object.entries(b.errors).forEach(([j,g])=>{Array.isArray(g)&&g.length>0&&(_[j]=g[0])}),s(_)}else s({general:b.message||"Failed to create labour"})}};return e.jsx(Y,{open:c,onOpenChange:N,children:e.jsxs(J,{className:"sm:max-w-[500px]",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Add New Labour"}),e.jsx(W,{children:"Fill in the details to register a new labour."})]}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[f.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:f.general}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"name",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"name",placeholder:"Enter labour name",value:o.name,onChange:r=>i(a=>({...a,name:r.target.value})),disabled:u.isPending,className:f.name?"border-destructive":""}),f.name&&e.jsx("p",{className:"text-sm text-destructive",children:f.name})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(ve,{value:o.contractor?String(o.contractor):void 0,onChange:r=>{i(a=>({...a,contractor:r}))},disabled:u.isPending,label:"Contractor",required:!0,error:f.contractor})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"mobile",children:"Mobile"}),e.jsx(w,{id:"mobile",placeholder:"9876543210",value:o.mobile,onChange:r=>{const a=r.target.value.replace(/[^0-9]/g,"").slice(0,10);i(p=>({...p,mobile:a})),f.mobile&&s(p=>{const b={...p};return delete b.mobile,b})},maxLength:10,disabled:u.isPending,className:P(f.mobile&&"border-destructive")}),f.mobile&&e.jsx("p",{className:"text-sm text-destructive",children:f.mobile})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"skill_type",children:"Skill Type"}),e.jsx(w,{id:"skill_type",placeholder:"e.g., Electrician, Plumber",value:o.skill_type,onChange:r=>i(a=>({...a,skill_type:r.target.value})),disabled:u.isPending})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"id_proof_no",children:"ID Proof Number"}),e.jsx(w,{id:"id_proof_no",placeholder:"ID number",value:o.id_proof_no,onChange:r=>i(a=>({...a,id_proof_no:r.target.value})),disabled:u.isPending})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"permit_valid_till",children:"Permit Valid Till"}),e.jsx(w,{id:"permit_valid_till",type:"date",value:o.permit_valid_till,onChange:r=>i(a=>({...a,permit_valid_till:r.target.value})),disabled:u.isPending})]})]}),e.jsxs(X,{children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:u.isPending,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:u.isPending,children:u.isPending?"Creating...":"Create Labour"})]})]})]})})}function _e({open:c,onOpenChange:N,onSuccess:k}){const[d,f]=h.useState({}),[s,o]=h.useState({name:"",mobile:"",company_name:"",id_proof_type:"",id_proof_no:""}),i=me();h.useEffect(()=>{c&&(o({name:"",mobile:"",company_name:"",id_proof_type:"",id_proof_no:""}),f({}))},[c]);const u=async n=>{n.preventDefault();const r={};if(s.name.trim()||(r.name="Name is required"),s.mobile?.trim()&&!$.phone.test(s.mobile.trim())&&(r.mobile="Please enter a valid 10-digit phone number"),s.id_proof_type&&s.id_proof_no?.trim()){const a=s.id_proof_type,p=H[a];p?.pattern&&!p.pattern.test(s.id_proof_no.trim().toUpperCase())&&(r.id_proof_no=p.message)}if(Object.keys(r).length>0){f(r);return}f({});try{const a=await i.mutateAsync({name:s.name,mobile:s.mobile||void 0,company_name:s.company_name||void 0,id_proof_type:s.id_proof_type||void 0,id_proof_no:s.id_proof_no||void 0});N(!1),k?.(a)}catch(a){const p=a;if(p.errors){const b={};Object.entries(p.errors).forEach(([_,j])=>{Array.isArray(j)&&j.length>0&&(b[_]=j[0])}),f(b)}else f({general:p.message||"Failed to create visitor"})}};return e.jsx(Y,{open:c,onOpenChange:N,children:e.jsxs(J,{className:"sm:max-w-[500px]",children:[e.jsxs(Q,{children:[e.jsx(Z,{children:"Add New Visitor"}),e.jsx(W,{children:"Fill in the details to register a new visitor."})]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[d.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:d.general}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"name",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"name",placeholder:"Enter visitor name",value:s.name,onChange:n=>o(r=>({...r,name:n.target.value})),disabled:i.isPending,className:d.name?"border-destructive":""}),d.name&&e.jsx("p",{className:"text-sm text-destructive",children:d.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"mobile",children:"Mobile"}),e.jsx(w,{id:"mobile",placeholder:"9876543210",value:s.mobile,onChange:n=>{const r=n.target.value.replace(/[^0-9]/g,"").slice(0,10);o(a=>({...a,mobile:r})),d.mobile&&f(a=>{const p={...a};return delete p.mobile,p})},maxLength:10,disabled:i.isPending,className:P(d.mobile&&"border-destructive")}),d.mobile&&e.jsx("p",{className:"text-sm text-destructive",children:d.mobile})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"company_name",children:"Company"}),e.jsx(w,{id:"company_name",placeholder:"Company name",value:s.company_name,onChange:n=>o(r=>({...r,company_name:n.target.value})),disabled:i.isPending})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"id_proof_type",children:"ID Proof Type"}),e.jsxs("select",{id:"id_proof_type",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:s.id_proof_type,onChange:n=>{o(r=>({...r,id_proof_type:n.target.value,id_proof_no:""})),d.id_proof_no&&f(r=>{const a={...r};return delete a.id_proof_no,a})},disabled:i.isPending,children:[e.jsx("option",{value:"",children:"Select type"}),fe.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"id_proof_no",children:"ID Proof Number"}),e.jsx(w,{id:"id_proof_no",placeholder:H[s.id_proof_type]?.placeholder||"ID number",value:s.id_proof_no,onChange:n=>{let r=n.target.value;s.id_proof_type==="Aadhar"?r=r.replace(/[^0-9]/g,"").slice(0,12):(s.id_proof_type==="PAN Card"||s.id_proof_type==="Voter ID")&&(r=r.toUpperCase()),o(a=>({...a,id_proof_no:r})),d.id_proof_no&&f(a=>{const p={...a};return delete p.id_proof_no,p})},maxLength:s.id_proof_type==="Aadhar"?12:s.id_proof_type==="PAN Card"||s.id_proof_type==="Voter ID"?10:50,disabled:i.isPending||!s.id_proof_type,className:P(d.id_proof_no&&"border-destructive")}),d.id_proof_no&&e.jsx("p",{className:"text-sm text-destructive",children:d.id_proof_no})]})]}),e.jsxs(X,{children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:i.isPending,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:i.isPending,children:i.isPending?"Creating...":"Create Visitor"})]})]})]})})}function ye({value:c,onChange:N,placeholder:k="Select gate",disabled:d=!1,error:f,label:s,required:o=!1}){const[i,u]=h.useState(!1),[n,r]=h.useState(""),a=h.useRef(null),p=h.useRef(null),{data:b=[],isLoading:_}=ue(i&&!d),j=b.filter(t=>t.is_active);h.useEffect(()=>{if(c&&b.length>0){const t=b.find(y=>y.id===c);t&&r(t.location?`${t.name} (${t.location})`:t.name)}else c||r("")},[c,b]),h.useEffect(()=>{const t=y=>{a.current&&!a.current.contains(y.target)&&u(!1)};if(i)return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[i]);const g=t=>{r(t.location?`${t.name} (${t.location})`:t.name),N(t),u(!1)},m=()=>{d||u(!i)},v=t=>{t.key==="Escape"?u(!1):(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),u(!i))};return e.jsxs("div",{className:"space-y-2",children:[s&&e.jsxs(C,{htmlFor:"gate-select",children:[s," ",o&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{ref:a,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:p,id:"gate-select",type:"text",value:n,onClick:m,onKeyDown:v,placeholder:k,disabled:d,readOnly:!0,className:P("pr-10 cursor-pointer",f&&"border-destructive focus-visible:ring-destructive")}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:_?e.jsx(I,{className:"h-4 w-4 animate-spin text-muted-foreground"}):e.jsx(B,{className:P("h-4 w-4 text-muted-foreground transition-transform",i&&"rotate-180")})})]}),i&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-60 overflow-auto",children:_?e.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground",children:[e.jsx(I,{className:"h-4 w-4 animate-spin mx-auto mb-2"}),"Loading gates..."]}):j.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No gates available"}):e.jsx("ul",{className:"py-1",children:j.map(t=>e.jsxs("li",{className:P("px-3 py-2 cursor-pointer hover:bg-accent hover:text-accent-foreground flex items-center justify-between",c===t.id&&"bg-accent"),onClick:()=>g(t),children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:t.name}),t.location&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",t.location,")"]})]}),c===t.id&&e.jsx(G,{className:"h-4 w-4 text-primary"})]},t.id))})})]}),f&&e.jsx("p",{className:"text-sm text-destructive",children:f})]})}function Ce({value:c,onChange:N,contractorId:k,placeholder:d="Select labour",disabled:f=!1,error:s,label:o,required:i=!1}){const[u,n]=h.useState(!1),[r,a]=h.useState(!1),[p,b]=h.useState(""),[_,j]=h.useState(""),[g,m]=h.useState(null),v=h.useRef(null),t=h.useRef(null),y=re(p,150),{data:D=[],isLoading:S}=pe(y||void 0,k,u&&!f),L=D.filter(l=>l.is_active);h.useEffect(()=>{if(c&&D.length>0){const l=D.find(A=>A.id===c);l&&(j(l.name),m(l))}else c||(j(""),b(""),m(null))},[c,D]),h.useEffect(()=>{const l=A=>{v.current&&!v.current.contains(A.target)&&(n(!1),c&&b(""))};if(u)return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[u,c]);const V=l=>{j(l.name),b(""),m(l),N(l),n(!1)},F=()=>{f||n(!0)},O=l=>{const A=l.target.value;b(A),j(A),n(!0),A||(N(null),m(null))},R=l=>{l.key==="Escape"?n(!1):l.key==="Enter"&&L.length===1&&V(L[0])},q=l=>{l.stopPropagation(),n(!1),a(!0)},x=l=>{j(l.name),m(l),N(l)};return e.jsxs("div",{className:"space-y-2",children:[o&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(C,{htmlFor:"labour-select",children:[o," ",i&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full text-muted-foreground hover:text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onClick:l=>l.stopPropagation(),children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsx(te,{className:"w-80",align:"start",children:g?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.name})]}),g.contractor_name&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Contractor:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.contractor_name})]}),g.mobile&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Mobile:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.mobile})]}),g.skill_type&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Skill Type:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.skill_type})]}),g.id_proof_no&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID Proof Number:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.id_proof_no})]}),g.permit_valid_till&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Permit Valid Till:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.permit_valid_till})]})]})}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Please select a labour to view details."})})]})]}),e.jsxs("div",{ref:v,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:t,id:"labour-select",type:"text",value:p||_,onChange:O,onFocus:F,onKeyDown:R,placeholder:d,disabled:f,className:P("pr-10 cursor-text",s&&"border-destructive focus-visible:ring-destructive"),autoComplete:"off"}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:S?e.jsx(I,{className:"h-4 w-4 animate-spin text-muted-foreground"}):e.jsx(B,{className:P("h-4 w-4 text-muted-foreground transition-transform",u&&"rotate-180")})})]}),u&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-60 overflow-auto",children:S?e.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground",children:[e.jsx(I,{className:"h-4 w-4 animate-spin mx-auto mb-2"}),"Loading labours..."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 border-b",children:e.jsxs(E,{type:"button",variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:q,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Add New Labour"]})}),L.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:p?"No labours found":"Type to search labours"}):e.jsx("ul",{className:"py-1",children:L.map(l=>e.jsxs("li",{className:P("px-3 py-2 cursor-pointer hover:bg-accent hover:text-accent-foreground flex items-center justify-between",c===l.id&&"bg-accent"),onClick:()=>V(l),children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:l.name}),l.skill_type&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",l.skill_type,")"]})]}),c===l.id&&e.jsx(G,{className:"h-4 w-4 text-primary"})]},l.id))})]})})]}),s&&e.jsx("p",{className:"text-sm text-destructive",children:s}),e.jsx(Ne,{open:r,onOpenChange:a,onSuccess:x,defaultContractorId:k})]})}function we({value:c,onChange:N,placeholder:k="Select visitor",disabled:d=!1,error:f,label:s,required:o=!1}){const[i,u]=h.useState(!1),[n,r]=h.useState(!1),[a,p]=h.useState(""),[b,_]=h.useState(""),[j,g]=h.useState(null),m=h.useRef(null),v=h.useRef(null),t=re(a,150),{data:y=[],isLoading:D}=xe(t||void 0,i&&!d),S=y.filter(x=>!x.blacklisted);h.useEffect(()=>{if(c&&y.length>0){const x=y.find(l=>l.id===c);x&&(_(x.name),g(x))}else c||(_(""),p(""),g(null))},[c,y]),h.useEffect(()=>{const x=l=>{m.current&&!m.current.contains(l.target)&&(u(!1),c&&p(""))};if(i)return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[i,c]);const L=x=>{_(x.name),p(""),g(x),N(x),u(!1)},V=()=>{d||u(!0)},F=x=>{const l=x.target.value;p(l),_(l),u(!0),l||(N(null),g(null))},O=x=>{x.key==="Escape"?u(!1):x.key==="Enter"&&S.length===1&&L(S[0])},R=x=>{x.stopPropagation(),u(!1),r(!0)},q=x=>{_(x.name),g(x),N(x)};return e.jsxs("div",{className:"space-y-2",children:[s&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(C,{htmlFor:"visitor-select",children:[s," ",o&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full text-muted-foreground hover:text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onClick:x=>x.stopPropagation(),children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsx(te,{className:"w-80",align:"start",children:j?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",e.jsx("span",{className:"text-muted-foreground",children:j.name})]}),j.mobile&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Mobile:"})," ",e.jsx("span",{className:"text-muted-foreground",children:j.mobile})]}),j.company_name&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Company:"})," ",e.jsx("span",{className:"text-muted-foreground",children:j.company_name})]}),j.id_proof_type&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID Proof Type:"})," ",e.jsx("span",{className:"text-muted-foreground",children:j.id_proof_type})]}),j.id_proof_no&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID Proof Number:"})," ",e.jsx("span",{className:"text-muted-foreground",children:j.id_proof_no})]})]})}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Please select a visitor to view details."})})]})]}),e.jsxs("div",{ref:m,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:v,id:"visitor-select",type:"text",value:a||b,onChange:F,onFocus:V,onKeyDown:O,placeholder:k,disabled:d,className:P("pr-10 cursor-text",f&&"border-destructive focus-visible:ring-destructive"),autoComplete:"off"}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:D?e.jsx(I,{className:"h-4 w-4 animate-spin text-muted-foreground"}):e.jsx(B,{className:P("h-4 w-4 text-muted-foreground transition-transform",i&&"rotate-180")})})]}),i&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-60 overflow-auto",children:D?e.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground",children:[e.jsx(I,{className:"h-4 w-4 animate-spin mx-auto mb-2"}),"Loading visitors..."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 border-b",children:e.jsxs(E,{type:"button",variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:R,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Add New Visitor"]})}),S.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:a?"No visitors found":"Type to search visitors"}):e.jsx("ul",{className:"py-1",children:S.map(x=>e.jsxs("li",{className:P("px-3 py-2 cursor-pointer hover:bg-accent hover:text-accent-foreground flex items-center justify-between",c===x.id&&"bg-accent"),onClick:()=>L(x),children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:x.name}),x.company_name&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",x.company_name,")"]})]}),c===x.id&&e.jsx(G,{className:"h-4 w-4 text-primary"})]},x.id))})]})})]}),f&&e.jsx("p",{className:"text-sm text-destructive",children:f}),e.jsx(_e,{open:n,onOpenChange:r,onSuccess:q})]})}function qe(){const c=ne(),[N]=le(),k=N.get("type"),[d,f]=h.useState(k||"visitor"),[s,o]=h.useState({person_type:k==="labour"?T.LABOUR:T.VISITOR,visitor:null,labour:null,gate_in:null,purpose:"",vehicle_no:"",remarks:""}),[i,u]=h.useState(null),[n,r]=h.useState({});ce(n);const a=he(),p=m=>{f(m),u(null),o(v=>({...v,person_type:m==="labour"?T.LABOUR:T.VISITOR,visitor:null,labour:null})),r({})},b=m=>{u(m),o(v=>({...v,visitor:m?.id||null,labour:null})),n.visitor&&r(v=>{const t={...v};return delete t.visitor,t})},_=m=>{u(m),o(v=>({...v,labour:m?.id||null,visitor:null})),n.labour&&r(v=>{const t={...v};return delete t.labour,t})},j=m=>{o(v=>({...v,gate_in:m?.id||null})),n.gate_in&&r(v=>{const t={...v};return delete t.gate_in,t})},g=async()=>{const m={};if(s.person_type||(m.person_type="Person type is required"),s.gate_in||(m.gate_in="Gate is required"),d==="visitor"&&!s.visitor&&(m.visitor="Please select a visitor"),d==="labour"&&!s.labour&&(m.labour="Please select a labour"),s.vehicle_no.trim()&&!$.vehicleNumber.test(s.vehicle_no.trim().toUpperCase())&&(m.vehicle_no="Please enter a valid vehicle number (e.g., MH12AB1234)"),Object.keys(m).length>0){r(m);return}try{const v={person_type:s.person_type,gate_in:s.gate_in,purpose:s.purpose||void 0,vehicle_no:s.vehicle_no||void 0,remarks:s.remarks||void 0};d==="visitor"?v.visitor=s.visitor:v.labour=s.labour;const t=await a.mutateAsync(v);c(`/gate/visitor-labour/entry/${t.id}`)}catch(v){const t=v,y={};t.errors&&Object.entries(t.errors).forEach(([D,S])=>{Array.isArray(S)&&S.length>0&&(y[D]=S[0])}),t.message&&(y.general=t.message),r(y)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>c("/gate/visitor-labour"),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"New Entry"}),e.jsx("p",{className:"text-muted-foreground",children:"Create a new gate entry for visitor or labour"})]})]}),n.general&&e.jsx("div",{className:"rounded-lg border border-destructive/50 bg-destructive/10 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-5 w-5 text-destructive flex-shrink-0"}),e.jsx("p",{className:"text-sm font-medium text-destructive",children:n.general})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{children:[e.jsx(U,{className:"pb-3",children:e.jsx(z,{className:"text-base",children:"Person Type"})}),e.jsx(K,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:d==="visitor"?"default":"outline",onClick:()=>p("visitor"),className:"flex-1",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Visitor"]}),e.jsxs(E,{variant:d==="labour"?"default":"outline",onClick:()=>p("labour"),className:"flex-1",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Labour"]})]})})]}),e.jsxs(M,{children:[e.jsx(U,{className:"pb-3",children:e.jsxs(z,{className:"text-base",children:["Select ",d==="visitor"?"Visitor":"Labour"]})}),e.jsxs(K,{className:"space-y-3",children:[d==="visitor"?e.jsx(we,{value:s.visitor,onChange:b,label:"Visitor",placeholder:"Search and select visitor...",error:n.visitor,required:!0}):e.jsx(Ce,{value:s.labour,onChange:_,label:"Labour",placeholder:"Search and select labour...",error:n.labour,required:!0}),i&&e.jsx("div",{className:"p-3 rounded-lg border-2 border-primary bg-primary/5",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.name}),"company_name"in i&&i.company_name&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i.company_name}),"skill_type"in i&&i.skill_type&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i.skill_type})]})})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{children:[e.jsx(U,{className:"pb-3",children:e.jsx(z,{className:"text-base",children:"Entry Details"})}),e.jsxs(K,{className:"space-y-4",children:[e.jsx(ye,{value:s.gate_in,onChange:j,label:"Entry Gate",placeholder:"Select gate...",error:n.gate_in,required:!0}),e.jsxs("div",{children:[e.jsx(C,{children:"Purpose of Visit"}),e.jsx(w,{value:s.purpose,onChange:m=>o(v=>({...v,purpose:m.target.value})),placeholder:"e.g., Meeting with HR, Daily work",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Vehicle Number"}),e.jsx(w,{value:s.vehicle_no,onChange:m=>{const v=m.target.value.toUpperCase().replace(/\s/g,"");o(t=>({...t,vehicle_no:v})),n.vehicle_no&&r(t=>{const y={...t};return delete y.vehicle_no,y})},placeholder:"MH12AB1234",className:P("mt-1",n.vehicle_no&&"border-destructive")}),n.vehicle_no&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:n.vehicle_no})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Remarks"}),e.jsx("textarea",{value:s.remarks,onChange:m=>o(v=>({...v,remarks:m.target.value})),placeholder:"Any additional notes...",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(E,{variant:"outline",onClick:()=>c("/gate/visitor-labour"),className:"flex-1",children:"Cancel"}),e.jsx(E,{onClick:g,disabled:a.isPending,className:"flex-1",children:a.isPending?"Creating...":"Create Entry"})]})]})]})]})}export{qe as default};
