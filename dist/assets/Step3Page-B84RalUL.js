import{r as x,j as e,a as B,K as J,C as w,b as F,c as P,e as A,L as y,I as E,M as q}from"./index-DfsGfni2.js";import{E as X}from"./status.constants-DeQFfq6L.js";import{i as Z,a as ee,g as te,b as ae}from"./error-qMYEww3Q.js";import{u as re}from"./useScrollToError-CjrW2a6h.js";import{u as ne,a as ie,b as se,c as le}from"./maintenance.queries-1Ez9BXw_.js";import{a as ce}from"./vehicleEntry.queries-istEHGw_.js";import{F as oe}from"./FillDataAlert-QgHqbZFs.js";import{S as me}from"./StepFooter-CvTqV4yu.js";import{S as de}from"./StepHeader-pwLwad63.js";import{D as ue}from"./DepartmentSelect-DhTqqANc.js";import"./driver.schema-DZt_XaHY.js";import{S as pe}from"./SearchableSelect-tYvKyXDJ.js";import"./vehicle.schema-BmxwMEOL.js";import{U as ge}from"./UnitSelect-CDXW5O6d.js";import{u as ve}from"./useEntryId-CZsbsX8s.js";import{W as ye}from"./wrench-Du2NzjMW.js";import{P as xe}from"./package--Pw7N4rh.js";import{F as be}from"./file-text-CNRzMP9_.js";import{T as he}from"./triangle-alert-BKHlZgtU.js";import"./circle-x-cAXLtiHJ.js";import"./circle-check-BnYfcqTj.js";import"./clock-Bs4drxDz.js";import"./useMutation-CXxQyPns.js";import"./circle-alert-CD6-XHIC.js";import"./arrow-left-DcCUTbyD.js";import"./wizard.constants-DfnuBX7K.js";import"./validation.constants-C18ePHzl.js";import"./schemas-D8ebsZBL.js";import"./plus-CFqQb0yF.js";function fe({value:g,onChange:S,placeholder:u="Select maintenance type",disabled:p=!1,error:v,label:L,required:M=!1,initialDisplayText:I}){const[C,r]=x.useState(!1),{data:T=[],isLoading:f,isError:_}=ne(C),N=x.useMemo(()=>T.filter(m=>m.is_active),[T]);return e.jsx(pe,{value:g||void 0,items:N,isLoading:f,isError:_,placeholder:u,disabled:p,error:v,label:L,required:M,inputId:"maintenance-type-select",inputClassName:"border-2 font-medium",defaultDisplayText:I,getItemKey:m=>m.id,getItemLabel:m=>m.type_name,loadingText:"Loading maintenance types...",emptyText:"No maintenance types available",notFoundText:"No maintenance types found",onOpenChange:r,onItemSelect:m=>{S(m.id.toString(),m.type_name)},onClear:()=>{S("","")}})}const Ne=[{value:"NORMAL",label:"Normal"},{value:"HIGH",label:"High"},{value:"CRITICAL",label:"Critical"}];function Xe(){const g=B(),S=J(),{entryId:u,entryIdNumber:p,isEditMode:v}=ve(),L=3,M=4,I=ie(p||0),C=se(p||0),{data:r,isLoading:T,error:f}=le(v&&p?p:null),{data:_}=ce(v&&p?p:null),[N,m]=x.useState(!1),[b,U]=x.useState(!1),[R,O]=x.useState(!1),d=v&&!N,k=Z(f),H=ee(f),l=d&&!b&&!k||k&&!N,$=d&&_?.status!==X.COMPLETED,[t,j]=x.useState({maintenanceType:"",maintenanceTypeName:"",supplierName:"",materialDescription:"",partNumber:"",quantity:"",unit:"",unitName:"",invoiceNumber:"",equipmentId:"",receivingDepartment:"",receivingDepartmentName:"",urgencyLevel:"",remarks:""}),[n,i]=x.useState({});re(n),x.useEffect(()=>{if(d&&r){const a=typeof r.maintenance_type=="object"?r.maintenance_type?.id?.toString()||"":r.maintenance_type?.toString()||"",s=typeof r.maintenance_type=="object"&&r.maintenance_type?.type_name||"",c=typeof r.receiving_department=="object"?r.receiving_department?.id?.toString()||"":r.receiving_department?.toString()||"",h=typeof r.receiving_department=="object"&&r.receiving_department?.name||"",D=typeof r.unit=="object"?r.unit?.id?.toString()||"":r.unit?.toString()||"",z=typeof r.unit=="object"&&r.unit?.name||"";j({maintenanceType:a,maintenanceTypeName:s,supplierName:r.supplier_name||"",materialDescription:r.material_description||"",partNumber:r.part_number||"",quantity:r.quantity?.toString()||"",unit:D,unitName:z,invoiceNumber:r.invoice_number||"",equipmentId:r.equipment_id||"",receivingDepartment:c,receivingDepartmentName:h,urgencyLevel:r.urgency_level||"",remarks:r.remarks||""})}},[d,r]);const o=(a,s)=>{l||(j(c=>({...c,[a]:s})),n[a]&&i(c=>{const h={...c};return delete h[a],h}))},G=()=>{g(v&&u?`/gate/maintenance/edit/${u}/step2`:`/gate/maintenance/new/step2?entryId=${u}`)},K=()=>{S.invalidateQueries({queryKey:["vehicleEntries"]}),g("/gate/maintenance")},Q=()=>{m(!0)},W=()=>{U(!0)},Y=async()=>{if(!u||!p){i({general:"Entry ID is missing. Please go back to step 1."});return}if(d&&!b){g(`/gate/maintenance/edit/${u}/attachments`);return}if(i({}),!t.maintenanceType){i({maintenanceType:"Please select maintenance type"});return}if(!t.supplierName.trim()){i({supplierName:"Please enter supplier name"});return}if(!t.materialDescription.trim()){i({materialDescription:"Please enter material description"});return}if(t.materialDescription.trim().length<5){i({materialDescription:"Material description must be atlaest 5 "});return}if(!t.quantity||parseFloat(t.quantity)<=0){i({quantity:"Please enter a valid quantity"});return}if(!t.unit){i({unit:"Please select unit"});return}if(!t.receivingDepartment){i({receivingDepartment:"Please select receiving department"});return}if(!t.urgencyLevel){i({urgencyLevel:"Please select urgency level"});return}try{const a={maintenance_type:parseInt(t.maintenanceType),supplier_name:t.supplierName.trim(),material_description:t.materialDescription.trim(),part_number:t.partNumber.trim()||void 0,quantity:parseFloat(t.quantity),unit:parseInt(t.unit),invoice_number:t.invoiceNumber.trim()||void 0,equipment_id:t.equipmentId.trim()||void 0,receiving_department:parseInt(t.receivingDepartment),urgency_level:t.urgencyLevel,remarks:t.remarks.trim()||void 0};v&&b?await C.mutateAsync(a):await I.mutateAsync(a),O(!0),g(v?`/gate/maintenance/edit/${u}/attachments`:`/gate/maintenance/new/attachments?entryId=${u}`)}catch(a){const s=a;if(s.errors){const c={};Object.entries(s.errors).forEach(([h,D])=>{Array.isArray(D)&&D.length>0&&(c[h]=D[0])}),i(c)}else i({general:s.message||"Failed to save maintenance entry"})}},V=d&&T;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx(de,{currentStep:L,totalSteps:M,title:"Maintenance Entry",error:H?te():n.general}),d&&k&&!N&&e.jsx(oe,{message:ae(f,"Maintenance entry not found"),onFillData:Q}),V?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Maintenance Information"]})}),e.jsx(A,{children:e.jsx("div",{className:"max-w-md",children:e.jsx(fe,{value:t.maintenanceType||void 0,onChange:(a,s)=>{o("maintenanceType",a),j(c=>({...c,maintenanceTypeName:s}))},placeholder:"Select maintenance type",disabled:l,error:n.maintenanceType,label:"Maintenance Type",required:!0,initialDisplayText:t.maintenanceTypeName||void 0})})})]}),e.jsxs(w,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Material Details"]})}),e.jsx(A,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"supplierName",children:["Supplier Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{id:"supplierName",value:t.supplierName,onChange:a=>o("supplierName",a.target.value),placeholder:"Enter supplier name",disabled:l,className:q("border-2 font-medium",n.supplierName&&"border-destructive")}),n.supplierName&&e.jsx("p",{className:"text-sm text-destructive",children:n.supplierName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"partNumber",children:"Part Number / Model Number"}),e.jsx(E,{id:"partNumber",value:t.partNumber,onChange:a=>o("partNumber",a.target.value),placeholder:"Enter part/model number",disabled:l,className:"border-2 font-medium"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs(y,{htmlFor:"materialDescription",children:["Material Description ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("textarea",{id:"materialDescription",value:t.materialDescription,onChange:a=>o("materialDescription",a.target.value),placeholder:"Enter material description",disabled:l,rows:3,className:q("flex w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm font-medium ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n.materialDescription&&"border-destructive")}),n.materialDescription&&e.jsx("p",{className:"text-sm text-destructive",children:n.materialDescription})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"quantity",children:["Quantity ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{id:"quantity",type:"number",min:"0",step:"1",value:t.quantity,onChange:a=>o("quantity",a.target.value),placeholder:"Enter quantity",disabled:l,className:q("border-2 font-medium",n.quantity&&"border-destructive")}),n.quantity&&e.jsx("p",{className:"text-sm text-destructive",children:n.quantity})]}),e.jsx(ge,{value:t.unit||void 0,onChange:(a,s)=>{o("unit",a),j(c=>({...c,unitName:s}))},placeholder:"Select unit",disabled:l,error:n.unit,label:"Unit",required:!0,initialDisplayText:t.unitName||void 0})]})})]}),e.jsxs(w,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Documentation & Assignment"]})}),e.jsx(A,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"invoiceNumber",children:"Invoice Number"}),e.jsx(E,{id:"invoiceNumber",value:t.invoiceNumber,onChange:a=>o("invoiceNumber",a.target.value),placeholder:"Enter invoice number",disabled:l,className:"border-2 font-medium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"equipmentId",children:"Equipment ID (Machine ID)"}),e.jsx(E,{id:"equipmentId",value:t.equipmentId,onChange:a=>o("equipmentId",a.target.value),placeholder:"Enter equipment/machine ID",disabled:l,className:"border-2 font-medium"})]}),e.jsx(ue,{value:t.receivingDepartment?Number(t.receivingDepartment):"",onChange:a=>{o("receivingDepartment",a.toString()),j(s=>({...s,receivingDepartmentName:""}))},placeholder:"Select department",disabled:l,error:n.receivingDepartment,label:"Receiving Department",required:!0,initialDisplayText:t.receivingDepartmentName||void 0}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"urgencyLevel",children:["Urgency Level ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("select",{id:"urgencyLevel",className:q("flex h-10 w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n.urgencyLevel&&"border-destructive"),value:t.urgencyLevel,onChange:a=>o("urgencyLevel",a.target.value),disabled:l,children:[e.jsx("option",{value:"",children:"Select urgency level"}),Ne.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),n.urgencyLevel&&e.jsx("p",{className:"text-sm text-destructive",children:n.urgencyLevel})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(y,{htmlFor:"remarks",children:"Remarks"}),e.jsx("textarea",{id:"remarks",value:t.remarks,onChange:a=>o("remarks",a.target.value),placeholder:"Enter any additional remarks",disabled:l,rows:2,className:"flex w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm font-medium ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]})]})})]}),(t.urgencyLevel==="CRITICAL"||t.urgencyLevel==="HIGH")&&e.jsxs("div",{className:"rounded-md bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-4 flex items-start gap-3",children:[e.jsx(he,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-200",children:[t.urgencyLevel==="CRITICAL"?"Critical":"High"," Priority Item"]}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["This maintenance request has been marked as ",t.urgencyLevel.toLowerCase()," ","priority. Please ensure proper handling and expedited processing."]})]})]})]}),e.jsx(me,{onPrevious:G,onCancel:K,onNext:Y,showUpdate:d&&$&&!b,onUpdate:W,isSaving:I.isPending||C.isPending||R,isEditMode:d,isUpdateMode:b,nextLabel:d&&!b?"Next":"Save & Next"})]})}export{Xe as default};
