import{a as I,r as x,j as e,B as h,au as Q,C as b,e as C,L as m,b as B,c as R,D as G,m as V,n as z,o as H,I as u,P as X,q as Y}from"./index-_Sfdy-kJ.js";import{u as $}from"./useScrollToError-BaiV-2ma.js";import{u as W,a as Z,b as J,c as K,M as ee}from"./MaterialTypeSelect-Dwd1qFSY.js";import{P as A}from"./qc.constants-DCy-hY_d.js";import{A as ae}from"./arrow-left-GMhswg_J.js";import{C as M}from"./circle-alert-g97mPIxl.js";import{P as se}from"./plus-CATTRswk.js";import{S as te}from"./square-pen-ilkWy3LS.js";import{T as re}from"./trash-2-DCO6dKsx.js";import"./useMutation-pgUcGbpY.js";import"./SearchableSelect-RePsI_AL.js";import"./materialType.queries-B_cZqL6p.js";import"./circle-x-Dqawni1P.js";import"./circle-check-D0318yXf.js";import"./user-check-ts3R_DLM.js";import"./send-CdawGwpj.js";import"./file-text-KkrSGLap.js";import"./clock-f8PItCJE.js";function be(){const k=I(),[o,D]=x.useState(null),{data:p=[],isLoading:O}=W(o),[P,E]=x.useState(!1),[j,_]=x.useState(null),[r,i]=x.useState({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:1,is_mandatory:!0}),[l,c]=x.useState({}),[g,v]=x.useState("");$(l);const S=Z(),T=J(),q=K(),w=a=>{if(a)_(a),i({parameter_code:a.parameter_code,parameter_name:a.parameter_name,standard_value:a.standard_value,parameter_type:a.parameter_type,min_value:a.min_value||void 0,max_value:a.max_value||void 0,uom:a.uom,sequence:a.sequence,is_mandatory:a.is_mandatory});else{_(null);const t=p.length>0?Math.max(...p.map(s=>s.sequence))+1:1;i({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:t,is_mandatory:!0})}c({}),v(""),E(!0)},N=()=>{E(!1),_(null),i({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:1,is_mandatory:!0}),c({}),v("")},L=async()=>{const a={};!o&&!j&&(a.general="Please select a material type first"),r.parameter_code.trim()?/^[A-Z0-9_]+$/.test(r.parameter_code)||(a.parameter_code="Code must be uppercase letters, numbers, and underscores only"):a.parameter_code="Code is required",r.parameter_name.trim()||(a.parameter_name="Name is required");const t=p.find(s=>s.sequence===r.sequence&&s.id!==j?.id);if(t&&v(`Sequence ${r.sequence} is already in use.`),Object.keys(a).length>0||t){c(a);return}try{c({}),v("");const s={...r,standard_value:r.standard_value.trim()||"-"};j?await T.mutateAsync({id:j.id,data:s}):await S.mutateAsync({materialTypeId:o,data:s}),N()}catch(s){const n=s;if(n.errors){const f={};Object.entries(n.errors).forEach(([y,U])=>{f[y]=U[0]}),c(f)}else c({general:n.message||"Failed to save parameter"})}},F=async a=>{if(confirm("Are you sure you want to delete this parameter?"))try{await q.mutateAsync(a)}catch(t){const s=t;if(s.errors){const n={};Object.entries(s.errors).forEach(([f,y])=>{n[f]=y[0]}),c(n)}else c({general:s.message||"Failed to delete parameter"})}},d=S.isPending||T.isPending;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>k("/qc"),children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(Q,{className:"h-8 w-8"}),"QC Parameters"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Configure inspection parameters for each material type"})]})}),l.general&&!P&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-4 text-sm text-destructive flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),l.general]}),e.jsx(b,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{className:"min-w-fit",children:"Material Type:"}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx(ee,{value:o||void 0,onChange:a=>D(a?a.id:null),placeholder:"Select Material Type"})}),o&&e.jsxs(h,{onClick:()=>w(),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Parameter"]})]})})}),o&&e.jsxs(b,{children:[e.jsx(B,{children:e.jsxs(R,{children:["Parameters (",p.length,")"]})}),e.jsx(C,{children:O?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):p.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:'No parameters found. Click "Add Parameter" to create one.'}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"#"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Code"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Standard Value"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"UOM"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Mandatory"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(a=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-3",children:a.sequence}),e.jsx("td",{className:"p-3 font-medium",children:a.parameter_code}),e.jsx("td",{className:"p-3",children:a.parameter_name}),e.jsx("td",{className:"p-3",children:a.standard_value}),e.jsx("td",{className:"p-3 text-muted-foreground",children:A[a.parameter_type]}),e.jsx("td",{className:"p-3",children:a.uom||"-"}),e.jsx("td",{className:"p-3 text-center",children:a.is_mandatory?"Yes":"No"}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(h,{size:"sm",variant:"outline",onClick:()=>w(a),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>F(a.id),disabled:q.isPending,children:e.jsx(re,{className:"h-4 w-4"})})]})})]},a.id))})]})})})]}),!o&&e.jsx(b,{children:e.jsx(C,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Select a Material Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a material type above to view and manage its QC parameters."})]})]})})}),e.jsx(G,{open:P,onOpenChange:a=>{a||N()},children:e.jsxs(V,{className:"max-w-lg",children:[e.jsx(z,{children:e.jsx(H,{children:j?"Edit Parameter":"Add Parameter"})}),l.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:l.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{children:["Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(u,{value:r.parameter_code,onChange:a=>{const t=a.target.value.toUpperCase().replace(/\s+/g,"_");i(s=>({...s,parameter_code:t})),l.parameter_code&&c(s=>{const n={...s};return delete n.parameter_code,n})},placeholder:"e.g., WEIGHT",disabled:d,className:l.parameter_code?"border-destructive focus-visible:ring-destructive":""}),l.parameter_code&&e.jsx("p",{className:"text-sm text-destructive",children:l.parameter_code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Sequence"}),e.jsx(u,{type:"number",value:r.sequence,onChange:a=>{i(t=>({...t,sequence:parseInt(a.target.value)||1})),g&&v("")},disabled:d,className:g?"border-destructive focus-visible:ring-destructive":""}),g&&e.jsx("p",{className:"text-sm text-destructive",children:g})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(u,{value:r.parameter_name,onChange:a=>{const t=a.target.value.replace(/\s+/g,"_").split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join("_");i(s=>({...s,parameter_name:t})),l.parameter_name&&c(s=>{const n={...s};return delete n.parameter_name,n})},placeholder:"e.g., Cap_Blue",disabled:d,className:l.parameter_name?"border-destructive focus-visible:ring-destructive":""}),l.parameter_name&&e.jsx("p",{className:"text-sm text-destructive",children:l.parameter_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Standard Value"}),e.jsx(u,{value:r.standard_value,onChange:a=>{const t=a.target.value.split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ");i(s=>({...s,standard_value:t})),l.standard_value&&c(s=>{const n={...s};return delete n.standard_value,n})},placeholder:r.parameter_type==="NUMERIC"?"e.g., 1.35":r.parameter_type==="BOOLEAN"?"e.g., Pass / Fail":r.parameter_type==="RANGE"?"e.g., 1.25 â€“ 1.45":"e.g., Smooth finish",disabled:d,className:l.standard_value?"border-destructive focus-visible:ring-destructive":""}),l.standard_value&&e.jsx("p",{className:"text-sm text-destructive",children:l.standard_value})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Type"}),e.jsx("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:r.parameter_type,onChange:a=>i(t=>({...t,parameter_type:a.target.value})),disabled:d,children:Object.entries(A).map(([a,t])=>e.jsx("option",{value:a,children:t},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"UOM"}),e.jsx(u,{value:r.uom,onChange:a=>i(t=>({...t,uom:a.target.value.toUpperCase()})),placeholder:"e.g., GM,MM,ML",disabled:d})]})]}),r.parameter_type==="RANGE"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Min Value"}),e.jsx(u,{type:"number",step:"0.0001",value:r.min_value||"",onChange:a=>i(t=>({...t,min_value:a.target.value?parseFloat(a.target.value):void 0})),disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Max Value"}),e.jsx(u,{type:"number",step:"0.0001",value:r.max_value||"",onChange:a=>i(t=>({...t,max_value:a.target.value?parseFloat(a.target.value):void 0})),disabled:d})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{id:"is_mandatory",checked:r.is_mandatory,onCheckedChange:a=>i(t=>({...t,is_mandatory:a===!0})),disabled:d}),e.jsx(m,{htmlFor:"is_mandatory",className:"font-normal cursor-pointer",children:"Mandatory parameter"})]})]}),e.jsxs(Y,{children:[e.jsx(h,{variant:"outline",onClick:N,disabled:d,children:"Cancel"}),e.jsx(h,{onClick:L,disabled:d,children:d?"Saving...":"Save"})]})]})})]})}export{be as default};
