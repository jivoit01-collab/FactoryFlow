import{a as M,r as x,j as e,B as o,au as D,C as g,e as v,L as i,b as k,c as q,D as F,m as L,n as O,o as Q,I as m,N as I,q as B}from"./index-B8A-DpGn.js";import{u as R}from"./useScrollToError-Dpdxa5dD.js";import{u as V,a as z,b as H,c as U,M as G}from"./MaterialTypeSelect-D8njqUUg.js";import{P as b}from"./qc.constants-DuJpxXHh.js";import{A as W}from"./arrow-left-DkeKnHik.js";import{P as X}from"./plus-Bgz86sHq.js";import{S as Y}from"./square-pen-BRQnIklz.js";import{T as J}from"./trash-2-HSu16jKJ.js";import{C as K}from"./circle-alert-C0OG7afs.js";import"./useMutation-th6aSWl_.js";import"./SearchableSelect-CxmTVhHL.js";import"./materialType.queries-DtPGpbBS.js";import"./circle-x-Dy0qV5oK.js";import"./circle-check-Bhj5FHVQ.js";import"./user-check-Bu_-rR6v.js";import"./send-BFgWN5ll.js";import"./file-text-Cda58XgB.js";import"./clock-cVxWKgdC.js";function ge(){const P=M(),[n,w]=x.useState(null),{data:p=[],isLoading:T}=V(n),[S,h]=x.useState(!1),[u,j]=x.useState(null),[t,l]=x.useState({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:1,is_mandatory:!0}),[d,c]=x.useState({});R(d);const f=z(),N=H(),y=U(),_=a=>{a?(j(a),l({parameter_code:a.parameter_code,parameter_name:a.parameter_name,standard_value:a.standard_value,parameter_type:a.parameter_type,min_value:a.min_value||void 0,max_value:a.max_value||void 0,uom:a.uom,sequence:a.sequence,is_mandatory:a.is_mandatory})):(j(null),l({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:p.length+1,is_mandatory:!0})),c({}),h(!0)},C=()=>{h(!1),j(null),c({})},E=async()=>{if(!n&&!u){c({general:"Please select a material type first"});return}if(!t.parameter_code.trim()){c({parameter_code:"Code is required"});return}if(!t.parameter_name.trim()){c({parameter_name:"Name is required"});return}try{c({}),u?await N.mutateAsync({id:u.id,data:t}):await f.mutateAsync({materialTypeId:n,data:t}),C()}catch(a){c({general:a.message||"Failed to save parameter"})}},A=async a=>{if(confirm("Are you sure you want to delete this parameter?"))try{await y.mutateAsync(a)}catch(s){alert(s.message||"Failed to delete parameter")}},r=f.isPending||N.isPending;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>P("/qc"),children:e.jsx(W,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(D,{className:"h-8 w-8"}),"QC Parameters"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Configure inspection parameters for each material type"})]})}),e.jsx(g,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{className:"min-w-fit",children:"Material Type:"}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx(G,{value:n||void 0,onChange:a=>w(a?a.id:null),placeholder:"Select Material Type"})}),n&&e.jsxs(o,{onClick:()=>_(),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add Parameter"]})]})})}),n&&e.jsxs(g,{children:[e.jsx(k,{children:e.jsxs(q,{children:["Parameters (",p.length,")"]})}),e.jsx(v,{children:T?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):p.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:'No parameters found. Click "Add Parameter" to create one.'}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"#"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Code"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Standard Value"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"UOM"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Mandatory"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(a=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-3",children:a.sequence}),e.jsx("td",{className:"p-3 font-medium",children:a.parameter_code}),e.jsx("td",{className:"p-3",children:a.parameter_name}),e.jsx("td",{className:"p-3",children:a.standard_value}),e.jsx("td",{className:"p-3 text-muted-foreground",children:b[a.parameter_type]}),e.jsx("td",{className:"p-3",children:a.uom||"-"}),e.jsx("td",{className:"p-3 text-center",children:a.is_mandatory?"Yes":"No"}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>_(a),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>A(a.id),disabled:y.isPending,children:e.jsx(J,{className:"h-4 w-4"})})]})})]},a.id))})]})})})]}),!n&&e.jsx(g,{children:e.jsx(v,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(K,{className:"h-12 w-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Select a Material Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a material type above to view and manage its QC parameters."})]})]})})}),e.jsx(F,{open:S,onOpenChange:h,children:e.jsxs(L,{className:"max-w-lg",children:[e.jsx(O,{children:e.jsx(Q,{children:u?"Edit Parameter":"Add Parameter"})}),d.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:d.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Code"}),e.jsx(m,{value:t.parameter_code,onChange:a=>l(s=>({...s,parameter_code:a.target.value})),placeholder:"e.g., WEIGHT",disabled:r}),d.parameter_code&&e.jsx("p",{className:"text-sm text-destructive",children:d.parameter_code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Sequence"}),e.jsx(m,{type:"number",value:t.sequence,onChange:a=>l(s=>({...s,sequence:parseInt(a.target.value)||1})),disabled:r})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Name"}),e.jsx(m,{value:t.parameter_name,onChange:a=>l(s=>({...s,parameter_name:a.target.value})),placeholder:"e.g., Weight",disabled:r}),d.parameter_name&&e.jsx("p",{className:"text-sm text-destructive",children:d.parameter_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Standard Value"}),e.jsx(m,{value:t.standard_value,onChange:a=>l(s=>({...s,standard_value:a.target.value})),placeholder:"e.g., 1.35Â±0.10",disabled:r})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Type"}),e.jsx("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:t.parameter_type,onChange:a=>l(s=>({...s,parameter_type:a.target.value})),disabled:r,children:Object.entries(b).map(([a,s])=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"UOM"}),e.jsx(m,{value:t.uom,onChange:a=>l(s=>({...s,uom:a.target.value})),placeholder:"e.g., grams",disabled:r})]})]}),t.parameter_type==="RANGE"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Min Value"}),e.jsx(m,{type:"number",step:"0.0001",value:t.min_value||"",onChange:a=>l(s=>({...s,min_value:a.target.value?parseFloat(a.target.value):void 0})),disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Max Value"}),e.jsx(m,{type:"number",step:"0.0001",value:t.max_value||"",onChange:a=>l(s=>({...s,max_value:a.target.value?parseFloat(a.target.value):void 0})),disabled:r})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"is_mandatory",checked:t.is_mandatory,onCheckedChange:a=>l(s=>({...s,is_mandatory:a===!0})),disabled:r}),e.jsx(i,{htmlFor:"is_mandatory",className:"font-normal cursor-pointer",children:"Mandatory parameter"})]})]}),e.jsxs(B,{children:[e.jsx(o,{variant:"outline",onClick:C,disabled:r,children:"Cancel"}),e.jsx(o,{onClick:E,disabled:r,children:r?"Saving...":"Save"})]})]})})]})}export{ge as default};
