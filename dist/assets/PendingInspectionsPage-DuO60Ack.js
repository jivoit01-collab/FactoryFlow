import{a as K,z as V,E as Y,r as B,j as e,B as m,Y as H}from"./index-DpV7uZj9.js";import{D as J}from"./DateRangePicker-BWxq8wTv.js";import"./driver.schema-DO7pkEio.js";import"./vehicle.schema-Cw9NqPJ5.js";import{e as X,u as Z,c as ee,d as se}from"./inspection.queries-CW3QrU93.js";import{W as n,a as F}from"./qc.constants-CYo2Vk8z.js";import{A as te}from"./arrow-left-DUCILz2O.js";import{R as k,S as ae}from"./shield-x-CYJ54Fcd.js";import{C as re}from"./circle-alert-qtNSk3Tj.js";import"./validation.constants-DHFF3fUR.js";import"./schemas-D8ebsZBL.js";import"./useMutation-DX1k4_5x.js";import"./circle-check-mFk-j24l.js";import"./user-check-Bx905T9C.js";import"./send-uL4QW9qx.js";import"./file-text-BP5l3tk-.js";import"./clock-DV_YYAdg.js";import"./circle-x-TIKhQOEZ.js";const v={all:{label:"All",title:"All Inspections",description:"All inspections"},actionable:{label:"Actionable",title:"Pending Actions",description:"Items requiring attention"},pending:{label:"Pending",title:"Pending Inspections",description:"Arrival slips awaiting QC inspection"},draft:{label:"Draft",title:"Draft Inspections",description:"Inspections started but not submitted"},approved:{label:"Approved",title:"Approved Inspections",description:"Completed and approved inspections"},rejected:{label:"Rejected",title:"Rejected Inspections",description:"Rejected inspections"}},ne=Object.keys(v),z=(t,a)=>{if(!a)return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";switch(t){case n.DRAFT:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";case n.SUBMITTED:case n.QA_CHEMIST_APPROVED:return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case n.QAM_APPROVED:case n.COMPLETED:return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"REJECTED":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}};function p(t){const a=t.has_inspection?t.inspection_status:null,c=a?F[a]:null;return{id:t.arrival_slip.id,entryNo:t.arrival_slip.entry_no,itemName:t.arrival_slip.item_name,partyName:t.arrival_slip.party_name,statusLabel:c?c.label:"Pending",statusBadgeClass:z(a,t.has_inspection),submittedAt:t.arrival_slip.submitted_at,navigateTo:t.has_inspection?`/qc/inspections/${t.arrival_slip.id}`:`/qc/inspections/${t.arrival_slip.id}/new`,billingQty:t.arrival_slip.billing_qty,billingUom:t.arrival_slip.billing_uom}}function j(t){const a=F[t.workflow_status];return{id:t.id,entryNo:t.entry_no,reportNo:t.report_no,itemName:t.item_name,partyName:t.supplier_name,statusLabel:a?.label||t.workflow_status,statusBadgeClass:z(t.workflow_status,!0),submittedAt:t.created_at,navigateTo:`/qc/inspections/${t.arrival_slip}`}}function ye(){const t=K(),[a,c]=V(),{dateRange:N,dateRangeAsDateObjects:M,setDateRange:L}=Y(),u=B.useMemo(()=>({from_date:N.from,to_date:N.to}),[N]),g=a.get("status")||"all",x=v[g]||v.all,{data:d=[],isLoading:_,error:w,refetch:Q}=X(u),{data:i=[],isLoading:l,error:o,refetch:U}=Z(u),{data:P=[],isLoading:R,error:E,refetch:W}=ee(u),{data:D=[],isLoading:T,error:S,refetch:q}=se(u),{items:h,isLoading:y,error:f}=B.useMemo(()=>{switch(g){case"all":{const s=d.map(j),b=new Set(d.map(r=>r.arrival_slip)),C=i.filter(r=>!r.has_inspection&&!b.has(r.arrival_slip.id)).map(p);return{items:[...s,...C],isLoading:_||l,error:w||o}}case"pending":return{items:i.filter(s=>!s.has_inspection).map(p),isLoading:l,error:o};case"draft":return{items:i.filter(s=>s.has_inspection&&s.inspection_status===n.DRAFT).map(p),isLoading:l,error:o};case"actionable":return{items:i.filter(s=>!s.has_inspection||s.inspection_status===n.DRAFT||s.inspection_status===n.SUBMITTED||s.inspection_status===n.QA_CHEMIST_APPROVED).map(p),isLoading:l,error:o};case"approved":return{items:P.map(j),isLoading:R,error:E};case"rejected":return{items:D.map(j),isLoading:T,error:S};default:{const s=d.map(j),b=new Set(d.map(r=>r.arrival_slip)),C=i.filter(r=>!r.has_inspection&&!b.has(r.arrival_slip.id)).map(p);return{items:[...s,...C],isLoading:_||l,error:w||o}}}},[g,d,i,P,D,_,l,R,T,w,o,E,S]),I=f,O=I?.status===403,$=s=>{c(s==="all"?{}:{status:s})},A=()=>{Q(),U(),W(),q()},G=s=>{if(!s)return"-";try{return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>t("/qc"),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:x.title})]}),e.jsx("p",{className:"text-muted-foreground",children:x.description})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsx(J,{date:M,onDateChange:s=>{s&&"from"in s?L(s):L(void 0)}}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>A(),className:"w-full sm:w-auto",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ne.map(s=>e.jsx(m,{variant:g===s?"default":"outline",size:"sm",className:"h-8",onClick:()=>$(s),children:v[s].label},s))}),O&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-destructive/50 bg-destructive/5",children:[e.jsx(ae,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permission Denied"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:I?.message||"You do not have permission to view pending inspections."})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>A(),children:e.jsx(k,{className:"h-4 w-4"})})]}),f&&!O&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-yellow-500/50 bg-yellow-50 dark:bg-yellow-900/10",children:[e.jsx(re,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Failed to Load"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:I?.message||"An error occurred while loading inspections."})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>A(),children:e.jsx(k,{className:"h-4 w-4"})})]}),y&&e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}),!y&&!f&&h.length===0&&e.jsxs("div",{className:"flex items-center justify-center h-24 text-sm text-muted-foreground border rounded-lg",children:["No ",x.label.toLowerCase()," inspections"]}),!y&&!f&&h.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:[x.label," (",h.length,")"]})}),e.jsx("div",{className:"space-y-2",children:h.map(s=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>t(s.navigateTo),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s.reportNo||s.entryNo}),e.jsx("span",{className:`inline-flex items-center rounded-full px-1.5 py-0.5 text-[10px] font-medium flex-shrink-0 ${s.statusBadgeClass}`,children:s.statusLabel}),e.jsxs("span",{className:"text-xs text-muted-foreground hidden md:inline truncate",children:[s.itemName," â€¢ ",s.partyName]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.billingQty&&e.jsxs("span",{className:"text-xs text-muted-foreground hidden sm:inline",children:[s.billingQty," ",s.billingUom]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:G(s.submittedAt)}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]})]},s.id))})]})]})}export{ye as default};
