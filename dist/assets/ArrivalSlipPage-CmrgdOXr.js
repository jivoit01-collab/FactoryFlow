import{H as j,J as N,K as T,a as xe,r as y,j as t,k as X,C as J,b as be,c as ge,e as Z,L as m,I as x,M as f,P as ee,B as R,X as te,Q as fe}from"./index-DqK2RTI7.js";import{A as ve}from"./status.constants-9G-hPbd5.js";import{b as je}from"./validation.constants-C18ePHzl.js";import{i as Ne,a as Se,g as we,b as ie}from"./error-qMYEww3Q.js";import{u as Ce}from"./useScrollToError-CrWAoRb7.js";import{a as re}from"./useMutation-D_gsB5z4.js";import{u as ke}from"./poReceipt.queries-BamFQCSR.js";import{a as Ae}from"./vehicleEntry.queries-CEr6q_LU.js";import{F as ae}from"./FillDataAlert-DhyBgz55.js";import{S as Oe}from"./StepFooter-BU3IKyKi.js";import{S as Fe}from"./StepHeader-Cf6uP4JH.js";import{S as $e}from"./StepLoadingSpinner-DRaBpWJe.js";import"./driver.schema-DZt_XaHY.js";import"./vehicle.schema-BmxwMEOL.js";import{W as De}from"./wizard.constants-DfnuBX7K.js";import{u as qe}from"./useEntryId-DDNUBmFp.js";import{F as Ie}from"./file-text-CLZbs6KA.js";import{P as L}from"./paperclip-9EsEYmKJ.js";import{U as se}from"./upload-Djt9Wxkv.js";import{C as Ee}from"./circle-alert-BLB91nVb.js";import"./triangle-alert-D3sH-GI9.js";import"./circle-x-CwzIGl0D.js";import"./circle-check-CTtAHqac.js";import"./clock-CUGtGRKk.js";import"./arrow-left-8J4wiMgZ.js";import"./schemas-D8ebsZBL.js";const U={async get(c){try{return(await j.get(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_GET(c))).data}catch(o){if(o.status===404)return null;throw o}},async getById(c){return(await j.get(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_BY_ID(c))).data},async create(c,o){return(await j.post(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_CREATE(c),o)).data},async update(c,o){return(await j.post(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_CREATE(c),o)).data},async submit(c){const{slipId:o,certificateOfAnalysis:u,certificateOfQuantity:S}=c,b=new FormData;return u&&b.append("certificate_of_analysis",u),S&&b.append("certificate_of_quantity",S),(await j.post(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_SUBMIT(o),b,{headers:{"Content-Type":"multipart/form-data"}})).data},async list(c){return(await j.get(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_LIST,{params:c})).data}};function Re(){const c=T();return re({mutationFn:({poItemReceiptId:o,data:u})=>U.create(o,u),onSuccess:(o,{poItemReceiptId:u})=>{c.invalidateQueries({queryKey:["arrivalSlip",u]}),c.invalidateQueries({queryKey:["arrivalSlips"]}),c.invalidateQueries({queryKey:["gateEntryFullView"]})}})}function Le(){const c=T();return re({mutationFn:o=>U.submit(o),onSuccess:()=>{c.invalidateQueries({queryKey:["arrivalSlip"]}),c.invalidateQueries({queryKey:["arrivalSlips"]}),c.invalidateQueries({queryKey:["gateEntryFullView"]}),c.invalidateQueries({queryKey:["pendingInspections"]})}})}function ot(){const c=xe(),o=T(),{entryId:u,entryIdNumber:S,isEditMode:b}=qe(),M=De.STEPS.ARRIVAL_SLIP,{data:O=[],isLoading:V,error:w}=ke(S||null),{data:Q,isLoading:le}=Ae(S||null),B=Re(),K=Le(),[_,F]=y.useState([]),[n,g]=y.useState({});Ce(n);const[ne,ce]=y.useState(!1),[$,de]=y.useState(!1),[Y,H]=y.useState(!1),[oe,ue]=y.useState(!b),v=b&&!$;y.useEffect(()=>{if(O.length>0&&Q){const e=new Date().toISOString().slice(0,16),a=[];for(const i of O)for(const s of i.items)s.id&&a.push({id:s.id,po_item_code:s.po_item_code,item_name:s.item_name,ordered_qty:s.ordered_qty,received_qty:s.received_qty,uom:s.uom,supplier_name:i.supplier_name,po_number:i.po_number,existingSlip:null,isSubmitted:!1,slipId:null,certificateOfAnalysisFile:null,certificateOfQuantityFile:null,formData:{particulars:`${s.item_name}`,arrival_datetime:e,party_name:i.supplier_name,billing_qty:s.received_qty.toString(),billing_uom:s.uom,truck_no_as_per_bill:Q.vehicle?.vehicle_number||"",commercial_invoice_no:"",eway_bill_no:"",bilty_no:"",has_certificate_of_analysis:!1,has_certificate_of_quantity:!1,remarks:""}});F(a)}},[O,Q]),y.useEffect(()=>{(async()=>{if(_.length===0||!v)return;const a=[..._];let i=!1;for(let s=0;s<a.length;s++){const d=a[s];if(!d.existingSlip)try{const r=await U.get(d.id);r&&(a[s]={...d,existingSlip:r,isSubmitted:r.status===ve.SUBMITTED,slipId:r.id,formData:{particulars:r.particulars,arrival_datetime:r.arrival_datetime?.slice(0,16)||"",party_name:r.party_name,billing_qty:r.billing_qty,billing_uom:r.billing_uom,truck_no_as_per_bill:r.truck_no_as_per_bill,commercial_invoice_no:r.commercial_invoice_no||"",eway_bill_no:r.eway_bill_no||"",bilty_no:r.bilty_no||"",has_certificate_of_analysis:r.has_certificate_of_analysis,has_certificate_of_quantity:r.has_certificate_of_quantity,remarks:r.remarks||""}},i=!0)}catch{}}i?F(a):a.length>0&&H(!0),ue(!0)})()},[_.length,v]);const h=(e,a,i)=>{F(s=>s.map(d=>{if(d.id!==e)return d;const r={...d,formData:{...d.formData,[a]:i}};if(a==="has_certificate_of_analysis"&&i===!1){r.certificateOfAnalysisFile=null;const A=C.current[e];A&&(A.value="")}if(a==="has_certificate_of_quantity"&&i===!1){r.certificateOfQuantityFile=null;const A=k.current[e];A&&(A.value="")}return r})),n[`${e}_${a}`]&&g(s=>{const d={...s};return delete d[`${e}_${a}`],d})},C=y.useRef({}),k=y.useRef({}),D=y.useRef(new Map);y.useEffect(()=>{const e=D.current;return()=>{e.forEach(a=>URL.revokeObjectURL(a))}},[]);const q=e=>(D.current.has(e)||D.current.set(e,URL.createObjectURL(e)),D.current.get(e)),z=e=>{if(e.startsWith("http"))return e;try{return`${new URL(fe.apiBaseUrl).origin}${e}`}catch{return e}},pe=/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i,I=e=>pe.test(e),E=(e,a,i)=>{F(d=>d.map(r=>r.id===e?{...r,[a]:i}:r));const s=`${e}_${a}`;n[s]&&g(d=>{const r={...d};return delete r[s],r})},W=()=>{de(!0),H(!1),g({})},me=()=>{c(b&&u?`/gate/raw-materials/edit/${u}/step3`:`/gate/raw-materials/new/step3?entryId=${u}`)},_e=e=>{const a={};e.formData.particulars.trim()||(a[`${e.id}_particulars`]="Particulars is required"),e.formData.arrival_datetime||(a[`${e.id}_arrival_datetime`]="Arrival date/time is required"),e.formData.party_name.trim()||(a[`${e.id}_party_name`]="Party name is required"),(!e.formData.billing_qty||parseFloat(e.formData.billing_qty)<=0)&&(a[`${e.id}_billing_qty`]="Billing quantity is required"),e.formData.billing_uom.trim()||(a[`${e.id}_billing_uom`]="Billing UOM is required"),e.formData.truck_no_as_per_bill.trim()?je.vehicleNumber.test(e.formData.truck_no_as_per_bill.trim().toUpperCase())||(a[`${e.id}_truck_no_as_per_bill`]="Please enter a valid vehicle number (e.g., MH12AB1234)"):a[`${e.id}_truck_no_as_per_bill`]="Truck number is required";const i=e.existingSlip?.attachments?.some(d=>d.attachment_type.toLowerCase()==="certificate_of_analysis");e.formData.has_certificate_of_analysis&&!e.certificateOfAnalysisFile&&!i&&(a[`${e.id}_certificateOfAnalysisFile`]="Please upload Certificate of Analysis file");const s=e.existingSlip?.attachments?.some(d=>d.attachment_type.toLowerCase()==="certificate_of_quantity");return e.formData.has_certificate_of_quantity&&!e.certificateOfQuantityFile&&!s&&(a[`${e.id}_certificateOfQuantityFile`]="Please upload Certificate of Quantity file"),a},he=async()=>{if(!u){g({general:"Entry ID is missing. Please go back to step 1."});return}if(v&&_.every(a=>a.isSubmitted)){c(`/gate/raw-materials/edit/${u}/step5`);return}let e={};for(const a of _)if(!a.isSubmitted){const i=_e(a);e={...e,...i}}if(Object.keys(e).length>0){g(e);return}g({});try{for(const a of _)if(!a.isSubmitted){const i={particulars:a.formData.particulars,arrival_datetime:new Date(a.formData.arrival_datetime).toISOString(),weighing_required:!0,party_name:a.formData.party_name,billing_qty:parseFloat(a.formData.billing_qty),billing_uom:a.formData.billing_uom,truck_no_as_per_bill:a.formData.truck_no_as_per_bill,commercial_invoice_no:a.formData.commercial_invoice_no,eway_bill_no:a.formData.eway_bill_no,bilty_no:a.formData.bilty_no,has_certificate_of_analysis:a.formData.has_certificate_of_analysis,has_certificate_of_quantity:a.formData.has_certificate_of_quantity,remarks:a.formData.remarks},s=await B.mutateAsync({poItemReceiptId:a.id,data:i});await K.mutateAsync({slipId:s.id,certificateOfAnalysis:a.certificateOfAnalysisFile||void 0,certificateOfQuantity:a.certificateOfQuantityFile||void 0})}ce(!0),c(b?`/gate/raw-materials/edit/${u}/step5`:`/gate/raw-materials/new/step5?entryId=${u}`)}catch(a){const i=a;if(i.errors){const s={};Object.entries(i.errors).forEach(([d,r])=>{Array.isArray(r)&&r.length>0&&(s[d]=r[0])}),g(s)}else g({general:i.message||"Failed to save arrival slips"})}},P=Ne(w),ye=Se(w),G=v&&!V&&(O.length===0||P);if(V||le||v&&_.length>0&&!oe)return t.jsx($e,{});const p=B.isPending||K.isPending,l=Y&&!$;return t.jsxs("div",{className:"space-y-6 pb-6",children:[t.jsx(Fe,{currentStep:M,error:ye?we():n.general||(w&&!P?ie(w,"Failed to load PO receipts"):null)}),G&&!$&&t.jsx(ae,{message:P?ie(w,"PO receipts not found"):"No PO receipts found. Please go back to Step 3 to add PO receipts.",onFillData:W}),Y&&!$&&t.jsx(ae,{message:"Arrival slip not found",onFillData:W}),_.length>0&&_.every(e=>e.isSubmitted)&&t.jsxs("div",{className:"rounded-md bg-green-50 p-4 text-sm text-green-800 flex items-center gap-2",children:[t.jsx(X,{className:"h-5 w-5"}),"All arrival slips have been submitted to QA. Click Next to proceed to Weighment."]}),t.jsxs("div",{className:"space-y-6",children:[_.map((e,a)=>t.jsxs(J,{className:e.isSubmitted||l?"opacity-75":"",children:[t.jsxs(be,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(ge,{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"h-5 w-5"}),t.jsxs("span",{children:["Arrival Slip ",a+1,": ",e.item_name]})]}),e.isSubmitted&&t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[t.jsx(X,{className:"h-3 w-3"}),"Submitted"]})]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["PO: ",e.po_number," | Item Code: ",e.po_item_code," | Received Qty:"," ",e.received_qty," ",e.uom]})]}),t.jsx(Z,{children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`particulars-${e.id}`,children:["Particulars ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`particulars-${e.id}`,placeholder:"Material description",value:e.formData.particulars,onChange:i=>h(e.id,"particulars",i.target.value),disabled:e.isSubmitted||p||l,className:f(n[`${e.id}_particulars`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),n[`${e.id}_particulars`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_particulars`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`arrival_datetime-${e.id}`,children:["Arrival Date/Time ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`arrival_datetime-${e.id}`,type:"datetime-local",value:e.formData.arrival_datetime,onChange:i=>h(e.id,"arrival_datetime",i.target.value),disabled:e.isSubmitted||p||l,className:f(n[`${e.id}_arrival_datetime`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),n[`${e.id}_arrival_datetime`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_arrival_datetime`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`party_name-${e.id}`,children:["Party Name ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`party_name-${e.id}`,placeholder:"Supplier name",value:e.formData.party_name,onChange:i=>h(e.id,"party_name",i.target.value),disabled:e.isSubmitted||p||l,className:f(n[`${e.id}_party_name`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),n[`${e.id}_party_name`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_party_name`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`billing_qty-${e.id}`,children:["Billing Quantity ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`billing_qty-${e.id}`,type:"number",step:"0.001",min:"0",placeholder:"0",value:e.formData.billing_qty,onChange:i=>h(e.id,"billing_qty",i.target.value),disabled:e.isSubmitted||p||l,className:f(n[`${e.id}_billing_qty`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),n[`${e.id}_billing_qty`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_billing_qty`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`billing_uom-${e.id}`,children:["Billing UOM ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`billing_uom-${e.id}`,placeholder:"Pcs, Kg, etc.",value:e.formData.billing_uom,onChange:i=>h(e.id,"billing_uom",i.target.value),disabled:e.isSubmitted||p||l,className:f(n[`${e.id}_billing_uom`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),n[`${e.id}_billing_uom`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_billing_uom`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`truck_no_as_per_bill-${e.id}`,children:["Truck No. (as per Bill) ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`truck_no_as_per_bill-${e.id}`,placeholder:"MH12AB1234",value:e.formData.truck_no_as_per_bill,onChange:i=>{const s=i.target.value.toUpperCase().replace(/\s/g,"");h(e.id,"truck_no_as_per_bill",s)},disabled:e.isSubmitted||p||l,className:f(n[`${e.id}_truck_no_as_per_bill`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),n[`${e.id}_truck_no_as_per_bill`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_truck_no_as_per_bill`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:`commercial_invoice_no-${e.id}`,children:"Commercial Invoice No."}),t.jsx(x,{id:`commercial_invoice_no-${e.id}`,placeholder:"Invoice number",value:e.formData.commercial_invoice_no,onChange:i=>h(e.id,"commercial_invoice_no",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:`eway_bill_no-${e.id}`,children:"E-way Bill No."}),t.jsx(x,{id:`eway_bill_no-${e.id}`,placeholder:"E-way bill number",value:e.formData.eway_bill_no,onChange:i=>h(e.id,"eway_bill_no",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:`bilty_no-${e.id}`,children:"Bilty No."}),t.jsx(x,{id:`bilty_no-${e.id}`,placeholder:"Bilty/LR number",value:e.formData.bilty_no,onChange:i=>h(e.id,"bilty_no",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-3",children:[t.jsx(m,{htmlFor:`remarks-${e.id}`,children:"Remarks"}),t.jsx(x,{id:`remarks-${e.id}`,placeholder:"Any additional remarks",value:e.formData.remarks,onChange:i=>h(e.id,"remarks",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-3 md:col-span-2 lg:col-span-3",children:[t.jsx(m,{className:"text-sm font-semibold",children:"Certifications"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"rounded-md border p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ee,{id:`has_certificate_of_analysis-${e.id}`,checked:e.formData.has_certificate_of_analysis,onCheckedChange:i=>h(e.id,"has_certificate_of_analysis",i===!0),disabled:e.isSubmitted||p||l}),t.jsx(m,{htmlFor:`has_certificate_of_analysis-${e.id}`,className:"text-sm font-medium cursor-pointer",children:"Certificate of Analysis (COA)"})]}),e.formData.has_certificate_of_analysis&&t.jsxs("div",{className:"space-y-2",children:[e.certificateOfAnalysisFile?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:e.certificateOfAnalysisFile.name}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 shrink-0",onClick:()=>{E(e.id,"certificateOfAnalysisFile",null);const i=C.current[e.id];i&&(i.value="")},children:t.jsx(te,{className:"h-3.5 w-3.5"})})]}),I(e.certificateOfAnalysisFile.name)&&t.jsxs("a",{href:q(e.certificateOfAnalysisFile),target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:q(e.certificateOfAnalysisFile),alt:"COA preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]}):(()=>{const i=e.existingSlip?.attachments?.find(s=>s.attachment_type.toLowerCase()==="certificate_of_analysis");if(i){const s=z(i.file),d=i.file_name||i.file.split("/").pop()||"COA uploaded",r=I(d);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:d}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"outline",size:"sm",className:"h-7 text-xs shrink-0",onClick:()=>C.current[e.id]?.click(),children:"Replace"})]}),r&&t.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:s,alt:"COA preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]})}return t.jsxs("div",{className:f("flex items-center gap-3 rounded-md border-2 border-dashed px-3 py-3 cursor-pointer transition-colors",n[`${e.id}_certificateOfAnalysisFile`]?"border-destructive/50 hover:border-destructive":"border-muted-foreground/25 hover:border-primary/50",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50"),onClick:()=>{!e.isSubmitted&&!l&&C.current[e.id]?.click()},children:[t.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Click to upload COA file"})]})})(),t.jsx("input",{ref:i=>{C.current[e.id]=i},type:"file",accept:"image/*,.pdf",className:"hidden",onChange:i=>{const s=i.target.files?.[0]||null;E(e.id,"certificateOfAnalysisFile",s)},disabled:e.isSubmitted||p||l}),n[`${e.id}_certificateOfAnalysisFile`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_certificateOfAnalysisFile`]})]})]}),t.jsxs("div",{className:"rounded-md border p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ee,{id:`has_certificate_of_quantity-${e.id}`,checked:e.formData.has_certificate_of_quantity,onCheckedChange:i=>h(e.id,"has_certificate_of_quantity",i===!0),disabled:e.isSubmitted||p||l}),t.jsx(m,{htmlFor:`has_certificate_of_quantity-${e.id}`,className:"text-sm font-medium cursor-pointer",children:"Certificate of Quantity (COQ)"})]}),e.formData.has_certificate_of_quantity&&t.jsxs("div",{className:"space-y-2",children:[e.certificateOfQuantityFile?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:e.certificateOfQuantityFile.name}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 shrink-0",onClick:()=>{E(e.id,"certificateOfQuantityFile",null);const i=k.current[e.id];i&&(i.value="")},children:t.jsx(te,{className:"h-3.5 w-3.5"})})]}),I(e.certificateOfQuantityFile.name)&&t.jsxs("a",{href:q(e.certificateOfQuantityFile),target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:q(e.certificateOfQuantityFile),alt:"COQ preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]}):(()=>{const i=e.existingSlip?.attachments?.find(s=>s.attachment_type.toLowerCase()==="certificate_of_quantity");if(i){const s=z(i.file),d=i.file_name||i.file.split("/").pop()||"COQ uploaded",r=I(d);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:d}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"outline",size:"sm",className:"h-7 text-xs shrink-0",onClick:()=>k.current[e.id]?.click(),children:"Replace"})]}),r&&t.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:s,alt:"COQ preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]})}return t.jsxs("div",{className:f("flex items-center gap-3 rounded-md border-2 border-dashed px-3 py-3 cursor-pointer transition-colors",n[`${e.id}_certificateOfQuantityFile`]?"border-destructive/50 hover:border-destructive":"border-muted-foreground/25 hover:border-primary/50",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50"),onClick:()=>{!e.isSubmitted&&!l&&k.current[e.id]?.click()},children:[t.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Click to upload COQ file"})]})})(),t.jsx("input",{ref:i=>{k.current[e.id]=i},type:"file",accept:"image/*,.pdf",className:"hidden",onChange:i=>{const s=i.target.files?.[0]||null;E(e.id,"certificateOfQuantityFile",s)},disabled:e.isSubmitted||p||l}),n[`${e.id}_certificateOfQuantityFile`]&&t.jsx("p",{className:"text-sm text-destructive",children:n[`${e.id}_certificateOfQuantityFile`]})]})]})]})]})]})})]},e.id)),_.length===0&&!G&&t.jsx(J,{children:t.jsx(Z,{className:"py-8",children:t.jsxs("div",{className:"text-center text-muted-foreground",children:[t.jsx(Ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No PO item receipts found to create arrival slips."}),t.jsx("p",{className:"text-sm mt-2",children:"Please go back to Step 3 to add PO receipts first."})]})})})]}),t.jsx(Oe,{onPrevious:me,onCancel:()=>{o.invalidateQueries({queryKey:["vehicleEntries"]}),c("/gate/raw-materials")},onNext:he,showUpdate:!1,isSaving:p||ne,isEditMode:v,isUpdateMode:!1,nextLabel:_.every(e=>e.isSubmitted)?"Next":"Submit to QA and Continue"})]})}export{ot as default};
