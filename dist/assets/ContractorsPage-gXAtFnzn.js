import{a as M,r as d,j as e,B as l,I as m,C as I,b as z,c as O,e as U,L as c,M as V}from"./index-_Sfdy-kJ.js";import{b as B}from"./validation.constants-C18ePHzl.js";import{u as R}from"./useScrollToError-BaiV-2ma.js";import{j as q,s as H,t as X,v as G}from"./personGateIn.queries-CFasXzd8.js";import{A as J}from"./arrow-left-GMhswg_J.js";import{P as K}from"./plus-CATTRswk.js";import{S as Q}from"./search-NtfP0T3E.js";import{C as W}from"./circle-check-D0318yXf.js";import{C as Y}from"./circle-x-Dqawni1P.js";import{P as Z}from"./pen-rYUWrKHO.js";import{T as $}from"./trash-2-DCO6dKsx.js";import"./useMutation-pgUcGbpY.js";function xe(){const y=M(),[x,A]=d.useState(""),[k,h]=d.useState(!1),[u,N]=d.useState(null),[a,r]=d.useState({contractor_name:"",contact_person:"",mobile:"",address:"",contract_valid_till:"",is_active:!0}),[n,f]=d.useState({});R(n);const{data:S=[],isLoading:E,refetch:b}=q(),j=H(),p=X(),C=G(),_=S.filter(t=>t.contractor_name.toLowerCase().includes(x.toLowerCase())||t.contact_person?.toLowerCase().includes(x.toLowerCase())||t.mobile?.toLowerCase().includes(x.toLowerCase())),v=()=>{r({contractor_name:"",contact_person:"",mobile:"",address:"",contract_valid_till:"",is_active:!0}),N(null),f({})},P=t=>{N(t),r({contractor_name:t.contractor_name,contact_person:t.contact_person||"",mobile:t.mobile||"",address:t.address||"",contract_valid_till:t.contract_valid_till||"",is_active:t.is_active}),h(!0)},L=async()=>{const t={};if(a.contractor_name.trim()||(t.contractor_name="Contractor name is required"),a.mobile?.trim()&&!B.phone.test(a.mobile.trim())&&(t.mobile="Please enter a valid 10-digit phone number"),Object.keys(t).length>0){f(t);return}try{u?await p.mutateAsync({id:u.id,data:a}):await j.mutateAsync(a),h(!1),v(),b()}catch(s){const i=s;if(i.errors){const o={};Object.entries(i.errors).forEach(([F,g])=>{Array.isArray(g)&&g.length>0&&(o[F]=g[0])}),f(o)}}},D=async t=>{if(window.confirm("Are you sure you want to delete this contractor?"))try{await C.mutateAsync(t),b()}catch(s){console.error("Failed to delete:",s)}},T=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return t}},w=t=>{if(!t)return!1;try{return new Date(t)<new Date}catch{return!1}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>y("/gate/visitor-labour"),children:e.jsx(J,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Contractors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage contractor records"})]})]}),e.jsxs(l,{onClick:()=>{v(),h(!0)},children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Contractor"]})]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(m,{placeholder:"Search contractors...",value:x,onChange:t=>A(t.target.value),className:"pl-10"})]}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs(I,{className:"w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx(z,{children:e.jsx(O,{children:u?"Edit Contractor":"Add Contractor"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Contractor Name *"}),e.jsx(m,{value:a.contractor_name,onChange:t=>r(s=>({...s,contractor_name:t.target.value})),placeholder:"Enter contractor name",className:"mt-1"}),n.contractor_name&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:n.contractor_name})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Contact Person"}),e.jsx(m,{value:a.contact_person||"",onChange:t=>r(s=>({...s,contact_person:t.target.value})),placeholder:"Contact person name",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Mobile"}),e.jsx(m,{value:a.mobile||"",onChange:t=>{const s=t.target.value.replace(/[^0-9]/g,"").slice(0,10);r(i=>({...i,mobile:s})),n.mobile&&f(i=>{const o={...i};return delete o.mobile,o})},placeholder:"9876543210",maxLength:10,className:V("mt-1",n.mobile&&"border-destructive")}),n.mobile&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:n.mobile})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Address"}),e.jsx("textarea",{value:a.address||"",onChange:t=>r(s=>({...s,address:t.target.value})),placeholder:"Full address",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Contract Valid Till"}),e.jsx(m,{type:"date",value:a.contract_valid_till||"",onChange:t=>r(s=>({...s,contract_valid_till:t.target.value})),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:a.is_active,onChange:t=>r(s=>({...s,is_active:t.target.checked})),className:"rounded"}),e.jsx(c,{htmlFor:"is_active",className:"text-sm font-normal",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{h(!1),v()},className:"flex-1",children:"Cancel"}),e.jsx(l,{onClick:L,disabled:j.isPending||p.isPending,className:"flex-1",children:j.isPending||p.isPending?"Saving...":u?"Update":"Add"})]})]})]})}),E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):_.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground rounded-md border",children:e.jsx("p",{className:"text-lg",children:"No contractors found"})}):e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[700px]",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Contractor Name"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Contact Person"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Mobile"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Contract Valid Till"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-right text-sm font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:_.map(t=>e.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[e.jsx("td",{className:"p-3 text-sm font-medium",children:t.contractor_name}),e.jsx("td",{className:"p-3 text-sm",children:t.contact_person||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.mobile||"-"}),e.jsx("td",{className:"p-3 text-sm",children:e.jsxs("span",{className:w(t.contract_valid_till)?"text-red-600 dark:text-red-400":"",children:[T(t.contract_valid_till),w(t.contract_valid_till)&&" (Expired)"]})}),e.jsx("td",{className:"p-3 text-sm",children:t.is_active?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(W,{className:"h-3 w-3"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600 dark:text-red-400",children:[e.jsx(Y,{className:"h-3 w-3"}),"Inactive"]})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>P(t),children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>D(t.id),disabled:C.isPending,children:e.jsx($,{className:"h-3 w-3 text-red-500"})})]})})]},t.id))})]})})})]})}export{xe as default};
