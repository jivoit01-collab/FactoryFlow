import{y as T,a as F,r as p,j as e,B as d,I as x,C as O,b as M,c as z,e as B,L as c,J as C}from"./index-BJbr7dGT.js";import{b as R}from"./validation.constants-DHFF3fUR.js";import{u as U}from"./useScrollToError-ByUJimjt.js";import{h as $,f as q,o as H,p as J}from"./personGateIn.queries-DOxe0tNP.js";import{I as Y,a as w}from"./driver.schema-DO7pkEio.js";import{A as G}from"./arrow-left-CSneh59K.js";import{P as K}from"./plus-CkmVnUnI.js";import{S as Q}from"./search-kp31VX7_.js";import{C as W}from"./circle-check-DziCER4n.js";import{P as X}from"./pen-TscHAfeq.js";import{T as Z}from"./trash-2-BCIspCd8.js";import"./useMutation-B7kknB8H.js";import"./schemas-D8ebsZBL.js";const ee=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],se=T("ban",ee);function he(){const k=F(),[m,A]=p.useState(""),[P,f]=p.useState(!1),[h,N]=p.useState(null),[t,i]=p.useState({name:"",mobile:"",company_name:"",id_proof_type:"",id_proof_no:"",blacklisted:!1}),[o,n]=p.useState({});U(o);const{data:S=[],isLoading:I,refetch:b}=$(m),u=q(),j=H(),y=J(),v=S.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.mobile?.toLowerCase().includes(m.toLowerCase())||s.company_name?.toLowerCase().includes(m.toLowerCase())),_=()=>{i({name:"",mobile:"",company_name:"",id_proof_type:"",id_proof_no:"",blacklisted:!1}),N(null),n({})},V=s=>{N(s),i({name:s.name,mobile:s.mobile||"",company_name:s.company_name||"",id_proof_type:s.id_proof_type||"",id_proof_no:s.id_proof_no||"",blacklisted:s.blacklisted}),f(!0)},L=async()=>{const s={};if(t.name.trim()||(s.name="Name is required"),t.mobile?.trim()&&!R.phone.test(t.mobile.trim())&&(s.mobile="Please enter a valid 10-digit phone number"),t.id_proof_type&&t.id_proof_no?.trim()){const a=t.id_proof_type,r=w[a];r?.pattern&&!r.pattern.test(t.id_proof_no.trim().toUpperCase())&&(s.id_proof_no=r.message)}if(Object.keys(s).length>0){n(s);return}try{h?await j.mutateAsync({id:h.id,data:t}):await u.mutateAsync(t),f(!1),_(),b()}catch(a){const r=a;if(r.errors){const l={};Object.entries(r.errors).forEach(([E,g])=>{Array.isArray(g)&&g.length>0&&(l[E]=g[0])}),n(l)}}},D=async s=>{if(window.confirm("Are you sure you want to delete this visitor?"))try{await y.mutateAsync(s),b()}catch(a){console.error("Failed to delete:",a)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>k("/gate/visitor-labour"),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Visitors"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage visitor records"})]})]}),e.jsxs(d,{onClick:()=>{_(),f(!0)},children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Visitor"]})]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(x,{placeholder:"Search visitors...",value:m,onChange:s=>A(s.target.value),className:"pl-10"})]}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs(O,{className:"w-full max-w-md mx-4",children:[e.jsx(M,{children:e.jsx(z,{children:h?"Edit Visitor":"Add Visitor"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Name *"}),e.jsx(x,{value:t.name,onChange:s=>i(a=>({...a,name:s.target.value})),placeholder:"Enter name",className:"mt-1"}),o.name&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Mobile"}),e.jsx(x,{value:t.mobile||"",onChange:s=>{const a=s.target.value.replace(/[^0-9]/g,"").slice(0,10);i(r=>({...r,mobile:a})),o.mobile&&n(r=>{const l={...r};return delete l.mobile,l})},placeholder:"9876543210",maxLength:10,className:C("mt-1",o.mobile&&"border-destructive")}),o.mobile&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:o.mobile})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Company"}),e.jsx(x,{value:t.company_name||"",onChange:s=>i(a=>({...a,company_name:s.target.value})),placeholder:"Company name",className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"ID Proof Type"}),e.jsxs("select",{value:t.id_proof_type||"",onChange:s=>{i(a=>({...a,id_proof_type:s.target.value,id_proof_no:""})),o.id_proof_no&&n(a=>{const r={...a};return delete r.id_proof_no,r})},className:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx("option",{value:"",children:"Select type"}),Y.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"ID Proof No"}),e.jsx(x,{value:t.id_proof_no||"",onChange:s=>{let a=s.target.value;t.id_proof_type==="Aadhar"?a=a.replace(/[^0-9]/g,"").slice(0,12):(t.id_proof_type==="PAN Card"||t.id_proof_type==="Voter ID")&&(a=a.toUpperCase()),i(r=>({...r,id_proof_no:a})),o.id_proof_no&&n(r=>{const l={...r};return delete l.id_proof_no,l})},placeholder:w[t.id_proof_type]?.placeholder||"ID number",maxLength:t.id_proof_type==="Aadhar"?12:t.id_proof_type==="PAN Card"||t.id_proof_type==="Voter ID"?10:50,disabled:!t.id_proof_type,className:C("mt-1",o.id_proof_no&&"border-destructive")}),o.id_proof_no&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:o.id_proof_no})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"blacklisted",checked:t.blacklisted,onChange:s=>i(a=>({...a,blacklisted:s.target.checked})),className:"rounded"}),e.jsx(c,{htmlFor:"blacklisted",className:"text-sm font-normal",children:"Blacklisted"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{f(!1),_()},className:"flex-1",children:"Cancel"}),e.jsx(d,{onClick:L,disabled:u.isPending||j.isPending,className:"flex-1",children:u.isPending||j.isPending?"Saving...":h?"Update":"Add"})]})]})]})}),I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):v.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground rounded-md border",children:e.jsx("p",{className:"text-lg",children:"No visitors found"})}):e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[600px]",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Name"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Mobile"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Company"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"ID Proof"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-right text-sm font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:v.map(s=>e.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[e.jsx("td",{className:"p-3 text-sm font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-sm",children:s.mobile||"-"}),e.jsx("td",{className:"p-3 text-sm",children:s.company_name||"-"}),e.jsx("td",{className:"p-3 text-sm",children:s.id_proof_type?`${s.id_proof_type}: ${s.id_proof_no}`:"-"}),e.jsx("td",{className:"p-3 text-sm",children:s.blacklisted?e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600 dark:text-red-400",children:[e.jsx(se,{className:"h-3 w-3"}),"Blacklisted"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(W,{className:"h-3 w-3"}),"Active"]})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>V(s),children:e.jsx(X,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>D(s.id),disabled:y.isPending,children:e.jsx(Z,{className:"h-3 w-3 text-red-500"})})]})})]},s.id))})]})})})]})}export{he as default};
