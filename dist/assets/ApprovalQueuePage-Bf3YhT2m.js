import{a as I,al as O,E as q,r as C,au as R,j as e,B as t,at as P,C as r,e as i,b as z,c as F}from"./index-Dm3Xfjnt.js";import{D as V}from"./DateRangePicker-CkUlb0aM.js";import"./driver.schema-DO7pkEio.js";import"./vehicle.schema-Cw9NqPJ5.js";import{j as W,k as $}from"./inspection.queries-D2PHidgF.js";import{W as B}from"./qc.constants-BchmX-Kf.js";import{A as G}from"./arrow-left-RhgS-m-T.js";import{R as f,S as H}from"./shield-x-DW_E62g4.js";import{C as K}from"./circle-alert-CkjslOaL.js";import{E as U}from"./eye-CV9z5iv8.js";import"./validation.constants-DHFF3fUR.js";import"./schemas-D8ebsZBL.js";import"./useMutation-C59p_qU8.js";import"./circle-x-gTIzRI_j.js";import"./circle-check-4K5RQOA0.js";import"./user-check-DTF_egBE.js";import"./send-DUKN0Er9.js";import"./file-text-BURbwi2j.js";import"./clock-xVG4dxTu.js";function ue(){const j=I(),{hasAnyPermission:g}=O(),{dateRange:d,dateRangeAsDateObjects:_,setDateRange:N}=q(),v=C.useMemo(()=>({from_date:d.from,to_date:d.to}),[d]),{data:w=[],isLoading:Q,error:k,refetch:S}=W(v),{data:A=[],isLoading:E,error:L,refetch:D}=$(v),m=Q||E,n=k||L,x=n,b=x?.status===403,l=g([R.APPROVAL.APPROVE_AS_CHEMIST]),h=g([R.APPROVAL.APPROVE_AS_QAM]),M=l?"chemist":"manager",[p,y]=C.useState(M),a=p==="chemist"&&!l&&h?"manager":p==="manager"&&!h&&l?"chemist":p,c=a==="chemist"?w:A,u=()=>{S(),D()},T=s=>new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>j("/qc"),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(P,{className:"h-8 w-8"}),"Approval Queue"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Review and approve inspections"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsx(V,{date:_,onDateChange:s=>{s&&"from"in s?N(s):N(void 0)}}),e.jsxs(t,{variant:"outline",onClick:()=>u(),children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[l&&e.jsxs(t,{variant:a==="chemist"?"default":"outline",onClick:()=>y("chemist"),children:["QA Chemist Queue (",w.length,")"]}),h&&e.jsxs(t,{variant:a==="manager"?"default":"outline",onClick:()=>y("manager"),children:["QA Manager Queue (",A.length,")"]})]}),b&&e.jsx(r,{className:"border-destructive/50 bg-destructive/5",children:e.jsx(i,{className:"py-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-destructive/10",children:e.jsx(H,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-destructive",children:"Permission Denied"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:x?.message||"You do not have permission to view the approval queue."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Please contact your administrator if you believe this is an error."})]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>u(),children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}),n&&!b&&e.jsx(r,{className:"border-yellow-500/50 bg-yellow-50 dark:bg-yellow-900/10",children:e.jsx(i,{className:"py-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100 dark:bg-yellow-900/20",children:e.jsx(K,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-yellow-800 dark:text-yellow-400",children:"Failed to Load Data"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:x?.message||"An error occurred while loading the approval queue."})]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>u(),children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}),m&&e.jsx(r,{children:e.jsx(i,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})})}),!m&&!n&&c.length===0&&e.jsx(r,{children:e.jsx(i,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(P,{className:"h-12 w-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"No Pending Approvals"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["There are no inspections awaiting"," ",a==="chemist"?"QA Chemist":"QA Manager"," approval."]})]})]})})}),!m&&!n&&c.length>0&&e.jsxs(r,{children:[e.jsx(z,{children:e.jsxs(F,{children:[a==="chemist"?"Awaiting QA Chemist Approval":"Awaiting QA Manager Approval"," ","(",c.length,")"]})}),e.jsx(i,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Report No."}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Particulars"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Supplier"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Inspection Date"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Status"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Action"})]})}),e.jsx("tbody",{children:c.map(s=>{const o=B[s.workflow_status];return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium",children:s.report_no||s.entry_no})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.item_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description_of_material})]})}),e.jsx("td",{className:"p-3",children:s.supplier_name}),e.jsx("td",{className:"p-3 text-muted-foreground",children:s.inspection_date?T(s.inspection_date):"-"}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${o.bgColor} ${o.color}`,children:o.label})}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs(t,{size:"sm",onClick:()=>j(`/qc/inspections/${s.arrival_slip}`),children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),"Review"]})})]},s.id)})})]})})})]})]})}export{ue as default};
