import{a as Y,H as $,r as x,j as e,B as n,C as d,b as u,c as h,e as m,L as s,T as G,U as X,O as Z,J as B}from"./index-BlttmsHz.js";import{E as ee,g as se,a as te}from"./status.constants-B0MYmmeb.js";import{a as T,g as re,b as ae}from"./error-qMYEww3Q.js";import{u as ie}from"./useScrollToError-BbXkMWnH.js";import{d as ce,e as ne}from"./construction.queries-B2ZVwn_P.js";import{s as I}from"./securityCheck.api-DNqRz1VA.js";import{u as le}from"./useEntryId-Cz9iv8zj.js";import{C as A}from"./circle-alert-CUcQmltW.js";import{A as F}from"./arrow-left-D1raZAL5.js";import{F as L}from"./file-check-DR8z-B7H.js";import{C as P}from"./clock-IkmY-E9y.js";import{S as M}from"./shield-check-iFd0jkBz.js";import{B as V}from"./building-2-BEC13ikX.js";import{P as de}from"./package-Bfpq0z6i.js";import{F as me}from"./file-text-CHubKTsl.js";import{C as p}from"./circle-check-oo-uuCfp.js";import{C as oe}from"./circle-x-CXmN1Y2K.js";import"./triangle-alert-CadjuZfY.js";import"./useMutation-TnQ6hR0R.js";function xe({status:a}){return e.jsx("span",{className:B("px-2 py-1 rounded-full text-xs font-medium",se(a)),children:a})}function ue({status:a}){return e.jsx("span",{className:B("px-2 py-1 rounded-full text-xs font-medium",te(a)),children:a})}function b({value:a}){return a?e.jsx(p,{className:"h-5 w-5 text-green-500"}):e.jsx(oe,{className:"h-5 w-5 text-red-500"})}function he({onNavigateToDashboard:a,onNavigateToHome:l}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background",children:[e.jsx("div",{className:"relative mb-8",children:e.jsxs("svg",{className:"h-32 w-32 text-green-500",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"animate-draw-circle",style:{strokeDasharray:283,strokeDashoffset:283}}),e.jsx("path",{d:"M30 50 L45 65 L70 35",fill:"none",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-draw-check",style:{strokeDasharray:60,strokeDashoffset:60}})]})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold text-foreground opacity-0 animate-fade-in-delay-1",children:"Entry Completed!"}),e.jsx("p",{className:"mb-12 text-muted-foreground opacity-0 animate-fade-in-delay-2",children:"Construction gate entry has been successfully completed"}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row opacity-0 animate-fade-in-delay-3",children:[e.jsxs(n,{size:"lg",onClick:a,className:"min-w-[200px]",children:[e.jsx(V,{className:"mr-2 h-5 w-5"}),"Construction Dashboard"]}),e.jsxs(n,{size:"lg",variant:"outline",onClick:l,className:"min-w-[200px]",children:[e.jsx(Z,{className:"mr-2 h-5 w-5"}),"Home"]})]})]})}function Le(){const a=Y(),l=$(),{entryId:o,entryIdNumber:j,isEditMode:R}=le(),[C,f]=x.useState(!1),[k,w]=x.useState(!1),[q,K]=x.useState(!1),[_,Q]=x.useState(!1),g=()=>{l.invalidateQueries({queryKey:["vehicleEntries"]}),l.invalidateQueries({queryKey:["constructionFullView"]}),a("/gate/construction")},H=()=>{l.invalidateQueries({queryKey:["vehicleEntries"]}),l.invalidateQueries({queryKey:["constructionFullView"]}),a("/")},[N,c]=x.useState({});ie(N);const{data:t,isLoading:O,error:S}=ce(j),z=ne(),E=()=>{a(R&&o?`/gate/construction/edit/${o}/attachments`:`/gate/construction/new/attachments?entryId=${o}`)},J=async()=>{if(!o){c({general:"Entry ID is missing."});return}c({}),f(!0);try{const i=await I.get(j);if(!i.id){c({general:"Security check data not found. Please complete security check first."}),f(!1);return}await I.submit(i.id),Q(!0),l.invalidateQueries({queryKey:["constructionFullView",j]})}catch(i){const v=i,W=v.message||v.detail||"Failed to submit security check";c({general:W})}finally{f(!1)}},U=async()=>{if(!o){c({general:"Entry ID is missing."});return}c({}),w(!0);try{await z.mutateAsync(j),K(!0)}catch(i){T(i)?c({general:"Cannot complete the entry at the moment. Please try again later."}):c({general:ae(i,"Failed to complete gate entry")})}finally{w(!1)}},D=i=>new Date(i).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});if(q)return e.jsx(he,{onNavigateToDashboard:g,onNavigateToHome:H});if(O)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(S){const i=T(S)?re():"Failed to load gate entry details. Please try again.";return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"rounded-md bg-destructive/15 p-4 text-sm text-destructive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:i})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(n,{type:"button",variant:"outline",onClick:E,children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Previous"]})})]})}if(!t)return null;const y=t.gate_entry.status===ee.COMPLETED,r=t.construction_details;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(L,{className:"h-8 w-8"}),"Final Review"]}),e.jsx("p",{className:"text-muted-foreground",children:"Review all details before completing the construction gate entry"})]}),N.general&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),N.general]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Gate Entry Information"]}),e.jsx(xe,{status:t.gate_entry.status})]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Entry Number"}),e.jsx("p",{className:"font-medium",children:t.gate_entry.entry_no})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Entry Type"}),e.jsx("p",{className:"font-medium",children:t.gate_entry.entry_type})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Created At"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),D(t.gate_entry.created_at)]})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Locked"}),e.jsx("p",{className:"font-medium",children:t.gate_entry.is_locked?"Yes":"No"})]})]})})]}),e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Vehicle Details"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Vehicle Number"}),e.jsx("p",{className:"font-medium",children:t.vehicle.vehicle_number})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Vehicle Type"}),e.jsx("p",{className:"font-medium",children:t.vehicle.vehicle_type.name})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Capacity"}),e.jsxs("p",{className:"font-medium",children:[t.vehicle.capacity_ton," Tons"]})]})]})})]}),e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Driver Details"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Driver Name"}),e.jsx("p",{className:"font-medium",children:t.driver.name})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Mobile Number"}),e.jsx("p",{className:"font-medium",children:t.driver.mobile_no})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"License Number"}),e.jsx("p",{className:"font-medium",children:t.driver.license_no})]})]})})]}),t.security_check&&e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Security Check"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:t.security_check.vehicle_condition_ok}),e.jsx("span",{className:"text-sm",children:"Vehicle Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:t.security_check.tyre_condition_ok}),e.jsx("span",{className:"text-sm",children:"Tyre Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:t.security_check.alcohol_test_passed}),e.jsx("span",{className:"text-sm",children:"Alcohol Test Passed"})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Inspected By"}),e.jsx("p",{className:"font-medium",children:t.security_check.inspected_by})]})]}),t.security_check.remarks&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Remarks"}),e.jsx("p",{className:"text-sm",children:t.security_check.remarks})]})]})]}),r&&e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Construction Details"]}),e.jsx(ue,{status:r.security_approval})]})}),e.jsxs(m,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Project Name"}),e.jsx("p",{className:"font-medium text-primary",children:r.project_name})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Work Order Number"}),e.jsx("p",{className:"font-medium",children:r.work_order_number})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Contractor Name"}),e.jsx("p",{className:"font-medium",children:r.contractor_name})]}),r.contractor_contact&&e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Contractor Contact"}),e.jsx("p",{className:"font-medium",children:r.contractor_contact})]}),r.vehicle_number&&e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Vehicle Number"}),e.jsx("p",{className:"font-medium",children:r.vehicle_number})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2 mb-4",children:[e.jsx(de,{className:"h-4 w-4"}),"Material Information"]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Material Category"}),e.jsx("p",{className:"font-medium",children:r.material_category})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Quantity"}),e.jsxs("p",{className:"font-medium text-lg text-primary",children:[r.quantity," ",r.unit]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Material Description"}),e.jsx("p",{className:"font-medium",children:r.material_description})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2 mb-4",children:[e.jsx(me,{className:"h-4 w-4"}),"Documentation & Assignment"]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[r.challan_number&&e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Challan Number"}),e.jsx("p",{className:"font-medium",children:r.challan_number})]}),r.invoice_number&&e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Invoice Number"}),e.jsx("p",{className:"font-medium",children:r.invoice_number})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Site Engineer"}),e.jsx("p",{className:"font-medium",children:r.site_engineer})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Inward Time"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),D(r.inward_time)]})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Created By"}),e.jsx("p",{className:"font-medium",children:r.created_by})]})]})]}),r.remarks&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Remarks / Notes"}),e.jsx("p",{className:"text-sm",children:r.remarks})]})]})]}),!y&&e.jsx(d,{className:"border-primary/50",children:e.jsx(m,{className:"pt-6",children:t.security_check?.is_submitted||_?e.jsxs("div",{className:"flex items-center gap-3 text-green-600 dark:text-green-400",children:[e.jsx(p,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Security check submitted. Ready to complete entry."})]}):e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(s,{className:"text-base font-medium",children:"Security Inspection Pending"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Submit security check to proceed with completing the entry"})]})})})})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-between",children:[e.jsxs(n,{type:"button",variant:"outline",onClick:E,children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Previous"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:g,children:"Cancel"}),!y&&e.jsx(e.Fragment,{children:!t?.security_check?.is_submitted&&!_?e.jsxs(n,{type:"button",onClick:J,disabled:C,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),C?"Submitting...":"Submit Security"]}):e.jsxs(n,{type:"button",onClick:U,disabled:k,children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),k?"Completing...":"Complete Entry"]})}),y&&e.jsxs(n,{type:"button",onClick:g,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),"Entry Completed"]})]})]})]})}export{Le as default};
