import{y as he,H as Te,J as Fe,j as e,B as y,au as xe,V as Le,z as Me,r as b,av as C,a as De,W as Qe,M as S,C as G,b as H,c as q,e as W,L as x,I as _,as as de}from"./index-DqK2RTI7.js";import{F as V}from"./status.constants-9G-hPbd5.js";import{u as Ve}from"./useScrollToError-CrWAoRb7.js";import{u as Be}from"./useMutation-D_gsB5z4.js";import{c as Ue,d as Ge,e as He,f as qe,g as We,h as $e,i as ze}from"./inspection.queries-6KU1rzbR.js";import{u as Ye,M as Ke}from"./MaterialTypeSelect-Dggx_b53.js";import{a as T,W as z,F as Y}from"./qc.constants-eLBUmU0r.js";import{A as me}from"./arrow-left-8J4wiMgZ.js";import{C as Je}from"./circle-alert-BLB91nVb.js";import{F as K}from"./file-text-CLZbs6KA.js";import{P as Xe}from"./paperclip-9EsEYmKJ.js";import{E as ue}from"./external-link-B3rDI5eM.js";import{C as pe}from"./circle-check-CTtAHqac.js";import{C as Ze}from"./circle-x-CwzIGl0D.js";import{S as es}from"./send-Cax-6Caf.js";import"./triangle-alert-D3sH-GI9.js";import"./clock-CUGtGRKk.js";import"./SearchableSelect-D148btNF.js";import"./plus-BJUDEEZb.js";import"./materialType.queries-CadKzl1b.js";import"./user-check-BDvfZxBK.js";const ss=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],as=he("pencil",ss);const ts=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],rs=he("save",ts),ns={async getById(c){return(await Te.get(Fe.QUALITY_CONTROL_V2.ARRIVAL_SLIP_BY_ID(c))).data}},_e={all:["qc-arrivalSlips"],detail:c=>[..._e.all,"detail",c]};function is(c){return Be({queryKey:_e.detail(c),queryFn:()=>ns.getById(c),enabled:!!c})}const ls={chemist:{title:"Approved by QC Chemist",subtitle:"Inspection has been approved and forwarded to QC Manager"},manager:{title:"Approved by QC Manager",subtitle:"Quality control inspection is now complete"}};function cs({type:c,onNavigateToDashboard:f,onNavigateToHome:P}){const v=ls[c];return e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background",children:[e.jsx("div",{className:"relative mb-8",children:e.jsxs("svg",{className:"h-32 w-32 text-green-500",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"animate-draw-circle",style:{strokeDasharray:283,strokeDashoffset:283}}),e.jsx("path",{d:"M30 50 L45 65 L70 35",fill:"none",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-draw-check",style:{strokeDasharray:60,strokeDashoffset:60}})]})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold text-foreground opacity-0 animate-fade-in-delay-1",children:v.title}),e.jsx("p",{className:"mb-12 text-muted-foreground opacity-0 animate-fade-in-delay-2",children:v.subtitle}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row opacity-0 animate-fade-in-delay-3",children:[e.jsxs(y,{size:"lg",onClick:f,className:"min-w-[200px]",children:[e.jsx(xe,{className:"mr-2 h-5 w-5"}),"QC Dashboard"]}),e.jsxs(y,{size:"lg",variant:"outline",onClick:P,className:"min-w-[200px]",children:[e.jsx(Le,{className:"mr-2 h-5 w-5"}),"Home"]})]})]})}function os(c){const{hasAnyPermission:f}=Me();return b.useMemo(()=>{const P=f([C.INSPECTION.CREATE]),v=f([C.INSPECTION.CREATE,C.INSPECTION.EDIT]),E=f([C.INSPECTION.SUBMIT]),k=f([C.APPROVAL.APPROVE_AS_CHEMIST]),F=f([C.APPROVAL.APPROVE_AS_QAM]),t=f([C.APPROVAL.REJECT,C.APPROVAL.APPROVE_AS_CHEMIST,C.APPROVAL.APPROVE_AS_QAM]),L=!c||c.workflow_status===T.DRAFT,d=c?.workflow_status===T.SUBMITTED,B=c?.workflow_status===T.QA_CHEMIST_APPROVED,m=c?.is_locked??!1,M=c?.workflow_status===T.QAM_APPROVED||c?.workflow_status===T.REJECTED;return{canCreateInspection:P,canEditInspection:v,canSubmitInspection:E,canApproveAsChemist:k,canApproveAsQAM:F,canReject:t,showSaveButton:!m&&L&&v,showSubmitButton:c&&L&&!m&&E,showChemistApproval:d&&k,showQAMApproval:B&&F,showRejectButton:(d||B)&&t,canEditFields:!m&&L&&v,isCompleted:M,isLocked:m}},[c,f])}function Ps(){const c=De(),{slipId:f,inspectionId:P}=Qe(),v=window.location.pathname.includes("/new"),E=f?parseInt(f):P?parseInt(P):null,[k,F]=b.useState(!1),{data:t,isLoading:L}=Ue(E),{data:d,isLoading:B}=is(E),[m,M]=b.useState({inspection_date:new Date().toISOString().split("T")[0],description_of_material:"",sap_code:"",supplier_name:"",manufacturer_name:"",supplier_batch_lot_no:"",unit_packing:"",purchase_order_no:"",internal_lot_no:"",invoice_bill_no:"",vehicle_no:"",material_type_id:0,remarks:""}),[D,J]=b.useState({}),[Q,fe]=b.useState(""),[X,je]=b.useState(V.ACCEPTED),[g,u]=b.useState({}),[Z,ee]=b.useState(null);Ve(g);const{data:R=[]}=Ye(m.material_type_id||null),se=Ge(),ae=He(),te=qe(),re=We(),ne=$e(),ie=ze();b.useEffect(()=>{if(t){M({inspection_date:t.inspection_date,description_of_material:t.description_of_material,sap_code:t.sap_code,supplier_name:t.supplier_name,manufacturer_name:t.manufacturer_name,supplier_batch_lot_no:t.supplier_batch_lot_no,unit_packing:t.unit_packing,purchase_order_no:t.purchase_order_no,internal_lot_no:t.internal_lot_no,invoice_bill_no:t.invoice_bill_no,vehicle_no:t.vehicle_no,material_type_id:t.material_type,remarks:t.remarks});const s={};t.parameter_results?.forEach(a=>{s[a.parameter_master]={result_value:a.result_value,result_numeric:a.result_numeric||void 0,is_within_spec:a.is_within_spec??void 0,remarks:a.remarks}}),J(s)}},[t]),b.useEffect(()=>{d&&!t&&v&&M(s=>({...s,description_of_material:d.item_name||s.description_of_material,sap_code:d.po_item_code||s.sap_code,supplier_name:d.party_name||s.supplier_name,unit_packing:d.billing_qty&&d.billing_uom?`${d.billing_qty} ${d.billing_uom}`:s.unit_packing,vehicle_no:d.truck_no_as_per_bill||s.vehicle_no,invoice_bill_no:d.commercial_invoice_no||s.invoice_bill_no,remarks:d.remarks||s.remarks}))},[d,t,v]);const j=(s,a)=>{M(n=>({...n,[s]:a})),g[s]&&u(n=>{const i={...n};return delete i[s],i})},w=(s,a,n)=>{J(r=>({...r,[s]:{...r[s],result_value:r[s]?.result_value||"",remarks:r[s]?.remarks||"",[a]:n}}));const i=`param_${s}`;g[i]&&u(r=>{const h={...r};return delete h[i],h})},U=(s,a,n,i,r)=>{if(w(s,"result_value",a),n==="NUMERIC"||n==="RANGE"){const h=parseFloat(a);if(!isNaN(h)&&(w(s,"result_numeric",h),n==="RANGE"&&i!=null&&r!=null)){const O=typeof i=="string"?parseFloat(i):i,I=typeof r=="string"?parseFloat(r):r;!isNaN(O)&&!isNaN(I)&&w(s,"is_within_spec",h>=O&&h<=I)}}else n==="BOOLEAN"&&w(s,"is_within_spec",a==="Pass")},le=s=>{switch(s){case"NUMERIC":return"Enter numeric value";case"RANGE":return"Enter numeric value";case"BOOLEAN":return"Select Pass or Fail";default:return"Enter text value"}},ve=async()=>{if(E)try{u({});const s={};m.material_type_id||(s.material_type_id="Please select a material type");const a=R.filter(i=>i.is_mandatory);for(const i of a)D[i.id]?.result_value?.trim()||(s[`param_${i.id}`]=`${i.parameter_name} result is required`);if(Object.keys(s).length>0){u(s);return}let n=t?.id;if(t||(n=(await se.mutateAsync({slipId:E,data:m})).id),n&&Object.keys(D).length>0){const i=Object.entries(D).map(([r,h])=>({parameter_master_id:parseInt(r),result_value:h.result_value||"",result_numeric:h.result_numeric,is_within_spec:h.is_within_spec??!0,remarks:h.remarks||""}));await ae.mutateAsync({inspectionId:n,results:i})}F(!1)}catch(s){const a=s;if(a.errors){const n={};Object.entries(a.errors).forEach(([i,r])=>{n[i]=r[0]}),u(n)}else u({general:a.message||"Failed to save inspection"})}},ge=async()=>{if(!t){u({general:"Please save the inspection first"});return}try{u({}),await te.mutateAsync(t.id)}catch(s){const a=s;if(a.errors){const n={};Object.entries(a.errors).forEach(([i,r])=>{n[i]=r[0]}),u(n)}else u({general:a.message||"Failed to submit inspection"})}},Ne=async()=>{if(t)try{u({}),await re.mutateAsync({id:t.id,data:{remarks:Q}}),ee("chemist")}catch(s){const a=s;if(a.errors){const n={};Object.entries(a.errors).forEach(([i,r])=>{n[i]=r[0]}),u(n)}else u({general:a.message||"Failed to approve"})}},be=async()=>{if(t)try{u({}),await ne.mutateAsync({id:t.id,data:{remarks:Q,final_status:X}}),ee("manager")}catch(s){const a=s;if(a.errors){const n={};Object.entries(a.errors).forEach(([i,r])=>{n[i]=r[0]}),u(n)}else u({general:a.message||"Failed to approve"})}},ye=async()=>{if(t){if(!Q.trim()){u({approval_remarks:"Please provide a reason for rejection"});return}try{u({}),await ie.mutateAsync({id:t.id,data:{remarks:Q}})}catch(s){const a=s;if(a.errors){const n={};Object.entries(a.errors).forEach(([i,r])=>{n[i]=r[0]}),u(n)}else u({general:a.message||"Failed to reject"})}}},{canEditInspection:Ae,showSubmitButton:Ce,showChemistApproval:we,showQAMApproval:Ee,showRejectButton:ke,canEditFields:Ie,isLocked:Se}=os(t),Pe=!t||t.workflow_status===T.DRAFT,o=Ie&&(!t||k),Re=t&&Pe&&Ae&&!k&&!Se,Oe=Ce&&!k,ce=we,$=Ee,oe=ke,l=se.isPending||ae.isPending||te.isPending||re.isPending||ne.isPending||ie.isPending;return Z?e.jsx(cs,{type:Z,onNavigateToDashboard:()=>c("/qc"),onNavigateToHome:()=>c("/")}):L||B?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>c("/qc/pending"),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(xe,{className:"h-8 w-8"}),v?"New Inspection":"Inspection Details"]})]}),t&&e.jsxs("div",{className:"flex items-center gap-4 ml-10",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Report No: ",t.report_no]}),e.jsx("span",{className:S("px-2 py-1 rounded-full text-xs font-medium",z[t.workflow_status].bgColor,z[t.workflow_status].color),children:z[t.workflow_status].label}),t.final_status!==V.PENDING&&e.jsx("span",{className:S("px-2 py-1 rounded-full text-xs font-medium",Y[t.final_status].bgColor,Y[t.final_status].color),children:Y[t.final_status].label})]})]})}),g.general&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),g.general]}),e.jsxs(G,{children:[e.jsx(H,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Inspection Information"]})}),e.jsx(W,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Description of Material"}),e.jsx(_,{value:m.description_of_material||"",onChange:s=>j("description_of_material",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"SAP Code"}),e.jsx(_,{value:m.sap_code||"",onChange:s=>j("sap_code",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Supplier Name"}),e.jsx(_,{value:m.supplier_name||"",onChange:s=>j("supplier_name",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Unit Packing"}),e.jsx(_,{value:m.unit_packing||"",onChange:s=>j("unit_packing",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Vehicle No."}),e.jsx(_,{value:m.vehicle_no||"",onChange:s=>j("vehicle_no",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Invoice/Bill No."}),e.jsx(_,{value:m.invoice_bill_no||"",onChange:s=>j("invoice_bill_no",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Inspection Date"}),e.jsx(_,{type:"date",value:m.inspection_date||"",onChange:s=>j("inspection_date",s.target.value),disabled:!o||l})]}),e.jsx(Ke,{label:"Material Type",required:!0,value:m.material_type_id||void 0,onChange:s=>j("material_type_id",s?.id||0),disabled:!o||l||!!t,error:g.material_type_id}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Internal Lot No."}),e.jsx(_,{value:m.internal_lot_no||"",onChange:s=>j("internal_lot_no",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Manufacturer Name"}),e.jsx(_,{value:m.manufacturer_name||"",onChange:s=>j("manufacturer_name",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Supplier Batch/Lot No."}),e.jsx(_,{value:m.supplier_batch_lot_no||"",onChange:s=>j("supplier_batch_lot_no",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Purchase Order No."}),e.jsx(_,{value:m.purchase_order_no||"",onChange:s=>j("purchase_order_no",s.target.value),disabled:!o||l})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-3",children:[e.jsx(x,{children:"Remarks"}),e.jsx(de,{value:m.remarks||"",onChange:s=>j("remarks",s.target.value),disabled:!o||l,rows:2})]})]})})]}),d&&d.attachments?.length>0&&e.jsxs(G,{children:[e.jsx(H,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"Attachments"]})}),e.jsx(W,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.attachments.some(s=>s.attachment_type==="CERTIFICATE_OF_ANALYSIS")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Certificate of Analysis (COA)"}),d.attachments.filter(s=>s.attachment_type==="CERTIFICATE_OF_ANALYSIS").map(s=>{const a=/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i.test(s.file);return e.jsx("a",{href:s.file,target:"_blank",rel:"noopener noreferrer",className:"block border rounded-lg overflow-hidden hover:ring-2 hover:ring-primary transition-all",children:a?e.jsx("img",{src:s.file,alt:"Certificate of Analysis",className:"w-full h-48 object-cover"}):e.jsxs("div",{className:"w-full h-48 flex flex-col items-center justify-center gap-2 bg-muted/30 text-muted-foreground",children:[e.jsx(K,{className:"h-8 w-8"}),e.jsx("span",{className:"text-xs",children:"View File"}),e.jsx(ue,{className:"h-3 w-3"})]})},s.id)})]}),d.attachments.some(s=>s.attachment_type==="CERTIFICATE_OF_QUANTITY")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Certificate of Quantity (COQ)"}),d.attachments.filter(s=>s.attachment_type==="CERTIFICATE_OF_QUANTITY").map(s=>{const a=/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i.test(s.file);return e.jsx("a",{href:s.file,target:"_blank",rel:"noopener noreferrer",className:"block border rounded-lg overflow-hidden hover:ring-2 hover:ring-primary transition-all",children:a?e.jsx("img",{src:s.file,alt:"Certificate of Quantity",className:"w-full h-48 object-cover"}):e.jsxs("div",{className:"w-full h-48 flex flex-col items-center justify-center gap-2 bg-muted/30 text-muted-foreground",children:[e.jsx(K,{className:"h-8 w-8"}),e.jsx("span",{className:"text-xs",children:"View File"}),e.jsx(ue,{className:"h-3 w-3"})]})},s.id)})]})]})})]}),((t?.parameter_results?.length??0)>0||R.length>0)&&e.jsxs(G,{children:[e.jsx(H,{children:e.jsx(q,{children:"QC Parameters"})}),e.jsxs(W,{children:[e.jsx("div",{className:"md:hidden space-y-4",children:(t?.parameter_results||R).map(s=>{const a="parameter_master"in s?s.parameter_master:s.id,n=s.parameter_name,i=s.standard_value,r=s.parameter_type,h=s.min_value,O=s.max_value,I="is_mandatory"in s?s.is_mandatory:R.find(p=>p.id===a)?.is_mandatory??!1,N=g[`param_${a}`],A=D[a]||{result_value:"",is_within_spec:!0,remarks:""};return e.jsxs("div",{className:S("border rounded-lg p-3 space-y-3",N&&"border-destructive"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-sm",children:[n,I&&e.jsx("span",{className:"text-destructive",children:" *"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:A.is_within_spec??!0,onChange:p=>w(a,"is_within_spec",p.target.checked),disabled:!o||l||r==="BOOLEAN"||r==="RANGE",className:"h-4 w-4 rounded border-gray-300"}),e.jsx("span",{className:"text-muted-foreground",children:"Within Spec"})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Standard: ",i]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(x,{className:"text-xs",children:["Result",I&&e.jsx("span",{className:"text-destructive",children:" *"})]}),r==="BOOLEAN"?e.jsxs("select",{value:A.result_value,onChange:p=>U(a,p.target.value,r),disabled:!o||l,className:S("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",N&&"border-destructive"),children:[e.jsx("option",{value:"",children:"Select Pass or Fail"}),e.jsx("option",{value:"Pass",children:"Pass"}),e.jsx("option",{value:"Fail",children:"Fail"})]}):e.jsx(_,{type:r==="NUMERIC"||r==="RANGE"?"number":"text",step:r==="NUMERIC"||r==="RANGE"?"any":void 0,value:A.result_value,onChange:p=>U(a,p.target.value,r,h,O),disabled:!o||l,className:S("w-full",N&&"border-destructive"),placeholder:le(r)}),N&&e.jsx("p",{className:"text-xs text-destructive",children:N})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Remarks"}),e.jsx(_,{value:A.remarks,onChange:p=>w(a,"remarks",p.target.value),disabled:!o||l,className:"w-full",placeholder:"Optional"})]})]},a)})}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Parameter"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Standard Value"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Result"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Within Spec"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Remarks"})]})}),e.jsx("tbody",{children:(t?.parameter_results||R).map(s=>{const a="parameter_master"in s?s.parameter_master:s.id,n=s.parameter_name,i=s.standard_value,r=s.parameter_type,h=s.min_value,O=s.max_value,I="is_mandatory"in s?s.is_mandatory:R.find(p=>p.id===a)?.is_mandatory??!1,N=g[`param_${a}`],A=D[a]||{result_value:"",is_within_spec:!0,remarks:""};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium",children:[n,I&&e.jsx("span",{className:"text-destructive",children:" *"})]})}),e.jsx("td",{className:"p-3 text-muted-foreground",children:i}),e.jsxs("td",{className:"p-3",children:[r==="BOOLEAN"?e.jsxs("select",{value:A.result_value,onChange:p=>U(a,p.target.value,r),disabled:!o||l,className:S("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",N&&"border-destructive"),children:[e.jsx("option",{value:"",children:"Select Pass or Fail"}),e.jsx("option",{value:"Pass",children:"Pass"}),e.jsx("option",{value:"Fail",children:"Fail"})]}):e.jsx(_,{type:r==="NUMERIC"||r==="RANGE"?"number":"text",step:r==="NUMERIC"||r==="RANGE"?"any":void 0,value:A.result_value,onChange:p=>U(a,p.target.value,r,h,O),disabled:!o||l,className:S("w-full",N&&"border-destructive"),placeholder:le(r)}),N&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:N})]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",checked:A.is_within_spec??!0,onChange:p=>w(a,"is_within_spec",p.target.checked),disabled:!o||l||r==="BOOLEAN"||r==="RANGE",className:"h-4 w-4 rounded border-gray-300"})}),e.jsx("td",{className:"p-3",children:e.jsx(_,{value:A.remarks,onChange:p=>w(a,"remarks",p.target.value),disabled:!o||l,className:"w-full",placeholder:"Optional"})})]},a)})})]})})]})]}),(ce||$||oe)&&e.jsxs(G,{className:"border-primary/50",children:[e.jsx(H,{children:e.jsx(q,{children:"Approval"})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Remarks"}),e.jsx(de,{value:Q,onChange:s=>fe(s.target.value),placeholder:"Enter approval/rejection remarks",rows:3}),g.approval_remarks&&e.jsx("p",{className:"text-sm text-destructive",children:g.approval_remarks})]}),$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Final Status"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:X,onChange:s=>je(s.target.value),children:[e.jsx("option",{value:V.ACCEPTED,children:"Accepted"}),e.jsx("option",{value:V.REJECTED,children:"Rejected"}),e.jsx("option",{value:V.HOLD,children:"Hold"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[ce&&e.jsxs(y,{onClick:Ne,disabled:l,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Approve as Chemist"]}),$&&e.jsxs(y,{onClick:be,disabled:l,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Approve as Manager"]}),oe&&e.jsxs(y,{variant:"destructive",onClick:ye,disabled:l,children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-between",children:[e.jsxs(y,{variant:"outline",onClick:()=>c("/qc/pending"),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex gap-4",children:[Re&&e.jsxs(y,{variant:"outline",onClick:()=>F(!0),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Update"]}),o&&e.jsxs(y,{onClick:ve,disabled:l,children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),l?"Saving...":"Save"]}),Oe&&!k&&e.jsxs(y,{onClick:ge,disabled:l,children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Submit for Approval"]})]})]})]})}export{Ps as default};
