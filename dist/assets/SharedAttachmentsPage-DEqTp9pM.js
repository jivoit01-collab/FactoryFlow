import{H as N,J as v,K as E,a as F,r as b,j as e,C as q,b as _,c as U,e as H}from"./index-DcDZk0Ze.js";import{u as L,a as M}from"./useMutation-BN6FooZ9.js";import{S as R}from"./StepFooter-DSr_Mu4e.js";import{S as G}from"./StepHeader-D7WzSZBO.js";import"./driver.schema-DZt_XaHY.js";import"./vehicle.schema-BmxwMEOL.js";import{u as K}from"./useEntryId-CLccz1rl.js";import{P as Q}from"./paperclip-MOKApe6G.js";import{U as Y}from"./upload-DMuHiIhW.js";import{F as D}from"./file-text-rZJa_sVN.js";import{E as B}from"./external-link-C1ZZ798S.js";const A={async getAll(t){const r=await N.get(v.GATE_ATTACHMENTS.BY_ENTRY(t));return Array.isArray(r.data)?r.data:[]},async upload(t,r){const s=new FormData;return s.append("file",r),(await N.post(v.GATE_ATTACHMENTS.BY_ENTRY(t),s,{headers:{"Content-Type":"multipart/form-data"}})).data}};function O(t){return L({queryKey:["gateAttachments",t],queryFn:()=>A.getAll(t),enabled:!!t})}function J(t){const r=E();return M({mutationFn:s=>A.upload(t,s),onSuccess:()=>{r.invalidateQueries({queryKey:["gateAttachments",t]})}})}const X=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"];function z(t){const r=t.toLowerCase();return X.some(s=>r.includes(s))}function le({config:t}){const r=F(),s=E(),{entryId:n,entryIdNumber:d,isEditMode:f}=K(),c=b.useRef(null),C=t.totalSteps,h=`step${t.totalSteps-1}`,[S,g]=b.useState(null),{data:i,isLoading:w}=O(d),m=J(d||0),T=async l=>{const a=l.target.files;if(!(!a||a.length===0||!d)){g(null);for(const o of Array.from(a))try{await m.mutateAsync(o)}catch(u){g(u.message||`Failed to upload ${o.name}`)}c.current&&(c.current.value="")}},P=()=>{c.current?.click()},$=()=>{r(f&&n?`${t.routePrefix}/edit/${n}/${h}`:`${t.routePrefix}/new/${h}?entryId=${n}`)},I=()=>{s.invalidateQueries({queryKey:["vehicleEntries"]}),r(t.routePrefix)},k=()=>{r(f&&n?`${t.routePrefix}/edit/${n}/review`:`${t.routePrefix}/new/review?entryId=${n}`)};return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx(G,{currentStep:C,totalSteps:t.totalSteps,title:t.headerTitle,error:S}),w?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(q,{children:[e.jsx(_,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Attachments"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed border-muted-foreground/25 p-8 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:P,children:[e.jsx(Y,{className:"h-10 w-10 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Click to upload files"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Images, documents, and other files"})]}),m.isPending&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Uploading..."]})]}),e.jsx("input",{ref:c,type:"file",multiple:!0,className:"hidden",onChange:T}),i&&i.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:[i.length," attachment",i.length!==1?"s":""," uploaded"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:i.map(l=>{const a=l.file,o=l.file_name||a.split("/").pop()||"File",u=z(a);return e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"group relative rounded-lg border bg-card overflow-hidden block hover:ring-2 hover:ring-primary/50 transition-all",children:[u?e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:a,alt:o,className:"h-full w-full object-cover",onError:j=>{const y=j.currentTarget;y.style.display="none";const p=y.parentElement;if(p){p.classList.add("flex","items-center","justify-center","bg-muted");const x=document.createElement("div");x.innerHTML="ðŸ“„",x.className="text-4xl",p.appendChild(x)}}})}):e.jsx("div",{className:"aspect-square flex items-center justify-center bg-muted",children:e.jsx(D,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsx("p",{className:"text-xs font-medium truncate flex-1",title:o,children:o}),e.jsx(B,{className:"h-3 w-3 shrink-0 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]})]},l.id)})})]}),(!i||i.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-2",children:"No attachments yet. Upload files or skip to continue."})]})})]})}),e.jsx(R,{onPrevious:$,onCancel:I,onNext:k,isSaving:m.isPending,nextLabel:"Review"})]})}export{le as S};
