import{a as L,r as m,j as e,B as o,au as F,C as M,e as E,b as q,c as B,D as U,m as z,n as I,o as _,L as g,I as v,q as H}from"./index-Df6yG8ds.js";import{u as Q}from"./useScrollToError-B0x_JS2Y.js";import{u as R,a as Z,b as $,c as G}from"./materialType.queries-CQfCuHvM.js";import{A as J}from"./arrow-left-CQgpk7-_.js";import{P as K}from"./plus-CNXR9Mm4.js";import{C as S}from"./circle-alert-So7rTZ_W.js";import{S as V}from"./square-pen-CcC-h2xH.js";import{T as W}from"./trash-2-CVHjh5Ua.js";import"./useMutation-ymheTFRs.js";function ne(){const k=L(),{data:x=[],isLoading:N,error:y}=R(),[b,C]=m.useState(!1),[p,u]=m.useState(null),[n,c]=m.useState({code:"",name:"",description:""}),[t,i]=m.useState({});Q(t);const T=Z(),w=$(),D=G(),A=s=>{s?(u(s),c({code:s.code,name:s.name,description:s.description||""})):(u(null),c({code:"",name:"",description:""})),i({}),C(!0)},h=()=>{C(!1),u(null),c({code:"",name:"",description:""}),i({})},P=async()=>{const s={};if(n.code.trim()?/^[A-Z0-9_]+$/.test(n.code)||(s.code="Code must be uppercase letters, numbers, and underscores only"):s.code="Code is required",n.name.trim()||(s.name="Name is required"),Object.keys(s).length>0){i(s);return}try{i({}),p?await w.mutateAsync({id:p.id,data:n}):await T.mutateAsync(n),h()}catch(l){const a=l;if(a.errors){const r={};Object.entries(a.errors).forEach(([j,f])=>{r[j]=f[0]}),i(r)}else i({general:a.message||"Failed to save material type"})}},O=async s=>{if(confirm("Are you sure you want to delete this material type?"))try{await D.mutateAsync(s)}catch(l){const a=l;if(a.errors){const r={};Object.entries(a.errors).forEach(([j,f])=>{r[j]=f[0]}),i(r)}else i({general:a.message||"Failed to delete material type"})}},d=T.isPending||w.isPending;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>k("/qc"),children:e.jsx(J,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(F,{className:"h-8 w-8"}),"Material Types"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage material type definitions for QC inspections"})]}),e.jsxs(o,{onClick:()=>A(),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Material Type"]})]}),y&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-4 text-sm text-destructive flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Failed to load material types. Please try again."]}),t.general&&!b&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-4 text-sm text-destructive flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),t.general]}),N&&e.jsx(M,{children:e.jsx(E,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})})}),!N&&!y&&e.jsxs(M,{children:[e.jsx(q,{children:e.jsxs(B,{children:["Material Types (",x.length,")"]})}),e.jsx(E,{children:x.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:'No material types found. Click "Add Material Type" to create one.'}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Code"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Description"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:x.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-3 font-medium",children:s.code}),e.jsx("td",{className:"p-3",children:s.name}),e.jsx("td",{className:"p-3 text-muted-foreground",children:s.description||"-"}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>A(s),children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>O(s.id),disabled:D.isPending,children:e.jsx(W,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(U,{open:b,onOpenChange:s=>{s||h()},children:e.jsxs(z,{children:[e.jsx(I,{children:e.jsx(_,{children:p?"Edit Material Type":"Add Material Type"})}),t.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:t.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{children:["Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(v,{value:n.code,onChange:s=>{const l=s.target.value.toUpperCase().replace(/\s+/g,"_");c(a=>({...a,code:l})),t.code&&i(a=>{const r={...a};return delete r.code,r})},placeholder:"e.g., CAP_BLUE",disabled:d,className:t.code?"border-destructive focus-visible:ring-destructive":""}),t.code&&e.jsx("p",{className:"text-sm text-destructive",children:t.code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(v,{value:n.name,onChange:s=>{const l=s.target.value.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" ");c(a=>({...a,name:l})),t.name&&i(a=>{const r={...a};return delete r.name,r})},placeholder:"e.g., Cap Blue Plain",disabled:d,className:t.name?"border-destructive focus-visible:ring-destructive":""}),t.name&&e.jsx("p",{className:"text-sm text-destructive",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Description"}),e.jsx(v,{value:n.description||"",onChange:s=>c(l=>({...l,description:s.target.value})),placeholder:"Optional description",disabled:d})]})]}),e.jsxs(H,{children:[e.jsx(o,{variant:"outline",onClick:h,disabled:d,children:"Cancel"}),e.jsx(o,{onClick:P,disabled:d,children:d?"Saving...":"Save"})]})]})})]})}export{ne as default};
