import{y as v,a as z,W as H,r as P,j as e,B as i,al as M,C as o,b as f,c as g,e as x,U as D}from"./index-DqK2RTI7.js";import{k as q,l as O,m as R,c as W,n as X}from"./personGateIn.queries-CG1l-ICP.js";import"./driver.schema-DZt_XaHY.js";import{G as J}from"./GateSelect-Oo3onXKf.js";import"./vehicle.schema-BmxwMEOL.js";import{A as K}from"./arrow-left-8J4wiMgZ.js";import{C as L}from"./circle-x-CwzIGl0D.js";import{C as h}from"./clock-CUGtGRKk.js";import{F as S}from"./file-text-CLZbs6KA.js";import{P as Q}from"./phone-DjiS1S0l.js";import{C as Y}from"./circle-check-CTtAHqac.js";import"./useMutation-D_gsB5z4.js";import"./validation.constants-C18ePHzl.js";import"./schemas-D8ebsZBL.js";import"./SearchableSelect-D148btNF.js";import"./plus-BJUDEEZb.js";const Z=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],N=v("briefcase",Z);const ee=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],se=v("car",ee);const te=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],I=v("map-pin",te);function ve(){const y=z(),{entryId:b}=H(),[A,u]=P.useState(!1),[n,G]=P.useState(null),l=b?parseInt(b,10):null,{data:s,isLoading:F,refetch:w}=q(l),{data:r}=O(s?.visitor||null),{data:a}=R(s?.labour||null),p=W(),_=X(),d=t=>{if(!t)return"-";try{return new Date(t).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t}},V=(t,j)=>{if(!t)return"-";try{const B=new Date(t),k=(j?new Date(j):new Date).getTime()-B.getTime(),C=Math.floor(k/(1e3*60*60)),E=Math.floor(k%(1e3*60*60)/(1e3*60));return C>0?`${C}h ${E}m`:`${E}m`}catch{return"-"}},T=t=>{switch(t?.toUpperCase()){case"IN":return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-3 py-1 text-sm font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx(Y,{className:"h-4 w-4"}),"Inside"]});case"OUT":return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-3 py-1 text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:[e.jsx(M,{className:"h-4 w-4"}),"Exited"]});case"CANCELLED":return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-3 py-1 text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",children:[e.jsx(L,{className:"h-4 w-4"}),"Cancelled"]});default:return null}},U=async()=>{if(!(!l||!n))try{await p.mutateAsync({id:l,data:{gate_out:n}}),u(!1),w()}catch(t){console.error("Failed to exit:",t)}},$=async()=>{if(l&&window.confirm("Are you sure you want to cancel this entry?"))try{await _.mutateAsync(l),w()}catch(t){console.error("Failed to cancel:",t)}};if(F)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"Entry not found"}),e.jsx(i,{variant:"link",onClick:()=>y("/gate/visitor-labour"),children:"Go back"})]});const c=s.visitor?r:a,m=!!s.visitor;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>y(-1),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:s.name_snapshot}),T(s.status)]}),e.jsxs("p",{className:"text-muted-foreground",children:[m?"Visitor":"Labour"," Entry"]})]})]}),s.status==="IN"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",onClick:$,disabled:_.isPending,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Cancel Entry"]}),e.jsxs(i,{onClick:()=>u(!0),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Mark Exit"]})]})]}),A&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs(o,{className:"w-full max-w-md mx-4",children:[e.jsx(f,{children:e.jsx(g,{children:"Mark Exit"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(J,{value:n?String(n):void 0,onChange:t=>G(t),label:"Exit Gate"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"Cancel"}),e.jsx(i,{onClick:U,disabled:!n||p.isPending,className:"flex-1",children:p.isPending?"Processing...":"Confirm Exit"})]})]})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(o,{children:[e.jsx(f,{children:e.jsx(g,{className:"text-lg",children:"Entry Information"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entry Gate"}),e.jsx("p",{className:"font-medium",children:s.gate_in?.name||"-"}),s.gate_in?.location&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.gate_in.location})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exit Gate"}),e.jsx("p",{className:"font-medium",children:s.gate_out?.name||"-"}),s.gate_out?.location&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.gate_out.location})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(h,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entry Time"}),e.jsx("p",{className:"font-medium",children:d(s.entry_time)})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(h,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exit Time"}),e.jsx("p",{className:"font-medium",children:d(s.exit_time)})]})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(h,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Duration"}),e.jsx("p",{className:"font-medium text-lg",children:V(s.entry_time,s.exit_time)})]})]})}),s.purpose&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purpose"}),e.jsx("p",{className:"font-medium",children:s.purpose})]})]})}),s.vehicle_no&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Vehicle Number"}),e.jsx("p",{className:"font-medium",children:s.vehicle_no})]})]})}),s.remarks&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Remarks"}),e.jsx("p",{className:"font-medium",children:s.remarks})]})]})})]})]}),e.jsxs(o,{children:[e.jsx(f,{children:e.jsx(g,{className:"text-lg",children:m?"Visitor Details":"Labour Details"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium",children:c?.name||s.name_snapshot})]})]}),c?.mobile&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mobile"}),e.jsx("p",{className:"font-medium",children:c.mobile})]})]}),m&&r&&e.jsxs(e.Fragment,{children:[r.company_name&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Company"}),e.jsx("p",{className:"font-medium",children:r.company_name})]})]}),r.id_proof_type&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ID Proof"}),e.jsxs("p",{className:"font-medium",children:[r.id_proof_type,": ",r.id_proof_no]})]})]})]}),!m&&a&&e.jsxs(e.Fragment,{children:[a.contractor_name&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contractor"}),e.jsx("p",{className:"font-medium",children:a.contractor_name})]})]}),a.skill_type&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Skill Type"}),e.jsx("p",{className:"font-medium",children:a.skill_type})]})]}),a.permit_valid_till&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(h,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Permit Valid Till"}),e.jsx("p",{className:"font-medium",children:a.permit_valid_till})]})]})]}),(s.photo_snapshot||c?.photo)&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Photo"}),e.jsx("img",{src:s.photo_snapshot||c?.photo,alt:"Person",className:"w-24 h-24 rounded-lg object-cover border"})]})]})]})]}),e.jsx(o,{children:e.jsx(x,{className:"py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Created: ",d(s.created_at)]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Updated: ",d(s.updated_at)]}),s.approved_by&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Approved by: Employee #",s.approved_by]})]})]})})})]})}export{ve as default};
