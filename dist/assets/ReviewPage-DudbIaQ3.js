import{a as Y,H as $,r as x,j as e,B as l,C as d,b as u,c as h,e as m,L as s,T as X,U as Z,O as ee,J as H}from"./index-BJbr7dGT.js";import{E as se,g as te}from"./status.constants-CKvLNexP.js";import{a as T,g as re,b as ae}from"./error-qMYEww3Q.js";import{u as ie}from"./useScrollToError-ByUJimjt.js";import{d as ne,e as ce}from"./maintenance.queries-C3KH7nxf.js";import{s as D}from"./securityCheck.api-BXQz3BqG.js";import{u as le}from"./useEntryId-BeYntrIu.js";import{C as M}from"./circle-alert-DDfM1UF8.js";import{A as L}from"./arrow-left-CSneh59K.js";import{F as A}from"./file-check-90pIzKK0.js";import{C as F}from"./clock-CJiAueV2.js";import{S as P}from"./shield-check-D0nelLwq.js";import{W as q}from"./wrench-ClLV1Mkl.js";import{T as de}from"./triangle-alert-Dgrezy9J.js";import{F as R}from"./file-text-DOTXvyIB.js";import{C as g}from"./circle-check-DziCER4n.js";import{C as me}from"./circle-x-D-Gwxygr.js";import"./useMutation-B7kknB8H.js";function oe({status:a}){return e.jsx("span",{className:H("px-2 py-1 rounded-full text-xs font-medium",te(a)),children:a})}function xe({level:a}){const n=()=>{switch(a.toUpperCase()){case"CRITICAL":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";case"HIGH":return"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400";case"MEDIUM":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400";case"LOW":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"}};return e.jsx("span",{className:H("px-2 py-1 rounded-full text-xs font-medium",n()),children:a})}function b({value:a}){return a?e.jsx(g,{className:"h-5 w-5 text-green-500"}):e.jsx(me,{className:"h-5 w-5 text-red-500"})}function ue({onNavigateToDashboard:a,onNavigateToHome:n}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background",children:[e.jsx("div",{className:"relative mb-8",children:e.jsxs("svg",{className:"h-32 w-32 text-green-500",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"animate-draw-circle",style:{strokeDasharray:283,strokeDashoffset:283}}),e.jsx("path",{d:"M30 50 L45 65 L70 35",fill:"none",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-draw-check",style:{strokeDasharray:60,strokeDashoffset:60}})]})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold text-foreground opacity-0 animate-fade-in-delay-1",children:"Entry Completed!"}),e.jsx("p",{className:"mb-12 text-muted-foreground opacity-0 animate-fade-in-delay-2",children:"Maintenance gate entry has been successfully completed"}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row opacity-0 animate-fade-in-delay-3",children:[e.jsxs(l,{size:"lg",onClick:a,className:"min-w-[200px]",children:[e.jsx(q,{className:"mr-2 h-5 w-5"}),"Maintenance Dashboard"]}),e.jsxs(l,{size:"lg",variant:"outline",onClick:n,className:"min-w-[200px]",children:[e.jsx(ee,{className:"mr-2 h-5 w-5"}),"Home"]})]})]})}function Me(){const a=Y(),n=$(),{entryId:o,entryIdNumber:j,isEditMode:B}=le(),[k,p]=x.useState(!1),[w,C]=x.useState(!1),[V,K]=x.useState(!1),[_,Q]=x.useState(!1),f=()=>{n.invalidateQueries({queryKey:["vehicleEntries"]}),n.invalidateQueries({queryKey:["maintenanceFullView"]}),a("/gate/maintenance")},U=()=>{n.invalidateQueries({queryKey:["vehicleEntries"]}),n.invalidateQueries({queryKey:["maintenanceFullView"]}),a("/")},[N,c]=x.useState({});ie(N);const{data:t,isLoading:O,error:S}=ne(j),W=ce(),E=()=>{a(B&&o?`/gate/maintenance/edit/${o}/attachments`:`/gate/maintenance/new/attachments?entryId=${o}`)},z=async()=>{if(!o){c({general:"Entry ID is missing."});return}c({}),p(!0);try{const i=await D.get(j);if(!i.id){c({general:"Security check data not found. Please complete security check first."}),p(!1);return}await D.submit(i.id),Q(!0),n.invalidateQueries({queryKey:["maintenanceFullView",j]})}catch(i){const v=i,J=v.message||v.detail||"Failed to submit security check";c({general:J})}finally{p(!1)}},G=async()=>{if(!o){c({general:"Entry ID is missing."});return}c({}),C(!0);try{await W.mutateAsync(j),K(!0)}catch(i){T(i)?c({general:"Cannot complete the entry at the moment. Please try again later."}):c({general:ae(i,"Failed to complete gate entry")})}finally{C(!1)}},I=i=>new Date(i).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});if(V)return e.jsx(ue,{onNavigateToDashboard:f,onNavigateToHome:U});if(O)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(S){const i=T(S)?re():"Failed to load gate entry details. Please try again.";return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"rounded-md bg-destructive/15 p-4 text-sm text-destructive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:i})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(l,{type:"button",variant:"outline",onClick:E,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Previous"]})})]})}if(!t)return null;const y=t.gate_entry.status===se.COMPLETED,r=t.maintenance_details;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(A,{className:"h-8 w-8"}),"Final Review"]}),e.jsx("p",{className:"text-muted-foreground",children:"Review all details before completing the maintenance gate entry"})]}),N.general&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),N.general]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Gate Entry Information"]}),e.jsx(oe,{status:t.gate_entry.status})]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Entry Number"}),e.jsx("p",{className:"font-medium",children:t.gate_entry.entry_no})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Entry Type"}),e.jsx("p",{className:"font-medium",children:t.gate_entry.entry_type})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Created At"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),I(t.gate_entry.created_at)]})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Locked"}),e.jsx("p",{className:"font-medium",children:t.gate_entry.is_locked?"Yes":"No"})]})]})})]}),e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Vehicle Details"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Vehicle Number"}),e.jsx("p",{className:"font-medium",children:t.vehicle.vehicle_number})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Vehicle Type"}),e.jsx("p",{className:"font-medium",children:t.vehicle.vehicle_type.name})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Capacity"}),e.jsxs("p",{className:"font-medium",children:[t.vehicle.capacity_ton," Tons"]})]})]})})]}),e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Driver Details"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Driver Name"}),e.jsx("p",{className:"font-medium",children:t.driver.name})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Mobile Number"}),e.jsx("p",{className:"font-medium",children:t.driver.mobile_no})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"License Number"}),e.jsx("p",{className:"font-medium",children:t.driver.license_no})]})]})})]}),t.security_check&&e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Security Check"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:t.security_check.vehicle_condition_ok}),e.jsx("span",{className:"text-sm",children:"Vehicle Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:t.security_check.tyre_condition_ok}),e.jsx("span",{className:"text-sm",children:"Tyre Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:t.security_check.alcohol_test_passed}),e.jsx("span",{className:"text-sm",children:"Alcohol Test Passed"})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Inspected By"}),e.jsx("p",{className:"font-medium",children:t.security_check.inspected_by})]})]}),t.security_check.remarks&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Remarks"}),e.jsx("p",{className:"text-sm",children:t.security_check.remarks})]})]})]}),r&&e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Maintenance Details"]}),e.jsx(xe,{level:r.urgency_level})]})}),e.jsxs(m,{className:"space-y-6",children:[(r.urgency_level==="CRITICAL"||r.urgency_level==="HIGH")&&e.jsxs("div",{className:"rounded-md bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-3 flex items-start gap-3",children:[e.jsx(de,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-200",children:[r.urgency_level==="CRITICAL"?"Critical":"High"," ","Priority Item"]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Please ensure expedited processing."})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Work Order Number"}),e.jsx("p",{className:"font-medium text-primary",children:r.work_order_number})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Maintenance Type"}),e.jsx("p",{className:"font-medium",children:r.maintenance_type})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Supplier Name"}),e.jsx("p",{className:"font-medium",children:r.supplier_name})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2 mb-4",children:[e.jsx(R,{className:"h-4 w-4"}),"Material Information"]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Material Description"}),e.jsx("p",{className:"font-medium",children:r.material_description})]}),r.part_number&&e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Part Number / Model Number"}),e.jsx("p",{className:"font-medium",children:r.part_number})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Quantity"}),e.jsxs("p",{className:"font-medium text-lg text-primary",children:[r.quantity," ",r.unit]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2 mb-4",children:[e.jsx(R,{className:"h-4 w-4"}),"Documentation & Assignment"]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[r.invoice_number&&e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Invoice Number"}),e.jsx("p",{className:"font-medium",children:r.invoice_number})]}),r.equipment_id&&e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Equipment ID"}),e.jsx("p",{className:"font-medium",children:r.equipment_id})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Receiving Department"}),e.jsx("p",{className:"font-medium",children:r.receiving_department})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Inward Time"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),I(r.inward_time)]})]}),e.jsxs("div",{children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Created By"}),e.jsx("p",{className:"font-medium",children:r.created_by})]})]})]}),r.remarks&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(s,{className:"text-muted-foreground text-xs",children:"Remarks / Notes"}),e.jsx("p",{className:"text-sm",children:r.remarks})]})]})]}),!y&&e.jsx(d,{className:"border-primary/50",children:e.jsx(m,{className:"pt-6",children:t.security_check?.is_submitted||_?e.jsxs("div",{className:"flex items-center gap-3 text-green-600 dark:text-green-400",children:[e.jsx(g,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Security check submitted. Ready to complete entry."})]}):e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(s,{className:"text-base font-medium",children:"Security Inspection Pending"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Submit security check to proceed with completing the entry"})]})})})})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-between",children:[e.jsxs(l,{type:"button",variant:"outline",onClick:E,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Previous"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:f,children:"Cancel"}),!y&&e.jsx(e.Fragment,{children:!t?.security_check?.is_submitted&&!_?e.jsxs(l,{type:"button",onClick:z,disabled:k,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),k?"Submitting...":"Submit Security"]}):e.jsxs(l,{type:"button",onClick:G,disabled:w,children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),w?"Completing...":"Complete Entry"]})}),y&&e.jsxs(l,{type:"button",onClick:f,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Entry Completed"]})]})]})]})}export{Me as default};
