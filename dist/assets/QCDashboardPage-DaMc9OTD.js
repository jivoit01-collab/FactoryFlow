import{a as U,E as $,r as B,j as e,B as o,C as f,e as b,au as W,Y as m}from"./index-DpV7uZj9.js";import{D as z}from"./DateRangePicker-BWxq8wTv.js";import"./driver.schema-DO7pkEio.js";import"./vehicle.schema-Cw9NqPJ5.js";import{u as G,a as V,b as X,c as Y,d as H}from"./inspection.queries-CW3QrU93.js";import{W as n}from"./qc.constants-CYo2Vk8z.js";import{P as J}from"./plus-CV3il7Op.js";import{S as Z,R as j}from"./shield-x-CYJ54Fcd.js";import{C as K}from"./circle-alert-qtNSk3Tj.js";import{C as ee}from"./circle-x-TIKhQOEZ.js";import{C as se}from"./circle-check-mFk-j24l.js";import{U as re}from"./user-check-Bx905T9C.js";import{F as x}from"./file-text-BP5l3tk-.js";import{C as te}from"./clock-DV_YYAdg.js";import"./validation.constants-DHFF3fUR.js";import"./schemas-D8ebsZBL.js";import"./useMutation-DX1k4_5x.js";import"./send-uL4QW9qx.js";const ae={pending:{label:"Pending",color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",icon:te,link:"/qc/pending?status=pending"},draft:{label:"Draft",color:"text-gray-600 dark:text-gray-400",bgColor:"bg-gray-50 dark:bg-gray-900/20 border-gray-200 dark:border-gray-800",icon:x,link:"/qc/pending?status=draft"},awaiting_approval:{label:"Awaiting",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",icon:re,link:"/qc/approvals"},approved:{label:"Approved",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",icon:se,link:"/qc/pending?status=approved"},rejected:{label:"Rejected",color:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",icon:ee,link:"/qc/pending?status=rejected"}},ne=["pending","draft","awaiting_approval","approved","rejected"],ie=(r,i)=>{if(!i)return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";switch(r){case n.DRAFT:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";case n.SUBMITTED:case n.QA_CHEMIST_APPROVED:return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case n.QAM_APPROVED:case n.COMPLETED:return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"REJECTED":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}};function Ce(){const r=U(),{dateRange:i,dateRangeAsDateObjects:w,setDateRange:g}=$(),l=B.useMemo(()=>({from_date:i.from,to_date:i.to}),[i]),{data:d=[],isLoading:v,error:N,refetch:y}=G(l),{data:k=[],isLoading:C,error:_}=V(l),{data:A=[],isLoading:D,error:E}=X(l),{data:L=[],isLoading:P,error:R}=Y(l),{data:S=[],isLoading:q,error:T}=H(l),I=v||C||D||P||q,p=N||_||E||R||T,c=p,h=c?.status===403,a={pending:d.filter(s=>!s.has_inspection).length,draft:d.filter(s=>s.has_inspection&&s.inspection_status===n.DRAFT).length,awaiting_approval:k.length+A.length,approved:L.length,rejected:S.length},F=a.pending+a.draft+a.awaiting_approval,u=()=>{y()},M=s=>{if(!s)return"-";try{return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Quality Control"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw material inspections and quality approvals"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsx(z,{date:w,onDateChange:s=>{s&&"from"in s?g(s):g(void 0)}}),e.jsxs(o,{onClick:()=>r("/qc/pending"),className:"w-full sm:w-auto",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Start Inspection"]})]})]}),I?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs(e.Fragment,{children:[h&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-destructive/50 bg-destructive/5",children:[e.jsx(Z,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permission Denied"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:c?.message||"You do not have permission to view this data."})]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>u(),children:e.jsx(j,{className:"h-4 w-4"})})]}),p&&!h&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-yellow-500/50 bg-yellow-50 dark:bg-yellow-900/10",children:[e.jsx(K,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Failed to Load"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:c?.message||"An error occurred while loading the dashboard."})]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>u(),children:e.jsx(j,{className:"h-4 w-4"})})]}),e.jsx(f,{className:"bg-primary/5 border-primary/20 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>r("/qc/pending?status=actionable"),children:e.jsxs(b,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"Pending Actions"})]}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:F})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-primary/20 flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold text-yellow-600 dark:text-yellow-400",children:a.pending})," ","Pending"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold text-gray-600 dark:text-gray-400",children:a.draft})," ","Draft"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:a.awaiting_approval})," ","Awaiting"]})]}),e.jsx(m,{className:"h-4 w-4"})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Recent Arrival Slips"}),e.jsxs("button",{onClick:()=>r("/qc/pending"),className:"text-xs text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1",children:["Show more",e.jsx(m,{className:"h-3 w-3"})]})]}),d.length===0?e.jsx("div",{className:"flex items-center justify-center h-16 text-sm text-muted-foreground border rounded-lg",children:"No arrival slips yet"}):e.jsx("div",{className:"space-y-2",children:d.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>s.has_inspection?r(`/qc/inspections/${s.arrival_slip.id}`):r(`/qc/inspections/${s.arrival_slip.id}/new`),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"font-medium text-sm",children:s.arrival_slip.entry_no}),e.jsx("span",{className:`inline-flex items-center rounded-full px-1.5 py-0.5 text-[10px] font-medium ${ie(s.inspection_status,s.has_inspection)}`,children:s.has_inspection?s.inspection_status:"Pending"}),e.jsxs("span",{className:"text-xs text-muted-foreground hidden sm:inline truncate",children:[s.arrival_slip.particulars," â€¢ ",s.arrival_slip.party_name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:M(s.arrival_slip.submitted_at)}),e.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]})]},s.arrival_slip.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Status Overview"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3",children:ne.map(s=>{const t=ae[s],O=t.icon,Q=a[s]||0;return e.jsx(f,{className:`${t.bgColor} border cursor-pointer hover:shadow-md transition-shadow`,onClick:()=>r(t.link),children:e.jsxs(b,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{className:`h-4 w-4 ${t.color}`}),e.jsx("span",{className:`text-xl font-bold ${t.color}`,children:Q})]}),e.jsx("p",{className:`mt-1 text-xs font-medium ${t.color}`,children:t.label})]})},s)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(o,{variant:"outline",className:"h-auto py-3 flex flex-col items-center gap-1",onClick:()=>r("/qc/master/material-types"),children:[e.jsx(x,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Material Types"})]}),e.jsxs(o,{variant:"outline",className:"h-auto py-3 flex flex-col items-center gap-1",onClick:()=>r("/qc/master/parameters"),children:[e.jsx(x,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"QC Parameters"})]})]})]})]})]})}export{Ce as default};
