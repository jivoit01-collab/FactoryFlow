import{a as T,F as E,r as P,j as e,B as l,C as b,e as j,au as q,_ as c}from"./index-DyvVaGgC.js";import{D as F}from"./DateRangePicker-DzhKv871.js";import"./driver.schema-DZt_XaHY.js";import"./vehicle.schema-BmxwMEOL.js";import{u as O,a as I}from"./inspection.queries-B2jVazuF.js";import{W as L}from"./qc.constants-CDUe_Fvf.js";import{P as U}from"./plus-CXfKS_Mb.js";import{S as $,R as w}from"./shield-x-DNo7AgOw.js";import{C as M}from"./circle-alert-Cuo8dvWx.js";import{C as Q}from"./circle-x-CubaKgLv.js";import{C as B}from"./circle-check-BLAiMsHP.js";import{U as G}from"./user-check-4qZKe4bO.js";import{F as m}from"./file-text-CltYeSo-.js";import{C as W}from"./clock-DtVijlIT.js";import"./validation.constants-C18ePHzl.js";import"./schemas-D8ebsZBL.js";import"./useMutation--jrFaXO4.js";import"./send-B8XFJ6Nv.js";const z={pending:{label:"Pending",color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",icon:W,link:"/qc/pending?status=pending"},draft:{label:"Draft",color:"text-gray-600 dark:text-gray-400",bgColor:"bg-gray-50 dark:bg-gray-900/20 border-gray-200 dark:border-gray-800",icon:m,link:"/qc/pending?status=draft"},awaiting_approval:{label:"Awaiting",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",icon:G,link:"/qc/approvals"},approved:{label:"Approved",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",icon:B,link:"/qc/pending?status=approved"},rejected:{label:"Rejected",color:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",icon:Q,link:"/qc/pending?status=rejected"}},V=["pending","draft","awaiting_approval","approved","rejected"],X={NOT_STARTED:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",SUBMITTED:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",QA_CHEMIST_APPROVED:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",QAM_APPROVED:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",REJECTED:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"};function H(r){return r.inspection_id?`/qc/inspections/${r.arrival_slip_id}`:`/qc/inspections/${r.arrival_slip_id}/new`}function pe(){const r=T(),{dateRange:o,dateRangeAsDateObjects:N,setDateRange:x}=E(),g=P.useMemo(()=>({from_date:o.from,to_date:o.to}),[o]),{data:n,isLoading:v,error:y,refetch:k}=O(g),{data:p=[],isLoading:C,error:_}=I(g),A=v||C,u=y||_,i=u,h=i?.status===403,a={pending:n?.not_started??0,draft:n?.draft??0,awaiting_approval:(n?.awaiting_chemist??0)+(n?.awaiting_qam??0),approved:n?.completed??0,rejected:n?.rejected??0},S=a.pending+a.draft+a.awaiting_approval,f=()=>{k()},D=s=>{if(!s)return"-";try{return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Quality Control"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage raw material inspections and quality approvals"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsx(F,{date:N,onDateChange:s=>{s&&"from"in s?x(s):x(void 0)}}),e.jsxs(l,{onClick:()=>r("/qc/pending"),className:"w-full sm:w-auto",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Start Inspection"]})]})]}),A?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs(e.Fragment,{children:[h&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-destructive/50 bg-destructive/5",children:[e.jsx($,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permission Denied"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i?.message||"You do not have permission to view this data."})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>f(),children:e.jsx(w,{className:"h-4 w-4"})})]}),u&&!h&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-yellow-500/50 bg-yellow-50 dark:bg-yellow-900/10",children:[e.jsx(M,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Failed to Load"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i?.message||"An error occurred while loading the dashboard."})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>f(),children:e.jsx(w,{className:"h-4 w-4"})})]}),e.jsx(b,{className:"bg-primary/5 border-primary/20 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>r("/qc/pending?status=actionable"),children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"Pending Actions"})]}),e.jsx("span",{className:"text-3xl font-bold text-primary",children:S})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-primary/20 flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold text-yellow-600 dark:text-yellow-400",children:a.pending})," ","Pending"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold text-gray-600 dark:text-gray-400",children:a.draft})," ","Draft"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:a.awaiting_approval})," ","Awaiting"]})]}),e.jsx(c,{className:"h-4 w-4"})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Recent Arrival Slips"}),e.jsxs("button",{onClick:()=>r("/qc/pending"),className:"text-xs text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1",children:["Show more",e.jsx(c,{className:"h-3 w-3"})]})]}),p.length===0?e.jsx("div",{className:"flex items-center justify-center h-16 text-sm text-muted-foreground border rounded-lg",children:"No arrival slips yet"}):e.jsx("div",{className:"space-y-2",children:p.slice(0,3).map(s=>{const t=L[s.workflow_status],d=X[s.workflow_status]||"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";return e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>r(H(s)),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"font-medium text-sm",children:s.entry_no}),e.jsx("span",{className:`inline-flex items-center rounded-full px-1.5 py-0.5 text-[10px] font-medium ${d}`,children:t?.label||s.workflow_status}),e.jsxs("span",{className:"text-xs text-muted-foreground hidden sm:inline truncate",children:[s.item_name," â€¢ ",s.party_name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:D(s.submitted_at)}),e.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]})]},s.arrival_slip_id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Status Overview"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3",children:V.map(s=>{const t=z[s],d=t.icon,R=a[s]||0;return e.jsx(b,{className:`${t.bgColor} border cursor-pointer hover:shadow-md transition-shadow`,onClick:()=>r(t.link),children:e.jsxs(j,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:`h-4 w-4 ${t.color}`}),e.jsx("span",{className:`text-xl font-bold ${t.color}`,children:R})]}),e.jsx("p",{className:`mt-1 text-xs font-medium ${t.color}`,children:t.label})]})},s)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(l,{variant:"outline",className:"h-auto py-3 flex flex-col items-center gap-1",onClick:()=>r("/qc/master/material-types"),children:[e.jsx(m,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Material Types"})]}),e.jsxs(l,{variant:"outline",className:"h-auto py-3 flex flex-col items-center gap-1",onClick:()=>r("/qc/master/parameters"),children:[e.jsx(m,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"QC Parameters"})]})]})]})]})]})}export{pe as default};
