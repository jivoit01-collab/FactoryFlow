import{F as R,G as Q,H as B,r as y,j as e,a as ae,C as I,b as F,c as T,e as k,L as v,I as g,J as x,B as C}from"./index-BlttmsHz.js";import{E as re}from"./status.constants-B0MYmmeb.js";import{b as se}from"./validation.constants-DHFF3fUR.js";import{i as ie,a as ne,g as le,b as ce}from"./error-qMYEww3Q.js";import{u as oe}from"./useScrollToError-BbXkMWnH.js";import{u as V,a as me}from"./useMutation-TnQ6hR0R.js";import{a as de}from"./vehicleEntry.queries-CFavWUt-.js";import{F as ue}from"./FillDataAlert-jaU4Alzu.js";import{S as pe}from"./SearchableSelect-CkWsjKQK.js";import{D as he}from"./DepartmentSelect---YN9hxJ.js";import"./driver.schema-DO7pkEio.js";import"./vehicle.schema-Cw9NqPJ5.js";import{U as ve}from"./UnitSelect-DTeJJ9hq.js";import{u as Ne}from"./useEntryId-Cz9iv8zj.js";import{C as ge}from"./circle-alert-CUcQmltW.js";import{P as K}from"./package-Bfpq0z6i.js";import{S as xe}from"./scale-BXiu5pVW.js";import{F as be}from"./file-text-CHubKTsl.js";import"./triangle-alert-CadjuZfY.js";import"./circle-x-CXmN1Y2K.js";import"./circle-check-oo-uuCfp.js";import"./clock-IkmY-E9y.js";import"./plus-9PfPuXLy.js";import"./schemas-D8ebsZBL.js";import"./maintenance.queries-B1OQxxmT.js";const $={async getCategories(){return(await R.get(Q.DAILY_NEEDS_GATEIN.CATEGORIES)).data},async get(n){return(await R.get(Q.DAILY_NEEDS_GATEIN.GET(n))).data},async create(n,i){const s=new FormData;return s.append("item_category",i.item_category.toString()),s.append("supplier_name",i.supplier_name),s.append("material_name",i.material_name),s.append("quantity",i.quantity.toString()),s.append("unit",i.unit.toString()),s.append("receiving_department",i.receiving_department),s.append("bill_number",i.bill_number),s.append("delivery_challan_number",i.delivery_challan_number),s.append("vehicle_or_person_name",i.vehicle_or_person_name),s.append("contact_number",i.contact_number),i.canteen_supervisor&&s.append("canteen_supervisor",i.canteen_supervisor),i.remarks&&s.append("remarks",i.remarks),(await R.post(Q.DAILY_NEEDS_GATEIN.CREATE(n),s,{headers:{"Content-Type":"multipart/form-data"}})).data}};function ye(n=!0){return V({queryKey:["dailyNeedCategories"],queryFn:()=>$.getCategories(),enabled:n})}function fe(n){return V({queryKey:["dailyNeed",n],queryFn:()=>$.get(n),enabled:!!n})}function je(n){const i=B();return me({mutationFn:s=>$.create(n,s),onSuccess:()=>{i.invalidateQueries({queryKey:["dailyNeed"]}),i.invalidateQueries({queryKey:["vehicleEntries"]})}})}function _e({value:n,onChange:i,placeholder:s="Select category",disabled:u=!1,error:b,label:S,required:D=!1,initialDisplayText:P}){const[w,l]=y.useState(!1),{data:A=[],isLoading:j,isError:c}=ye(w);return e.jsx(pe,{value:n?String(n):void 0,items:A,isLoading:j,isError:c,placeholder:s,disabled:u,error:b,label:S,required:D,inputId:"category-select",inputClassName:"border-2 font-medium",defaultDisplayText:P,getItemKey:d=>d.id,getItemLabel:d=>d.category_name,loadingText:"Loading categories...",emptyText:"No categories available",notFoundText:"No categories found",onOpenChange:l,onItemSelect:d=>{i(d.id,d.category_name)},onClear:()=>{i("","")}})}function Je(){const n=ae(),i=B(),{entryId:s,entryIdNumber:u,isEditMode:b}=Ne(),S=3,D=4,P=S/D*100,{data:w}=de(b&&u?u:null),{data:l,isLoading:A,error:j}=fe(b&&u?u:null),c=je(u||0),[d,Y]=y.useState(!1),[E,H]=y.useState(!1),[q,J]=y.useState(!1),N=b&&!d,O=ie(j),L=ne(j),[r,M]=y.useState({itemCategory:"",supplierName:"",materialName:"",quantity:"0",unit:"",unitName:"",receivingDepartment:"",billNumber:"",deliveryChallanNumber:"",canteenSupervisor:"",vehicleOrPersonName:"",contactNumber:"",remarks:""}),[t,f]=y.useState({});oe(t);const o=N&&!E&&!O||O&&!d,z=N&&w?.status!==re.COMPLETED;y.useEffect(()=>{if(N&&l){const a=l.item_category?.id||"",p=l.receiving_department?.id||"";M({itemCategory:a,supplierName:l.supplier_name||"",materialName:l.material_name||"",quantity:l.quantity?.toString()||"0",unit:typeof l.unit=="object"?l.unit?.id?.toString()||"":l.unit?.toString()||"",unitName:typeof l.unit=="object"&&l.unit?.name||"",receivingDepartment:p,billNumber:l.bill_number||"",deliveryChallanNumber:l.delivery_challan_number||"",canteenSupervisor:l.canteen_supervisor||"",vehicleOrPersonName:l.vehicle_or_person_name||"",contactNumber:l.contact_number||"",remarks:l.remarks||""})}},[N,l]);const m=(a,p)=>{o||(M(h=>({...h,[a]:p})),t[a]&&f(h=>{const _={...h};return delete _[a],_}))},W=()=>{n(b&&s?`/gate/daily-needs/edit/${s}/step2`:`/gate/daily-needs/new/step2?entryId=${s}`)},X=()=>{i.invalidateQueries({queryKey:["vehicleEntries"]}),n("/gate/daily-needs")},Z=()=>{Y(!0)},ee=()=>{H(!0)},G=async()=>{if(!s||!u){f({general:"Entry ID is missing. Please go back to step 1."});return}if(N&&!E){n(`/gate/daily-needs/edit/${s}/attachments`);return}f({});const a={};if(r.itemCategory||(a.itemCategory="Please select an item category"),r.supplierName||(a.supplierName="Please enter supplier/vendor name"),r.materialName||(a.materialName="Please enter material name"),(!r.quantity||parseFloat(r.quantity)<=0)&&(a.quantity="Please enter a valid quantity"),r.unit||(a.unit="Please select unit"),r.receivingDepartment||(a.receivingDepartment="Please select receiving department"),r.billNumber||(a.billNumber="Please enter bill / challan number"),r.deliveryChallanNumber||(a.deliveryChallanNumber="Please enter delivery challan number"),r.vehicleOrPersonName||(a.vehicleOrPersonName="Please enter vehicle / person name"),r.contactNumber?se.phone.test(r.contactNumber)||(a.contactNumber="Please enter a valid 10-digit phone number"):a.contactNumber="Please enter contact number",Object.keys(a).length>0){f(a);return}try{await c.mutateAsync({item_category:r.itemCategory,supplier_name:r.supplierName,material_name:r.materialName,quantity:parseFloat(r.quantity),unit:parseInt(r.unit),receiving_department:r.receivingDepartment.toString(),bill_number:r.billNumber,delivery_challan_number:r.deliveryChallanNumber,canteen_supervisor:r.canteenSupervisor||void 0,vehicle_or_person_name:r.vehicleOrPersonName,contact_number:r.contactNumber,remarks:r.remarks||void 0}),J(!0),n(b&&s?`/gate/daily-needs/edit/${s}/attachments`:`/gate/daily-needs/new/attachments?entryId=${s}`)}catch(p){const h=p;if(h.errors){const _={};Object.entries(h.errors).forEach(([te,U])=>{Array.isArray(U)&&U.length>0&&(_[te]=U[0])}),f(_)}else f({general:h.message||"Failed to save daily needs entry"})}};return N&&A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight",children:["Daily Needs Entry - Step ",S," of ",D]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${P}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground min-w-[3rem]",children:[Math.round(P),"%"]})]})]}),(L||t.general)&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),L?le():t.general]}),N&&O&&!d&&!L&&e.jsx(ue,{message:ce(j,"Daily need entry does not exist"),onFillData:Z}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Item Category"]})}),e.jsx(k,{children:e.jsx(_e,{value:r.itemCategory,onChange:a=>{m("itemCategory",a)},placeholder:"Select category",disabled:o||c.isPending,error:t.itemCategory||t.item_category,label:"Item Category",required:!0,initialDisplayText:l?.item_category?.category_name})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Material Details"]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"supplierName",children:["Supplier / Vendor Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"supplierName",placeholder:"Supplier / Vendor name",value:r.supplierName,onChange:a=>m("supplierName",a.target.value),disabled:o||c.isPending,className:x("border-2 font-medium",(t.supplierName||t.supplier_name)&&"border-destructive")}),t.supplierName&&e.jsx("p",{className:"text-sm text-destructive",children:t.supplierName}),t.supplier_name&&e.jsx("p",{className:"text-sm text-destructive",children:t.supplier_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"materialName",children:["Material Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"materialName",placeholder:"Item description",value:r.materialName,onChange:a=>m("materialName",a.target.value),disabled:o||c.isPending,className:x("border-2 font-medium",(t.materialName||t.material_name)&&"border-destructive")}),t.materialName&&e.jsx("p",{className:"text-sm text-destructive",children:t.materialName}),t.material_name&&e.jsx("p",{className:"text-sm text-destructive",children:t.material_name})]})]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Quantity & Unit"]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"quantity",children:["Quantity ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"quantity",type:"number",min:"0",placeholder:"0",value:r.quantity,onChange:a=>m("quantity",a.target.value),disabled:o||c.isPending,className:x("border-2 font-medium",t.quantity&&"border-destructive")}),t.quantity&&e.jsx("p",{className:"text-sm text-destructive",children:t.quantity})]}),e.jsx(ve,{value:r.unit||void 0,onChange:(a,p)=>{m("unit",a),M(h=>({...h,unitName:p}))},placeholder:"Select unit",disabled:o||c.isPending,error:t.unit,label:"Unit",required:!0,initialDisplayText:r.unitName||void 0}),e.jsx(he,{value:r.receivingDepartment,onChange:a=>{m("receivingDepartment",a)},placeholder:"Select Department",disabled:o||c.isPending,error:t.receivingDepartment||t.receiving_department,label:"Receiving Department",required:!0,initialDisplayText:l?.receiving_department?.name})]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Documentation & Contact"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"billNumber",children:["Bill / Challan Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"billNumber",placeholder:"Bill or Challan no.",value:r.billNumber,onChange:a=>m("billNumber",a.target.value),disabled:o||c.isPending,className:x("border-2 font-medium",(t.billNumber||t.bill_number)&&"border-destructive")}),t.billNumber&&e.jsx("p",{className:"text-sm text-destructive",children:t.billNumber}),t.bill_number&&e.jsx("p",{className:"text-sm text-destructive",children:t.bill_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"deliveryChallanNumber",children:["Delivery Challan Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"deliveryChallanNumber",placeholder:"Delivery challan",value:r.deliveryChallanNumber,onChange:a=>m("deliveryChallanNumber",a.target.value),disabled:o||c.isPending,className:x("border-2 font-medium",(t.deliveryChallanNumber||t.delivery_challan_number)&&"border-destructive")}),t.deliveryChallanNumber&&e.jsx("p",{className:"text-sm text-destructive",children:t.deliveryChallanNumber}),t.delivery_challan_number&&e.jsx("p",{className:"text-sm text-destructive",children:t.delivery_challan_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"canteenSupervisor",children:"Supervisor Name (if applicable)"}),e.jsx(g,{id:"canteenSupervisor",placeholder:"Supervisor name",value:r.canteenSupervisor,onChange:a=>m("canteenSupervisor",a.target.value),disabled:o||c.isPending,className:"border-2 font-medium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"vehicleOrPersonName",children:["Vehicle / Person Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"vehicleOrPersonName",placeholder:"eg: Tempo DL01AB2236",value:r.vehicleOrPersonName,onChange:a=>m("vehicleOrPersonName",a.target.value),disabled:o||c.isPending,className:x("border-2 font-medium",(t.vehicleOrPersonName||t.vehicle_or_person_name)&&"border-destructive")}),t.vehicleOrPersonName&&e.jsx("p",{className:"text-sm text-destructive",children:t.vehicleOrPersonName}),t.vehicle_or_person_name&&e.jsx("p",{className:"text-sm text-destructive",children:t.vehicle_or_person_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"contactNumber",children:["Contact Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"contactNumber",placeholder:"9876543210",value:r.contactNumber,onChange:a=>{const p=a.target.value.replace(/[^0-9]/g,"").slice(0,10);m("contactNumber",p)},maxLength:10,disabled:o||c.isPending,className:x("border-2 font-medium",(t.contactNumber||t.contact_number)&&"border-destructive")}),t.contactNumber&&e.jsx("p",{className:"text-sm text-destructive",children:t.contactNumber}),t.contact_number&&e.jsx("p",{className:"text-sm text-destructive",children:t.contact_number})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(v,{htmlFor:"remarks",children:"Remarks / Notes"}),e.jsx("textarea",{id:"remarks",rows:4,className:x("flex w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm font-medium ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"),placeholder:"Additional information...",value:r.remarks,onChange:a=>m("remarks",a.target.value),disabled:o||c.isPending})]})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-end",children:[e.jsx(C,{type:"button",variant:"outline",onClick:W,children:"← Previous"}),e.jsx(C,{type:"button",variant:"outline",onClick:X,children:"Cancel"}),N?e.jsxs(e.Fragment,{children:[z&&!E&&e.jsx(C,{type:"button",onClick:ee,children:"Update"}),e.jsx(C,{type:"button",onClick:G,disabled:c.isPending||q,children:E?c.isPending||q?"Saving...":"Save and Next →":"Next →"})]}):e.jsx(C,{type:"button",onClick:G,disabled:c.isPending||q,children:c.isPending||q?"Saving...":"Save and Next →"})]})]})}export{Je as default};
