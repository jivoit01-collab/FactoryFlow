import{H as T,J as F,K as M,a as X,r as x,j as e,B as c,C as m,b as u,c as h,e as o,L as t,T as Z,U as ee,V as se,M as te}from"./index-DBEH1qDu.js";import{E as k,F as re}from"./status.constants-Cny6xo7u.js";import{a as A,g as ae,b as ie}from"./error-qMYEww3Q.js";import{u as le}from"./useScrollToError-Bp9Zyvvg.js";import{u as ne,a as ce}from"./useMutation-CJTmPedT.js";import{s as I}from"./securityCheck.api-C2j2JSAe.js";import{u as de}from"./useEntryId-DFonXfr0.js";import{C as L}from"./circle-alert-Dv10k1nw.js";import{A as P}from"./arrow-left-CwKx6fQ9.js";import{F as V}from"./file-check-DXx3n6FK.js";import{C as me}from"./clock-Bv5iwEsh.js";import{S as q}from"./shield-check-fsBLaQAS.js";import{P as K}from"./package-MoglU3VL.js";import{F as oe}from"./file-text-DSoScEyL.js";import{P as xe}from"./phone-D-03Vvm2.js";import{C as p}from"./circle-check-B6PCnE2W.js";import{C as ue}from"./circle-x-C4YNsJWO.js";import"./triangle-alert-Bdf7NON0.js";const Q={async get(r){return(await T.get(F.DAILY_NEEDS_GATEIN.FULL_VIEW(r))).data},async complete(r){return(await T.post(F.DAILY_NEEDS_GATEIN.COMPLETE(r))).data}};function he(r){return ne({queryKey:["dailyNeedFullView",r],queryFn:()=>Q.get(r),enabled:!!r})}function je(){const r=M();return ce({mutationFn:i=>Q.complete(i),onSuccess:()=>{r.invalidateQueries({queryKey:["dailyNeedFullView"]}),r.invalidateQueries({queryKey:["vehicleEntries"]}),r.invalidateQueries({queryKey:["dailyNeed"]})}})}function ge({status:r}){const i=()=>{switch(r.toUpperCase()){case k.COMPLETED:return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case k.DRAFT:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400";case"PASSED":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"FAILED":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";case re.PENDING:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400"}};return e.jsx("span",{className:te("px-2 py-1 rounded-full text-xs font-medium",i()),children:r})}function j({value:r}){return r?e.jsx(p,{className:"h-5 w-5 text-green-500"}):e.jsx(ue,{className:"h-5 w-5 text-red-500"})}function pe({onNavigateToDashboard:r,onNavigateToHome:i}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background",children:[e.jsx("div",{className:"relative mb-8",children:e.jsxs("svg",{className:"h-32 w-32 text-green-500",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"animate-draw-circle",style:{strokeDasharray:283,strokeDashoffset:283}}),e.jsx("path",{d:"M30 50 L45 65 L70 35",fill:"none",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-draw-check",style:{strokeDasharray:60,strokeDashoffset:60}})]})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold text-foreground opacity-0 animate-fade-in-delay-1",children:"Entry Completed!"}),e.jsx("p",{className:"mb-12 text-muted-foreground opacity-0 animate-fade-in-delay-2",children:"Daily needs gate entry has been successfully completed"}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row opacity-0 animate-fade-in-delay-3",children:[e.jsxs(c,{size:"lg",onClick:r,className:"min-w-[200px]",children:[e.jsx(K,{className:"mr-2 h-5 w-5"}),"Daily Needs Dashboard"]}),e.jsxs(c,{size:"lg",variant:"outline",onClick:i,className:"min-w-[200px]",children:[e.jsx(se,{className:"mr-2 h-5 w-5"}),"Home"]})]})]})}function Ve(){const r=X(),i=M(),{entryId:d,entryIdNumber:g,isEditMode:R}=de(),[_,N]=x.useState(!1),[w,C]=x.useState(!1),[B,H]=x.useState(!1),[S,O]=x.useState(!1),y=()=>{i.invalidateQueries({queryKey:["vehicleEntries"]}),i.invalidateQueries({queryKey:["dailyNeedFullView"]}),r("/gate/daily-needs")},U=()=>{i.invalidateQueries({queryKey:["vehicleEntries"]}),i.invalidateQueries({queryKey:["dailyNeedFullView"]}),r("/")},[f,n]=x.useState({});le(f);const{data:s,isLoading:G,error:E}=he(g),Y=je(),D=()=>{r(R&&d?`/gate/daily-needs/edit/${d}/attachments`:`/gate/daily-needs/new/attachments?entryId=${d}`)},z=async()=>{if(!d){n({general:"Entry ID is missing."});return}n({}),N(!0);try{const l=await I.get(g);if(!l.id){n({general:"Security check data not found. Please complete security check first."}),N(!1);return}await I.submit(l.id),O(!0),i.invalidateQueries({queryKey:["dailyNeedFullView",g]})}catch(l){const b=l,$=b.message||b.detail||"Failed to submit security check";n({general:$})}finally{N(!1)}},J=async()=>{if(!d){n({general:"Entry ID is missing."});return}n({}),C(!0);try{await Y.mutateAsync(g),H(!0)}catch(l){A(l)?n({general:"Cannot complete the entry at the moment. Please try again later."}):n({general:ie(l,"Failed to complete gate entry")})}finally{C(!1)}},W=l=>new Date(l).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});if(B)return e.jsx(pe,{onNavigateToDashboard:y,onNavigateToHome:U});if(G)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(E){const l=A(E)?ae():"Failed to load gate entry details. Please try again.";return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"rounded-md bg-destructive/15 p-4 text-sm text-destructive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:l})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(c,{type:"button",variant:"outline",onClick:D,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Previous"]})})]})}if(!s)return null;const v=s.gate_entry.status===k.COMPLETED,a=s.daily_need_details;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(V,{className:"h-8 w-8"}),"Final Review"]}),e.jsx("p",{className:"text-muted-foreground",children:"Review all details before completing the daily needs gate entry"})]}),f.general&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),f.general]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Gate Entry Information"]}),e.jsx(ge,{status:s.gate_entry.status})]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Entry Number"}),e.jsx("p",{className:"font-medium",children:s.gate_entry.entry_no})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Entry Type"}),e.jsx("p",{className:"font-medium",children:s.gate_entry.entry_type})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Created At"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4 text-muted-foreground"}),W(s.gate_entry.created_at)]})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Locked"}),e.jsx("p",{className:"font-medium",children:s.gate_entry.is_locked?"Yes":"No"})]})]})})]}),e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Vehicle Details"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Vehicle Number"}),e.jsx("p",{className:"font-medium",children:s.vehicle.vehicle_number})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Vehicle Type"}),e.jsx("p",{className:"font-medium",children:s.vehicle.vehicle_type.name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Capacity"}),e.jsxs("p",{className:"font-medium",children:[s.vehicle.capacity_ton," Tons"]})]})]})})]}),e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Driver Details"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Driver Name"}),e.jsx("p",{className:"font-medium",children:s.driver.name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Mobile Number"}),e.jsx("p",{className:"font-medium",children:s.driver.mobile_no})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"License Number"}),e.jsx("p",{className:"font-medium",children:s.driver.license_no})]})]})})]}),s.security_check&&e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Security Check"]})}),e.jsxs(o,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.vehicle_condition_ok}),e.jsx("span",{className:"text-sm",children:"Vehicle Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.tyre_condition_ok}),e.jsx("span",{className:"text-sm",children:"Tyre Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.fire_extinguisher_available}),e.jsx("span",{className:"text-sm",children:"Fire Extinguisher Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.alcohol_test_done}),e.jsx("span",{className:"text-sm",children:"Alcohol Test Done"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.alcohol_test_passed}),e.jsx("span",{className:"text-sm",children:"Alcohol Test Passed"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Inspected By"}),e.jsx("p",{className:"font-medium",children:s.security_check.inspected_by})]})]}),s.security_check.remarks&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Remarks"}),e.jsx("p",{className:"text-sm",children:s.security_check.remarks})]})]})]}),a&&e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Daily Need Details"]})}),e.jsxs(o,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Category"}),e.jsx("p",{className:"font-medium",children:a.category})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Material Name"}),e.jsx("p",{className:"font-medium",children:a.material_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Supplier / Vendor"}),e.jsx("p",{className:"font-medium",children:a.supplier_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Receiving Department"}),e.jsx("p",{className:"font-medium",children:a.receiving_department})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Quantity"}),e.jsxs("p",{className:"font-medium text-lg text-primary",children:[a.quantity," ",a.unit]})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Supervisor"}),e.jsx("p",{className:"font-medium",children:a.canteen_supervisor||"-"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2 mb-4",children:[e.jsx(oe,{className:"h-4 w-4"}),"Documentation & Contact"]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Bill / Challan Number"}),e.jsx("p",{className:"font-medium",children:a.bill_number||"-"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Delivery Challan Number"}),e.jsx("p",{className:"font-medium",children:a.delivery_challan_number||"-"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Vehicle / Person Name"}),e.jsx("p",{className:"font-medium",children:a.vehicle_or_person_name||"-"})]}),e.jsxs("div",{children:[e.jsxs(t,{className:"text-muted-foreground text-xs flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),"Contact Number"]}),e.jsx("p",{className:"font-medium",children:a.contact_number||"-"})]})]})]}),a.remarks&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(t,{className:"text-muted-foreground text-xs",children:"Remarks / Notes"}),e.jsx("p",{className:"text-sm",children:a.remarks})]})]})]}),!v&&e.jsx(m,{className:"border-primary/50",children:e.jsx(o,{className:"pt-6",children:s.security_check?.is_submitted||S?e.jsxs("div",{className:"flex items-center gap-3 text-green-600 dark:text-green-400",children:[e.jsx(p,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Security check submitted. Ready to complete entry."})]}):e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{className:"text-base font-medium",children:"Security Inspection Pending"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Submit security check to proceed with completing the entry"})]})})})})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-between",children:[e.jsxs(c,{type:"button",variant:"outline",onClick:D,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Previous"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:y,children:"Cancel"}),!v&&e.jsx(e.Fragment,{children:!s?.security_check?.is_submitted&&!S?e.jsxs(c,{type:"button",onClick:z,disabled:_,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),_?"Submitting...":"Submit Security"]}):e.jsxs(c,{type:"button",onClick:J,disabled:w,children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),w?"Completing...":"Complete Entry"]})}),v&&e.jsxs(c,{type:"button",onClick:y,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),"Entry Completed"]})]})]})]})}export{Ve as default};
