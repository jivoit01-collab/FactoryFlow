import{u as q,a as A}from"./useMutation-DO4goLdQ.js";import{F as y,G as x,H as h,al as D,r as E,j as e,D as B,m as F,n as Y,o as U,L as _,I as M,ar as O,q as K,B as f}from"./index--0m_tC-m.js";import{S as V}from"./SearchableSelect-Dj6j_zKB.js";import{u as k,a as H}from"./materialType.queries-DxyrpC_u.js";const g={async getByMaterialType(a){return(await y.get(x.QUALITY_CONTROL_V2.MATERIAL_TYPE_PARAMETERS(a))).data},async getById(a){return(await y.get(x.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a))).data},async create(a,t){return(await y.post(x.QUALITY_CONTROL_V2.MATERIAL_TYPE_PARAMETERS(a),t)).data},async update(a,t){return(await y.put(x.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a),t)).data},async delete(a){await y.delete(x.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a))}},m={all:["qcParameters"],byMaterialType:a=>[...m.all,"byMaterialType",a],detail:a=>[...m.all,"detail",a]};function J(a){return q({queryKey:m.byMaterialType(a),queryFn:()=>g.getByMaterialType(a),enabled:!!a})}function W(){const a=h();return A({mutationFn:({materialTypeId:t,data:r})=>g.create(t,r),onSuccess:(t,{materialTypeId:r})=>{a.invalidateQueries({queryKey:m.byMaterialType(r)})}})}function X(){const a=h();return A({mutationFn:({id:t,data:r})=>g.update(t,r),onSuccess:()=>{a.invalidateQueries({queryKey:m.all})}})}function ee(){const a=h();return A({mutationFn:t=>g.delete(t),onSuccess:()=>{a.invalidateQueries({queryKey:m.all})}})}function ae({value:a,onChange:t,placeholder:r="Select Material Type",disabled:N=!1,error:P,label:L,required:R=!1}){const{hasAnyPermission:b}=D(),j=b(["quality_control.can_manage_material_types","quality_control.add_materialtype"]),{data:Q=[],isLoading:I,isError:w}=k(),o=H(),[n,T]=E.useState({code:"",name:"",description:""}),[c,d]=E.useState({}),v=()=>{T({code:"",name:"",description:""}),d({})},S=async(s,l)=>{if(!n.code.trim()){d({code:"Code is required"});return}if(!/^[A-Z0-9_]+$/.test(n.code)){d({code:"Code must be uppercase letters, numbers, and underscores only"});return}if(!n.name.trim()){d({name:"Name is required"});return}try{d({});const u=await o.mutateAsync({code:n.code,name:n.name,description:n.description});s(u.id,u.name),t(u),v(),l(!1)}catch(u){d({general:u.message||"Failed to create material type"})}};return e.jsx(V,{value:a?String(a):void 0,items:Q,isLoading:I,isError:w,placeholder:r,disabled:N,error:P,label:L,required:R,inputId:"material-type-select",getItemKey:s=>s.id,getItemLabel:s=>s.name,filterFn:(s,l)=>s.name.toLowerCase().includes(l.toLowerCase())||s.code.toLowerCase().includes(l.toLowerCase()),renderItem:s=>e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",s.code,")"]})]}),loadingText:"Loading...",emptyText:"No material types available",notFoundText:"No material types found",addNewLabel:j?"Add New Material Type":void 0,onItemSelect:s=>{t(s)},onClear:()=>{t(null)},renderCreateDialog:j?(s,l,u)=>e.jsx(B,{open:s,onOpenChange:i=>{i||v(),l(i)},children:e.jsxs(F,{className:"max-w-md",children:[e.jsx(Y,{children:e.jsx(U,{children:"Add Material Type"})}),c.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:c.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{children:["Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(M,{value:n.code,onChange:i=>{const p=i.target.value.toUpperCase().replace(/\s/g,"");T(C=>({...C,code:p})),c.code&&d(C=>({...C,code:""}))},placeholder:"e.g., CAP_BLUE",disabled:o.isPending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All caps, no spaces. Use underscores to separate words."}),c.code&&e.jsx("p",{className:"text-sm text-destructive",children:c.code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(M,{value:n.name,onChange:i=>T(p=>({...p,name:i.target.value})),placeholder:"e.g., Cap Blue Plain",disabled:o.isPending}),c.name&&e.jsx("p",{className:"text-sm text-destructive",children:c.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Description"}),e.jsx(O,{value:n.description,onChange:i=>T(p=>({...p,description:i.target.value})),placeholder:"e.g., Blue plain caps for water bottles",rows:3,disabled:o.isPending})]})]}),e.jsxs(K,{children:[e.jsx(f,{variant:"outline",onClick:()=>l(!1),disabled:o.isPending,children:"Cancel"}),e.jsx(f,{onClick:()=>S(u,l),disabled:o.isPending,children:o.isPending?"Creating...":"Create"})]})]})}):void 0})}export{ae as M,W as a,X as b,ee as c,J as u};
