import{y as be,H as L,J as D,K,r as c,j as e,D as ee,m as re,n as se,o as te,p as ne,L as P,I as q,B as R,X as fe,q as ae,O as ie,C as G,b as W,c as J,T as Ne,e as X,M as de,U as ge,Q as ue,a as _e,W as je}from"./index-Dt2C4nB0.js";import{E as Ie}from"./status.constants-DbtYTm7V.js";import{a as Pe,g as Ce}from"./error-qMYEww3Q.js";import{b as Ee,c as Te,a as Se}from"./vehicleEntry.queries-dEN1osoH.js";import{d as we,I as Ve,a as Z}from"./driver.schema-DZt_XaHY.js";import{t as Le,v as De}from"./vehicle.schema-BmxwMEOL.js";import{u as $}from"./useScrollToError-DSpt8KQW.js";import{S as Y}from"./SearchableSelect-CBLIZDPT.js";import{u as U,a as O}from"./useMutation-CDDQmGrZ.js";import{u as oe,a as le}from"./zod-3DrWwAXF.js";import{C as Fe}from"./circle-alert-BZMTPmrZ.js";const Ae=[{value:"Aadhar",label:"Aadhar"},{value:"PAN Card",label:"PAN Card"},{value:"Driving License",label:"Driving License"},{value:"Voter ID",label:"Voter ID"},{value:"Other",label:"Other"}];const Re=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Q=be("camera",Re),z={async getNames(){return(await L.get(D.DRIVER.DRIVER_NAMES)).data},async getById(r){return(await L.get(D.DRIVER.DRIVER_BY_ID(r))).data},async getList(){return(await L.get(D.DRIVER.DRIVERS)).data},async create(r){const s=new FormData;return s.append("name",r.name),s.append("mobile_no",r.mobile_no),s.append("license_no",r.license_no),s.append("id_proof_type",r.id_proof_type),s.append("id_proof_number",r.id_proof_number),r.photo&&s.append("photo",r.photo),(await L.post(D.DRIVER.DRIVERS,s,{headers:{"Content-Type":"multipart/form-data"}})).data},async update(r){const s=new FormData;return s.append("name",r.name),s.append("mobile_no",r.mobile_no),s.append("license_no",r.license_no),s.append("id_proof_type",r.id_proof_type),s.append("id_proof_number",r.id_proof_number),r.photo&&s.append("photo",r.photo),(await L.put(D.DRIVER.DRIVER_BY_ID(r.id),s,{headers:{"Content-Type":"multipart/form-data"}})).data}};function qe(r=!0){return U({queryKey:["driverNames"],queryFn:()=>z.getNames(),staleTime:600*1e3,enabled:r})}function ke(r,s=!0){return U({queryKey:["driver",r],queryFn:()=>z.getById(r),staleTime:600*1e3,enabled:s&&r!==null})}function Me(){const r=K();return O({mutationFn:s=>z.create(s),onSuccess:s=>{r.invalidateQueries({queryKey:["drivers"]}),r.invalidateQueries({queryKey:["driverNames"]}),r.invalidateQueries({queryKey:["driver",s.id]})}})}function Ue(){const r=K();return O({mutationFn:s=>z.update(s),onSuccess:s=>{r.invalidateQueries({queryKey:["drivers"]}),r.invalidateQueries({queryKey:["driverNames"]}),r.invalidateQueries({queryKey:["driver",s.id]})}})}function pe({open:r,onOpenChange:s,onSuccess:v,initialData:u}){const[t,h]=c.useState({}),[I,l]=c.useState(null),x=c.useRef(null),_=c.useRef(!1),N=Me(),g=Ue(),y=!!u,n=y?g:N,{register:b,handleSubmit:o,formState:{errors:i},reset:T,setError:m,setValue:d,watch:F}=oe({resolver:le(we),defaultValues:{name:"",mobile_no:"",license_no:"",id_proof_type:"Aadhar",id_proof_number:""}}),S=F("photo"),j=F("id_proof_type"),k=c.useMemo(()=>({...i,...t}),[i,t]);$(k),c.useEffect(()=>{r&&(h({}),_.current=!0,u?(T({name:u.name,mobile_no:u.mobile_no,license_no:u.license_no,id_proof_type:u.id_proof_type,id_proof_number:u.id_proof_number}),l(u.photo??null)):(T(),l(null)))},[r,u,T]),c.useEffect(()=>{if(_.current){_.current=!1;return}d("id_proof_number","",{shouldValidate:!1})},[j,d]),c.useEffect(()=>{if(S&&S instanceof File){const f=new FileReader;f.onloadend=()=>{l(f.result)},f.readAsDataURL(S)}},[S]);const M=f=>{const p=f.target.files?.[0];p&&d("photo",p,{shouldValidate:!0})},a=()=>{d("photo",void 0,{shouldValidate:!1}),l(null),x.current&&(x.current.value="")},E=async f=>{h({});try{const p=y?await g.mutateAsync({...f,id:u.id}):await N.mutateAsync(f);T(),l(null),s(!1),v?.(p)}catch(p){const C=p;if(C.errors){const w={};Object.entries(C.errors).forEach(([V,A])=>{if(Array.isArray(A)&&A.length>0){const ce=V==="mobile_no"?"mobile_no":V==="license_no"?"license_no":V==="id_proof_type"?"id_proof_type":V==="id_proof_number"?"id_proof_number":V;w[ce]=A[0],m(ce,{type:"server",message:A[0]})}}),h(w)}else h({general:C.message||(y?"Failed to update driver":"Failed to create driver")})}};return e.jsx(ee,{open:r,onOpenChange:s,children:e.jsxs(re,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(se,{children:[e.jsx(te,{children:y?"Update Driver":"Add New Driver"}),e.jsx(ne,{children:y?"Update the driver details below.":"Fill in the details to create a new driver. All fields are required."})]}),e.jsxs("form",{onSubmit:o(E),className:"space-y-4",children:[t.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:t.general}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"name",children:["Driver Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"name",placeholder:"Enter driver name",...b("name"),disabled:n.isPending,className:i.name||t.name?"border-destructive":""}),i.name&&e.jsx("p",{className:"text-sm text-destructive",children:i.name.message}),t.name&&!i.name&&e.jsx("p",{className:"text-sm text-destructive",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"mobile_no",children:["Mobile Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"mobile_no",placeholder:"9876543210",...b("mobile_no"),disabled:n.isPending,className:i.mobile_no||t.mobile_no?"border-destructive":""}),i.mobile_no&&e.jsx("p",{className:"text-sm text-destructive",children:i.mobile_no.message}),t.mobile_no&&!i.mobile_no&&e.jsx("p",{className:"text-sm text-destructive",children:t.mobile_no})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"license_no",children:["Driving License Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"license_no",placeholder:"e.g., MH0220150001234",...b("license_no",{onChange:f=>{f.target.value=f.target.value.toUpperCase()}}),disabled:n.isPending,className:i.license_no||t.license_no?"border-destructive":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: State code + RTO + Year + Number (e.g., MH0220150001234)"}),i.license_no&&e.jsx("p",{className:"text-sm text-destructive",children:i.license_no.message}),t.license_no&&!i.license_no&&e.jsx("p",{className:"text-sm text-destructive",children:t.license_no})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"id_proof_type",children:["ID Proof Type ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("select",{id:"id_proof_type",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",...b("id_proof_type"),disabled:n.isPending,children:Ve.map(f=>e.jsx("option",{value:f,children:f},f))}),i.id_proof_type&&e.jsx("p",{className:"text-sm text-destructive",children:i.id_proof_type.message}),t.id_proof_type&&!i.id_proof_type&&e.jsx("p",{className:"text-sm text-destructive",children:t.id_proof_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"id_proof_number",children:["ID Proof Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"id_proof_number",placeholder:Z[j]?.placeholder||"Enter ID proof number",...b("id_proof_number",{onChange:f=>{j==="Aadhar"?f.target.value=f.target.value.replace(/[^0-9]/g,"").slice(0,12):(j==="PAN Card"||j==="Voter ID")&&(f.target.value=f.target.value.toUpperCase())}}),maxLength:Z[j]?.maxLength??50,disabled:n.isPending,className:i.id_proof_number||t.id_proof_number?"border-destructive":""}),j&&j!=="Other"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:Z[j]?.message}),i.id_proof_number&&e.jsx("p",{className:"text-sm text-destructive",children:i.id_proof_number.message}),t.id_proof_number&&!i.id_proof_number&&e.jsx("p",{className:"text-sm text-destructive",children:t.id_proof_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Driver Photo"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{ref:x,type:"file",accept:"image/*",onChange:M,disabled:n.isPending,className:"hidden",id:"photo-upload"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{type:"button",variant:"outline",onClick:()=>x.current?.click(),disabled:n.isPending,className:"w-full",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),I?"Change Photo":"Upload Photo"]}),I&&e.jsx(R,{type:"button",variant:"outline",size:"icon",onClick:a,disabled:n.isPending,children:e.jsx(fe,{className:"h-4 w-4"})})]}),I&&e.jsxs("div",{className:"relative w-full h-48 border rounded-md overflow-hidden bg-muted",children:[e.jsx("img",{src:I,alt:"Driver photo preview",className:"w-full h-full object-cover",onError:f=>{f.currentTarget.style.display="none";const p=f.currentTarget.nextElementSibling;p&&(p.style.display="flex")}}),e.jsx("div",{className:"absolute inset-0 items-center justify-center text-muted-foreground",style:{display:"none"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Failed to load image"})]})})]})]})]}),e.jsxs(ae,{children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:n.isPending,children:"Cancel"}),e.jsx(R,{type:"submit",disabled:n.isPending,children:n.isPending?y?"Updating...":"Creating...":y?"Update Driver":"Create Driver"})]})]})]})})}function Ke({value:r,onChange:s,placeholder:v="Select driver",disabled:u=!1,error:t,label:h,required:I=!1}){const[l,x]=c.useState(!1),[_,N]=c.useState(null),{data:g=[],isLoading:y}=qe(l&&!u),{data:n}=ke(_,_!==null),b=c.useRef(n),o=c.useRef(s);return c.useEffect(()=>{o.current=s},[s]),c.useEffect(()=>{n&&n!==b.current&&(b.current=n,o.current({driverId:n.id,driverName:n.name,mobileNumber:n.mobile_no,drivingLicenseNumber:n.license_no,idProofType:n.id_proof_type,idProofNumber:n.id_proof_number,driverPhoto:n.photo}))},[n]),e.jsx(Y,{value:r,items:g,isLoading:y,placeholder:v,disabled:u,error:t,label:h,required:I,inputId:"driver-select",getItemKey:i=>i.id,getItemLabel:i=>i.name,loadingText:"Loading drivers...",emptyText:"No drivers available",notFoundText:"No drivers found",addNewLabel:"Add New Driver",onOpenChange:x,onSelectedKeyChange:i=>{N(i),i||(b.current=void 0)},onItemSelect:i=>{N(i.id)},onClear:()=>{N(null),b.current=void 0,s({driverId:0,driverName:"",mobileNumber:"",drivingLicenseNumber:"",idProofType:"",idProofNumber:"",driverPhoto:null})},renderPopoverContent:i=>n?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",e.jsx("span",{className:"text-muted-foreground",children:n.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Mobile Number:"})," ",e.jsx("span",{className:"text-muted-foreground",children:n.mobile_no})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License Number:"})," ",e.jsx("span",{className:"text-muted-foreground",children:n.license_no})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID Proof Type:"})," ",e.jsx("span",{className:"text-muted-foreground",children:n.id_proof_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID Proof Number:"})," ",e.jsx("span",{className:"text-muted-foreground",children:n.id_proof_number})]})]})}):i?e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 animate-spin"}),"Loading driver details..."]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Please select a driver to view details."}),renderCreateDialog:(i,T,m)=>e.jsx(pe,{open:i,onOpenChange:T,onSuccess:d=>{m(d.id,d.name),N(d.id)}})})}const H={async getNames(){return(await L.get(D.VEHICLE.TRANSPORTER_NAMES)).data},async getById(r){return(await L.get(D.VEHICLE.TRANSPORTER_BY_ID(r))).data},async getList(){return(await L.get(D.VEHICLE.TRANSPORTERS)).data},async update(r){const s=new URLSearchParams;return s.append("name",r.name),s.append("contact_person",r.contact_person),s.append("mobile_no",r.mobile_no),(await L.put(D.VEHICLE.TRANSPORTER_BY_ID(r.id),s.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data},async create(r){const s=new URLSearchParams;return s.append("name",r.name),s.append("contact_person",r.contact_person),s.append("mobile_no",r.mobile_no),(await L.post(D.VEHICLE.TRANSPORTERS,s.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data}};function Oe(r=!0){return U({queryKey:["transporterNames"],queryFn:()=>H.getNames(),staleTime:600*1e3,enabled:r})}function me(r,s=!0){return U({queryKey:["transporter",r],queryFn:()=>H.getById(r),staleTime:600*1e3,enabled:s&&r!==null})}function He(r=!0){return U({queryKey:["transporters"],queryFn:()=>H.getList(),staleTime:600*1e3,enabled:r})}function Be(){const r=K();return O({mutationFn:s=>H.create(s),onSuccess:()=>{r.invalidateQueries({queryKey:["transporters"]}),r.invalidateQueries({queryKey:["transporterNames"]})}})}function Qe(){const r=K();return O({mutationFn:s=>H.update(s),onSuccess:(s,v)=>{r.invalidateQueries({queryKey:["transporters"]}),r.invalidateQueries({queryKey:["transporterNames"]}),r.invalidateQueries({queryKey:["transporter",v.id]})}})}function he({open:r,onOpenChange:s,onSuccess:v,initialData:u}){const[t,h]=c.useState({}),I=Be(),l=Qe(),x=!!u,_=x?l:I,{data:N}=me(r&&x?u.id:null,r&&x),{register:g,handleSubmit:y,formState:{errors:n},reset:b,setError:o}=oe({resolver:le(Le),defaultValues:{name:"",contact_person:"",mobile_no:""}}),i=c.useMemo(()=>({...n,...t}),[n,t]);$(i),c.useEffect(()=>{r&&(h({}),x||b())},[r,b,x]),c.useEffect(()=>{!r||!x||!N||b({name:N.name,contact_person:N.contact_person,mobile_no:N.mobile_no})},[r,x,N,b]);const T=async m=>{h({});try{const d=x?await l.mutateAsync({id:u.id,...m}):await I.mutateAsync(m);b(),s(!1),v?.(d)}catch(d){const F=d;if(F.errors){const S={};Object.entries(F.errors).forEach(([j,k])=>{Array.isArray(k)&&k.length>0&&(S[j]=k[0],o(j,{type:"server",message:k[0]}))}),h(S)}else h({general:F.message||(x?"Failed to update transporter":"Failed to create transporter")})}};return e.jsx(ee,{open:r,onOpenChange:s,children:e.jsxs(re,{className:"sm:max-w-[500px]",children:[e.jsxs(se,{children:[e.jsx(te,{children:x?"Update Transporter":"Add New Transporter"}),e.jsx(ne,{children:x?"Update the transporter details below.":"Fill in the details to create a new transporter. All fields are required."})]}),e.jsxs("form",{onSubmit:y(T),className:"space-y-4",children:[t.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:t.general}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"name",children:["Transporter Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"name",placeholder:"Enter transporter name",...g("name"),disabled:_.isPending,className:n.name||t.name?"border-destructive":""}),n.name&&e.jsx("p",{className:"text-sm text-destructive",children:n.name.message}),t.name&&!n.name&&e.jsx("p",{className:"text-sm text-destructive",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"contact_person",children:["Contact Person ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"contact_person",placeholder:"Enter contact person name",...g("contact_person"),disabled:_.isPending,className:n.contact_person||t.contact_person?"border-destructive":""}),n.contact_person&&e.jsx("p",{className:"text-sm text-destructive",children:n.contact_person.message}),t.contact_person&&!n.contact_person&&e.jsx("p",{className:"text-sm text-destructive",children:t.contact_person})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"mobile_no",children:["Mobile Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"mobile_no",placeholder:"Enter mobile number",...g("mobile_no"),disabled:_.isPending,className:n.mobile_no||t.mobile_no?"border-destructive":""}),n.mobile_no&&e.jsx("p",{className:"text-sm text-destructive",children:n.mobile_no.message}),t.mobile_no&&!n.mobile_no&&e.jsx("p",{className:"text-sm text-destructive",children:t.mobile_no})]}),e.jsxs(ae,{children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:_.isPending,children:"Cancel"}),e.jsx(R,{type:"submit",disabled:_.isPending,children:_.isPending?x?"Updating...":"Creating...":x?"Update Transporter":"Create Transporter"})]})]})]})})}function ve({value:r,onChange:s,placeholder:v="Select transporter",disabled:u=!1,error:t,label:h,required:I=!1,externalDetails:l}){const[x,_]=c.useState(!1),[N,g]=c.useState(null),{data:y=[],isLoading:n}=Oe(x&&!u),{data:b}=me(N,N!==null),o=l||b;return e.jsx(Y,{value:r,items:y,isLoading:n,placeholder:v,disabled:u,error:t,label:h,required:I,inputId:"transporter-select",getItemKey:i=>i.id,getItemLabel:i=>i.name,loadingText:"Loading transporters...",emptyText:"No transporters available",notFoundText:"No transporters found",addNewLabel:"Add New Transporter",onOpenChange:_,onSelectedKeyChange:i=>{g(i)},onItemSelect:i=>{g(i.id),s(i.name)},onClear:()=>{g(null),s("")},renderPopoverContent:i=>o?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",e.jsx("span",{className:"text-muted-foreground",children:o.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Contact Person:"})," ",e.jsx("span",{className:"text-muted-foreground",children:o.contact_person})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Mobile Number:"})," ",e.jsx("span",{className:"text-muted-foreground",children:o.mobile_no})]})]})}):i?e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 animate-spin"}),"Loading transporter details..."]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Please select a transporter to view details."}),renderCreateDialog:(i,T,m)=>e.jsx(he,{open:i,onOpenChange:T,onSuccess:d=>{m(d.id,d.name),g(d.id),s(d.name)}})})}const B={async getVehicleTypes(){return(await L.get(D.VEHICLE.VEHICLE_TYPES)).data},async getNames(){return(await L.get(D.VEHICLE.VEHICLE_NAMES)).data},async getById(r){return(await L.get(D.VEHICLE.VEHICLE_BY_ID(r))).data},async getList(){return(await L.get(D.VEHICLE.VEHICLES)).data},async create(r){const s=new URLSearchParams;return s.append("vehicle_number",r.vehicle_number),s.append("vehicle_type",r.vehicle_type.toString()),s.append("transporter",r.transporter.toString()),s.append("capacity_ton",r.capacity_ton),(await L.post(D.VEHICLE.VEHICLES,s.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data},async update(r){const s=new URLSearchParams;return s.append("vehicle_number",r.vehicle_number),s.append("vehicle_type",r.vehicle_type.toString()),s.append("transporter",r.transporter.toString()),s.append("capacity_ton",r.capacity_ton),(await L.put(D.VEHICLE.VEHICLE_BY_ID(r.id),s.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data}};function $e(r=!0){return U({queryKey:["vehicleTypes"],queryFn:()=>B.getVehicleTypes(),staleTime:600*1e3,enabled:r})}function Ye(r=!0){return U({queryKey:["vehicleNames"],queryFn:()=>B.getNames(),staleTime:600*1e3,enabled:r})}function xe(r,s=!0){return U({queryKey:["vehicle",r],queryFn:()=>B.getById(r),staleTime:600*1e3,enabled:s&&r!==null})}function ze(){const r=K();return O({mutationFn:s=>B.create(s),onSuccess:()=>{r.invalidateQueries({queryKey:["vehicles"]}),r.invalidateQueries({queryKey:["vehicleNames"]})}})}function Ge(){const r=K();return O({mutationFn:s=>B.update(s),onSuccess:s=>{r.invalidateQueries({queryKey:["vehicles"]}),r.invalidateQueries({queryKey:["vehicleNames"]}),r.invalidateQueries({queryKey:["vehicle",s.id]})}})}function We({value:r,onChange:s,placeholder:v="Select vehicle type",disabled:u=!1,error:t,label:h,required:I=!1}){const[l,x]=c.useState(!1),{data:_=[],isLoading:N,isError:g}=$e(l);return e.jsx(Y,{value:r||void 0,items:_,isLoading:N,isError:g,placeholder:v,disabled:u,error:t,label:h,required:I,inputId:"vehicle-type-select",inputClassName:"border-2 font-medium",getItemKey:y=>y.id,getItemLabel:y=>y.name,loadingText:"Loading vehicle types...",emptyText:"No vehicle types available",notFoundText:"No vehicle types found",onOpenChange:x,onItemSelect:y=>{s(y.id,y.name)},onClear:()=>{s(0,"")}})}function ye({open:r,onOpenChange:s,onSuccess:v,initialData:u}){const[t,h]=c.useState({}),[I,l]=c.useState(null),x=ze(),_=Ge(),{data:N=[]}=He(r),[g,y]=c.useState(""),n=!!u,b=n?_:x,{data:o}=xe(r&&n?u.id:null,r&&n),{register:i,handleSubmit:T,formState:{errors:m},reset:d,setError:F,setValue:S}=oe({resolver:le(De),defaultValues:{vehicle_number:"",vehicle_type:0,transporter:0,capacity_ton:""}}),[j,k]=c.useState(""),M=c.useMemo(()=>({...m,...t}),[m,t]);$(M),c.useEffect(()=>{r&&(h({}),n||(d(),l(null),k(""),y("")))},[r,d,n]),c.useEffect(()=>{!r||!n||!o||(d({vehicle_number:o.vehicle_number,vehicle_type:o.vehicle_type?.id??0,transporter:o.transporter?.id??0,capacity_ton:o.capacity_ton??""}),y(o.vehicle_type?.id?String(o.vehicle_type.id):""),k(o.transporter?.name??""),l(o.transporter?.id??null))},[r,n,o,d]),c.useEffect(()=>{if(j&&N.length>0){const E=N.find(f=>f.name===j);E?(l(E.id),S("transporter",E.id)):(l(null),S("transporter",0))}else l(null),S("transporter",0)},[j,N,S]);const a=async E=>{if(!I){h({transporter:"Please select a transporter"});return}h({});try{const f=n?await _.mutateAsync({id:u.id,...E,transporter:I}):await x.mutateAsync({...E,transporter:I});d(),s(!1),v?.(f)}catch(f){const p=f;if(p.errors){const C={};Object.entries(p.errors).forEach(([w,V])=>{if(Array.isArray(V)&&V.length>0){const A=w==="vehicle_number"?"vehicle_number":w==="vehicle_type"?"vehicle_type":w==="capacity_ton"?"capacity_ton":w;C[A]=V[0],F(A,{type:"server",message:V[0]})}}),h(C)}else h({general:p.message||(n?"Failed to update vehicle":"Failed to create vehicle")})}};return e.jsx(ee,{open:r,onOpenChange:s,children:e.jsxs(re,{className:"sm:max-w-[500px]",children:[e.jsxs(se,{children:[e.jsx(te,{children:n?"Update Vehicle":"Add New Vehicle"}),e.jsx(ne,{children:n?"Update the vehicle details below.":"Fill in the details to create a new vehicle. All fields are required."})]}),e.jsxs("form",{onSubmit:T(a),className:"space-y-4",children:[t.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:t.general}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"vehicle_number",children:["Vehicle Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"vehicle_number",placeholder:"HR55AB1234",...i("vehicle_number",{onChange:E=>{E.target.value=E.target.value.toUpperCase().replace(/\s/g,"")}}),disabled:n||b.isPending,className:m.vehicle_number||t.vehicle_number?"border-destructive":""}),!n&&m.vehicle_number&&e.jsx("p",{className:"text-sm text-destructive",children:m.vehicle_number.message}),!n&&t.vehicle_number&&!m.vehicle_number&&e.jsx("p",{className:"text-sm text-destructive",children:t.vehicle_number})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(We,{value:g||void 0,onChange:(E,f)=>{S("vehicle_type",E),y(String(E))},disabled:b.isPending,label:"Vehicle Type",required:!0,error:m.vehicle_type?.message||t.vehicle_type})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ve,{value:j,onChange:E=>k(E),placeholder:"Select transporter",label:"Transporter",required:!0}),t.transporter&&e.jsx("p",{className:"text-sm text-destructive",children:t.transporter})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"capacity_ton",children:["Vehicle Capacity (Tons) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"capacity_ton",type:"text",placeholder:"e.g., 18",...i("capacity_ton"),disabled:b.isPending,className:m.capacity_ton||t.capacity_ton?"border-destructive":""}),m.capacity_ton&&e.jsx("p",{className:"text-sm text-destructive",children:m.capacity_ton.message}),t.capacity_ton&&!m.capacity_ton&&e.jsx("p",{className:"text-sm text-destructive",children:t.capacity_ton})]}),e.jsxs(ae,{children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:b.isPending,children:"Cancel"}),e.jsx(R,{type:"submit",disabled:b.isPending,children:b.isPending?n?"Updating...":"Creating...":n?"Update Vehicle":"Create Vehicle"})]})]})]})})}function Je({value:r,onChange:s,placeholder:v="Select vehicle",disabled:u=!1,error:t,label:h,required:I=!1}){const[l,x]=c.useState(!1),[_,N]=c.useState(null),[g,y]=c.useState(null),{data:n=[],isLoading:b}=Ye(l&&!u),{data:o}=xe(_,_!==null),i=c.useRef(o),T=c.useRef(s);c.useEffect(()=>{T.current=s},[s]);const m=c.useCallback(()=>{if(o&&o!==i.current){i.current=o,y(o);const d=o.vehicle_type.name;T.current({vehicleId:o.id,vehicleNumber:o.vehicle_number,vehicleType:d,vehicleCapacity:`${o.capacity_ton} Tons`,transporterId:o.transporter?.id||0,transporterName:o.transporter?.name||"",transporterContactPerson:o.transporter?.contact_person||"",transporterMobile:o.transporter?.mobile_no||""})}},[o]);return c.useEffect(()=>{m()},[m]),e.jsx(Y,{value:r,items:n,isLoading:b,placeholder:v,disabled:u,error:t,label:h,required:I,inputId:"vehicle-select",getItemKey:d=>d.id,getItemLabel:d=>d.vehicle_number,loadingText:"Loading vehicles...",emptyText:"No vehicles available",notFoundText:"No vehicles found",addNewLabel:"Add New Vehicle",onOpenChange:x,onSelectedKeyChange:d=>{N(d),d||y(null)},onItemSelect:d=>{N(d.id)},onClear:()=>{N(null),y(null),s({vehicleId:0,vehicleNumber:"",vehicleType:"",vehicleCapacity:"",transporterId:0,transporterName:"",transporterContactPerson:"",transporterMobile:""})},renderPopoverContent:d=>g?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle Number:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.vehicle_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle Type:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.vehicle_type.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Capacity:"})," ",e.jsxs("span",{className:"text-muted-foreground",children:[g.capacity_ton," Tons"]})]}),g.transporter&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Transporter:"})," ",e.jsx("span",{className:"text-muted-foreground",children:g.transporter.name})]})]})}):d?e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 animate-spin"}),"Loading vehicle details..."]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Please select a vehicle to view details."}),renderCreateDialog:(d,F,S)=>e.jsx(ye,{open:d,onOpenChange:F,onSuccess:j=>{S(j.id,j.vehicle_number),N(j.id)}})})}const Xe=()=>{try{return new URL(ue.apiBaseUrl).origin}catch{return ue.apiBaseUrl.replace(/\/api\/v1\/?$/,"")}};function Ze({formData:r,onFormChange:s,isReadOnly:v,isLoading:u,isSaving:t,apiErrors:h,currentStep:I,totalSteps:l,onVehicleSelect:x,onDriverSelect:_,onCancel:N,onNext:g,onUpdate:y,isEditMode:n,canUpdate:b,updateMode:o,serverError:i,headerTitle:T="Material Inward"}){const m=I/l*100,[d,F]=c.useState(!1),[S,j]=c.useState(!1),[k,M]=c.useState(!1);return $(h),u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight",children:[T," - Step ",I," of ",l]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${m}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground min-w-[3rem]",children:[Math.round(m),"%"]})]})]}),(i||h.general)&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),i||h.general]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Vehicle Details"]})}),e.jsx(X,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{htmlFor:"vehicle-select",children:["Vehicle Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),r.vehicleId!=0&&!v&&e.jsx(R,{type:"button",variant:"link",size:"sm",className:"px-0 h-auto",onClick:()=>j(!0),children:"Edit Vehicle"})]}),e.jsx(Je,{value:r.vehicleNumber,onChange:a=>{v||x({vehicleId:a.vehicleId,vehicleNumber:a.vehicleNumber,vehicleType:a.vehicleType,vehicleCapacity:a.vehicleCapacity,transporterId:a.transporterId,transporterName:a.transporterName,transporterContactPerson:a.transporterContactPerson,transporterMobile:a.transporterMobile})},placeholder:"Enter vehicle number",required:!0,error:h.vehicle,disabled:v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{htmlFor:"transporter-select",children:["Transporter Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),!!r.transporterName&&!v&&e.jsx(R,{type:"button",variant:"link",size:"sm",className:"px-0 h-auto",onClick:()=>M(!0),children:"Edit Transporter"})]}),e.jsx(ve,{value:r.transporterName,onChange:()=>{},placeholder:"Auto-filled from vehicle",disabled:!0,externalDetails:r.transporterName?{name:r.transporterName,contact_person:r.transporterContactPerson,mobile_no:r.transporterMobile}:null})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"vehicleType",children:["Vehicle Type ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"vehicleType",value:r.vehicleType,disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"vehicleCapacity",children:"Vehicle Capacity"}),e.jsx(q,{id:"vehicleCapacity",placeholder:"e.g., 10 Tons / 50 CBM",value:r.vehicleCapacity,onChange:a=>s("vehicleCapacity",a.target.value),disabled:!0})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(P,{htmlFor:"gpsId",children:"GPS ID (if available)"}),e.jsx(q,{id:"gpsId",placeholder:"GPS tracking ID",value:r.gpsId,onChange:a=>s("gpsId",a.target.value),disabled:v||t,className:de(v&&"cursor-not-allowed opacity-50")})]})]})})]}),e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Driver Information"]})}),e.jsx(X,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{htmlFor:"driver-select",children:["Driver Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),r.driverId!=0&&!v&&e.jsx(R,{type:"button",variant:"link",size:"sm",className:"px-0 h-auto",onClick:()=>F(!0),children:"Edit Driver"})]}),e.jsx(Ke,{value:r.driverName,onChange:a=>{v||_({driverId:a.driverId,driverName:a.driverName,mobileNumber:a.mobileNumber,drivingLicenseNumber:a.drivingLicenseNumber,idProofType:a.idProofType,idProofNumber:a.idProofNumber,driverPhoto:a.driverPhoto})},placeholder:"Enter driver name or license number",required:!0,error:h.driver,disabled:v||t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"mobileNumber",children:["Mobile Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"mobileNumber",placeholder:"+91 9876543210",value:r.mobileNumber,onChange:a=>s("mobileNumber",a.target.value),disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"drivingLicenseNumber",children:["Driving License Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"drivingLicenseNumber",placeholder:"DL number",value:r.drivingLicenseNumber,onChange:a=>s("drivingLicenseNumber",a.target.value),disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"idProofType",children:["ID Proof Type ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("select",{id:"idProofType",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:r.idProofType,onChange:a=>s("idProofType",a.target.value),disabled:!0,children:[e.jsx("option",{value:"",children:"Select ID proof type"}),Ae.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"idProofNumber",children:["ID Proof Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(q,{id:"idProofNumber",placeholder:"ID number",value:r.idProofNumber,onChange:a=>s("idProofNumber",a.target.value),disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Driver Photo"}),r.driverPhoto?e.jsxs("div",{className:"relative w-full h-48 border rounded-md overflow-hidden bg-muted",children:[e.jsx("img",{src:r.driverPhoto.startsWith("http")?r.driverPhoto:`${Xe()}${r.driverPhoto}`,alt:"Driver photo",className:"w-full h-full object-cover",onError:a=>{a.currentTarget.style.display="none";const E=a.currentTarget.nextElementSibling;E&&(E.style.display="flex")}}),e.jsx("div",{className:"absolute inset-0 items-center justify-center text-muted-foreground",style:{display:"none"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Photo not available"})]})})]}):e.jsx("div",{className:"w-full h-48 border rounded-md flex items-center justify-center bg-muted text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No photo available"})]})})]})]})})]}),e.jsxs(G,{children:[e.jsx(W,{children:e.jsx(J,{children:"Remarks"})}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"remarks",children:"Additional Remarks (Optional)"}),e.jsx("textarea",{id:"remarks",rows:3,className:de("flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",h.entry_no&&"border-destructive",v&&"cursor-not-allowed opacity-50"),placeholder:"Enter any additional remarks or notes...",value:r.remarks,onChange:a=>s("remarks",a.target.value),disabled:v||t}),h.remarks&&e.jsx("p",{className:"text-sm text-destructive",children:h.remarks}),h.entry_no&&e.jsx("p",{className:"text-sm text-destructive",children:h.entry_no})]})})]})]}),e.jsx(pe,{open:d,onOpenChange:F,initialData:{id:r.driverId,name:r.driverName,mobile_no:r.mobileNumber,license_no:r.drivingLicenseNumber,id_proof_type:r.idProofType,id_proof_number:r.idProofNumber,photo:r.driverPhoto},onSuccess:a=>{_({driverId:a.id,driverName:a.name,mobileNumber:a.mobile_no,drivingLicenseNumber:a.license_no,idProofType:a.id_proof_type,idProofNumber:a.id_proof_number,driverPhoto:a.photo})}}),e.jsx(ye,{open:S,onOpenChange:j,initialData:{id:r.vehicleId},onSuccess:a=>{x({vehicleId:a.id,vehicleNumber:a.vehicle_number,vehicleType:a.vehicle_type?.name??"",vehicleCapacity:a.capacity_ton?`${a.capacity_ton} Tons`:"",transporterId:a.transporter?.id??0,transporterName:a.transporter?.name??"",transporterContactPerson:a.transporter?.contact_person??"",transporterMobile:a.transporter?.mobile_no??""})}}),e.jsx(he,{open:k,onOpenChange:M,initialData:{id:r.transporterId},onSuccess:a=>{x({vehicleId:r.vehicleId,vehicleNumber:r.vehicleNumber,vehicleType:r.vehicleType,vehicleCapacity:r.vehicleCapacity,transporterId:a.id,transporterName:a.name,transporterContactPerson:a.contact_person,transporterMobile:a.mobile_no})}}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-end",children:[e.jsx(R,{type:"button",variant:"outline",onClick:N,children:"Cancel"}),n?e.jsxs(e.Fragment,{children:[b&&!o&&y&&e.jsx(R,{type:"button",onClick:y,children:"Update"}),e.jsx(R,{type:"button",onClick:g,disabled:t,children:o?t?"Saving...":"Save and Next →":"Next →"})]}):e.jsx(R,{type:"button",onClick:g,disabled:t,children:t?"Saving...":"Save and Next →"})]})]})}function ur({config:r}){const s=_e(),v=K(),{entryId:u}=je(),t=!!u,h=Ee(),I=Te(),{data:l,isLoading:x,error:_}=Se(u?parseInt(u):null),N=Pe(_),[g,y]=c.useState(!1),[n,b]=c.useState(!1),[o,i]=c.useState({vehicleId:0,vehicleNumber:"",vehicleType:"",transporterId:0,transporterName:"",transporterContactPerson:"",transporterMobile:"",vehicleCapacity:"",gpsId:"",driverId:0,driverName:"",mobileNumber:"",drivingLicenseNumber:"",idProofType:"",idProofNumber:"",driverPhoto:null,remarks:""}),[T,m]=c.useState({});c.useEffect(()=>{t&&l&&i({vehicleId:l.vehicle?.id||0,vehicleNumber:l.vehicle?.vehicle_number||"",vehicleType:l.vehicle?.vehicle_type?.name||"",transporterId:l.vehicle?.transporter?.id||0,transporterName:l.vehicle?.transporter?.name||"",transporterContactPerson:l.vehicle?.transporter?.contact_person||"",transporterMobile:l.vehicle?.transporter?.mobile_no||"",vehicleCapacity:l.vehicle?.capacity_ton?`${l.vehicle.capacity_ton} Tons`:"",gpsId:"",driverId:l.driver?.id||0,driverName:l.driver?.name||"",mobileNumber:l.driver?.mobile_no||"",drivingLicenseNumber:l.driver?.license_no||"",idProofType:l.driver?.id_proof_type||"",idProofNumber:l.driver?.id_proof_number||"",driverPhoto:l.driver?.photo||null,remarks:l.remarks||""})},[t,l]);const d=(p,C)=>{t&&!g||(i(w=>({...w,[p]:C})),T[p]&&m(w=>{const V={...w};return delete V[p],V}))},F=p=>{i(C=>({...C,vehicleId:p.vehicleId,vehicleNumber:p.vehicleNumber,vehicleType:p.vehicleType,vehicleCapacity:p.vehicleCapacity,transporterId:p.transporterId,transporterName:p.transporterName,transporterContactPerson:p.transporterContactPerson,transporterMobile:p.transporterMobile}))},S=p=>{i(C=>({...C,driverId:p.driverId,driverName:p.driverName,mobileNumber:p.mobileNumber,drivingLicenseNumber:p.drivingLicenseNumber,idProofType:p.idProofType,idProofNumber:p.idProofNumber,driverPhoto:p.driverPhoto}))},j=()=>{v.invalidateQueries({queryKey:["vehicleEntries"]}),s(r.routePrefix)},k=async()=>{if(t&&!g&&u){s(`${r.routePrefix}/edit/${u}/step2`);return}if(m({}),!o.vehicleId){m({vehicle:"Please select a vehicle"});return}if(!o.driverId){m({driver:"Please select a driver"});return}M()},M=async()=>{try{const p=new Date().getFullYear(),C=Date.now().toString().slice(-4),w=`GE-${p}-${C}`,V=await h.mutateAsync({entry_no:w,vehicle:o.vehicleId,driver:o.driverId,remarks:o.remarks||void 0,entry_type:r.entryType});b(!0),s(`${r.routePrefix}/edit/${V.id}/step2`)}catch(p){const C=p;if(C.errors){const w={};Object.entries(C.errors).forEach(([V,A])=>{Array.isArray(A)&&A.length>0&&(w[V]=A[0])}),m(w)}else m({general:C.message||"Failed to create vehicle entry"})}},a=async()=>{if(u){if(m({}),!o.vehicleId){m({vehicle:"Please select a vehicle"});return}if(!o.driverId){m({driver:"Please select a driver"});return}try{await I.mutateAsync({id:parseInt(u),data:{vehicle:o.vehicleId,driver:o.driverId,remarks:o.remarks||void 0}}),b(!0),s(`${r.routePrefix}/edit/${u}/step2`)}catch(p){const C=p;if(C.errors){const w={};Object.entries(C.errors).forEach(([V,A])=>{Array.isArray(A)&&A.length>0&&(w[V]=A[0])}),m(w)}else m({general:C.message||"Failed to update vehicle entry"})}}},E=t&&l?.status===Ie.DRAFT,f=t;return e.jsx(Ze,{formData:o,onFormChange:d,isReadOnly:f,isLoading:t&&x,isSaving:h.isPending||I.isPending||n,apiErrors:T,currentStep:1,totalSteps:r.totalSteps,onVehicleSelect:F,onDriverSelect:S,onCancel:j,onNext:k,onUpdate:a,isEditMode:t,canUpdate:E,updateMode:g,serverError:N?Ce():null,headerTitle:r.headerTitle})}export{ur as S};
