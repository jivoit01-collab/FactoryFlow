import{u as S,a as _}from"./useMutation-BYF3D-8F.js";import{F as p,G as y,H as A,al as q,r as v,j as e,D,m as B,n as Y,o as F,L as C,I as E,ar as O,q as U,B as M}from"./index-DVXWn1VN.js";import{S as K}from"./SearchableSelect-DRnEcs_D.js";import{u as V,a as k}from"./materialType.queries-4OPb-As5.js";const x={async getByMaterialType(a){return(await p.get(y.QUALITY_CONTROL_V2.MATERIAL_TYPE_PARAMETERS(a))).data},async getById(a){return(await p.get(y.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a))).data},async create(a,t){return(await p.post(y.QUALITY_CONTROL_V2.MATERIAL_TYPE_PARAMETERS(a),t)).data},async update(a,t){return(await p.put(y.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a),t)).data},async delete(a){await p.delete(y.QUALITY_CONTROL_V2.QC_PARAMETER_BY_ID(a))}},d={all:["qcParameters"],byMaterialType:a=>[...d.all,"byMaterialType",a],detail:a=>[...d.all,"detail",a]};function z(a){return S({queryKey:d.byMaterialType(a),queryFn:()=>x.getByMaterialType(a),enabled:!!a})}function J(){const a=A();return _({mutationFn:({materialTypeId:t,data:n})=>x.create(t,n),onSuccess:(t,{materialTypeId:n})=>{a.invalidateQueries({queryKey:d.byMaterialType(n)})}})}function W(){const a=A();return _({mutationFn:({id:t,data:n})=>x.update(t,n),onSuccess:()=>{a.invalidateQueries({queryKey:d.all})}})}function X(){const a=A();return _({mutationFn:t=>x.delete(t),onSuccess:()=>{a.invalidateQueries({queryKey:d.all})}})}function ee({value:a,onChange:t,placeholder:n="Select Material Type",disabled:N=!1,error:P,label:f,required:L=!1}){const{hasAnyPermission:R}=q(),h=R(["quality_control.can_manage_material_types","quality_control.add_materialtype"]),{data:b=[],isLoading:Q,isError:I}=V(),l=k(),[i,T]=v.useState({code:"",name:"",description:""}),[o,c]=v.useState({}),w=async s=>{if(!i.code.trim()){c({code:"Code is required"});return}if(!/^[A-Z0-9_]+$/.test(i.code)){c({code:"Code must be uppercase letters, numbers, and underscores only"});return}if(!i.name.trim()){c({name:"Name is required"});return}try{c({});const r=await l.mutateAsync({code:i.code,name:i.name,description:i.description});s(r.id,r.name),t(r)}catch(r){c({general:r.message||"Failed to create material type"})}};return e.jsx(K,{value:a?String(a):void 0,items:b,isLoading:Q,isError:I,placeholder:n,disabled:N,error:P,label:f,required:L,inputId:"material-type-select",getItemKey:s=>s.id,getItemLabel:s=>s.name,filterFn:(s,r)=>s.name.toLowerCase().includes(r.toLowerCase())||s.code.toLowerCase().includes(r.toLowerCase()),renderItem:s=>e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",s.code,")"]})]}),loadingText:"Loading...",emptyText:"No material types available",notFoundText:"No material types found",addNewLabel:h?"Add New Material Type":void 0,onItemSelect:s=>{t(s)},onClear:()=>{t(null)},renderCreateDialog:h?(s,r,j)=>e.jsx(D,{open:s,onOpenChange:r,children:e.jsxs(B,{className:"max-w-md",children:[e.jsx(Y,{children:e.jsx(F,{children:"Add Material Type"})}),o.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:o.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{children:["Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{value:i.code,onChange:u=>{const m=u.target.value.toUpperCase().replace(/\s/g,"");T(g=>({...g,code:m})),o.code&&c(g=>({...g,code:""}))},placeholder:"e.g., CAP_BLUE",disabled:l.isPending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All caps, no spaces. Use underscores to separate words."}),o.code&&e.jsx("p",{className:"text-sm text-destructive",children:o.code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(E,{value:i.name,onChange:u=>T(m=>({...m,name:u.target.value})),placeholder:"e.g., Cap Blue Plain",disabled:l.isPending}),o.name&&e.jsx("p",{className:"text-sm text-destructive",children:o.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Description"}),e.jsx(O,{value:i.description,onChange:u=>T(m=>({...m,description:u.target.value})),placeholder:"e.g., Blue plain caps for water bottles",rows:3,disabled:l.isPending})]})]}),e.jsxs(U,{children:[e.jsx(M,{variant:"outline",onClick:()=>r(!1),disabled:l.isPending,children:"Cancel"}),e.jsx(M,{onClick:()=>w(j),disabled:l.isPending,children:l.isPending?"Creating...":"Create"})]})]})}):void 0})}export{ee as M,J as a,W as b,X as c,z as u};
