import{a as D,r as l,j as e,B as c,I,C as N,b as v,c as b,e as w,al as M}from"./index-DWd_1rrq.js";import{b as G,c as P}from"./personGateIn.queries-CoLg4SFI.js";import"./driver.schema-DZt_XaHY.js";import{G as z}from"./GateSelect-Cb0dew9e.js";import"./vehicle.schema-BmxwMEOL.js";import{A as U}from"./arrow-left-D3wtZzFK.js";import{S as $}from"./search-DR3H9wji.js";import{U as A}from"./user-check-BtndVeF_.js";import{C as B}from"./clock-LY5wv9MY.js";import"./useMutation-B_Nep_U5.js";import"./validation.constants-C18ePHzl.js";import"./schemas-D8ebsZBL.js";import"./SearchableSelect-Bp1_uz_q.js";import"./plus-BIVwEQrp.js";function ee(){const h=D(),[o,C]=l.useState(""),[k,d]=l.useState(null),[r,m]=l.useState(null),{data:i=[],isLoading:L,refetch:S}=G(),x=P(),u=l.useMemo(()=>{if(!o.trim())return i;const s=o.toLowerCase();return i.filter(t=>t.name_snapshot?.toLowerCase().includes(s)||t.purpose?.toLowerCase().includes(s)||t.gate_in?.name?.toLowerCase().includes(s)||t.vehicle_no?.toLowerCase().includes(s))},[i,o]),a=l.useMemo(()=>{const s=[],t=[];return u.forEach(n=>{n.visitor?s.push(n):n.labour&&t.push(n)}),{visitors:s,labours:t}},[u]),y=s=>{if(!s)return"-";try{return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}},E=s=>{if(!s)return"-";try{const t=new Date(s),f=new Date().getTime()-t.getTime(),g=Math.floor(f/(1e3*60*60)),j=Math.floor(f%(1e3*60*60)/(1e3*60));return g>0?`${g}h ${j}m`:`${j}m`}catch{return"-"}},_=async s=>{if(r)try{await x.mutateAsync({id:s,data:{gate_out:r}}),d(null),m(null),S()}catch(t){console.error("Failed to exit:",t)}},p=({entry:s})=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>h(`/gate/visitor-labour/entry/${s.id}`),children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium text-sm truncate",children:s.name_snapshot})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-0.5",children:[e.jsxs("span",{children:["via ",s.gate_in?.name||"Unknown Gate"]}),s.purpose&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"truncate max-w-[150px]",children:s.purpose})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:y(s.entry_time)}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(B,{className:"h-3 w-3"}),E(s.entry_time)]})]}),k===s.id?e.jsxs("div",{className:"flex items-center gap-2",onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"w-40",children:e.jsx(z,{value:r?String(r):void 0,onChange:t=>m(t),placeholder:"Select Gate"})}),e.jsx(c,{size:"sm",variant:"default",onClick:()=>_(s.id),disabled:!r||x.isPending,children:x.isPending?"Exiting...":"Confirm"}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{d(null),m(null)},children:"Cancel"})]}):e.jsxs(c,{size:"sm",variant:"outline",onClick:t=>{t.stopPropagation(),d(s.id)},children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Exit"]})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>h("/gate/visitor-labour"),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Currently Inside"}),e.jsxs("p",{className:"text-muted-foreground",children:[i.length," ",i.length===1?"person":"people"," currently inside the premises"]})]})]})}),e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx($,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(I,{placeholder:"Search by name, purpose, gate...",value:o,onChange:s=>C(s.target.value),className:"pl-10"})]})}),L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground rounded-md border",children:[e.jsx(A,{className:"h-12 w-12 mb-2"}),e.jsx("p",{className:"text-lg",children:"No one inside currently"})]}):e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(N,{children:[e.jsx(v,{className:"pb-3",children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 text-xs font-medium",children:a.visitors.length}),"Visitors"]})}),e.jsx(w,{className:"space-y-2",children:a.visitors.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No visitors inside"}):a.visitors.map(s=>e.jsx(p,{entry:s},s.id))})]}),e.jsxs(N,{children:[e.jsx(v,{className:"pb-3",children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 text-xs font-medium",children:a.labours.length}),"Labours"]})}),e.jsx(w,{className:"space-y-2",children:a.labours.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No labours inside"}):a.labours.map(s=>e.jsx(p,{entry:s},s.id))})]})]})]})}export{ee as default};
