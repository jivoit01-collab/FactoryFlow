import{y as x,F as v,G as b,H as E,a as I,r as A,j as e,C as M,b as F,c as H,e as L}from"./index-BlttmsHz.js";import{u as R,a as U}from"./useMutation-TnQ6hR0R.js";import{S as G}from"./StepFooter-nTTeyMCN.js";import{S as Q}from"./StepHeader-C7ugY6Ck.js";import"./driver.schema-DO7pkEio.js";import"./vehicle.schema-Cw9NqPJ5.js";import{u as Y}from"./useEntryId-Cz9iv8zj.js";import{F as D}from"./file-text-CHubKTsl.js";const K=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],B=x("external-link",K);const O=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],V=x("paperclip",O);const X=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],z=x("upload",X),w={async getAll(t){const s=await v.get(b.GATE_ATTACHMENTS.BY_ENTRY(t));return Array.isArray(s.data)?s.data:[]},async upload(t,s){const r=new FormData;return r.append("file",s),(await v.post(b.GATE_ATTACHMENTS.BY_ENTRY(t),r,{headers:{"Content-Type":"multipart/form-data"}})).data}};function J(t){return R({queryKey:["gateAttachments",t],queryFn:()=>w.getAll(t),enabled:!!t})}function W(t){const s=E();return U({mutationFn:r=>w.upload(t,r),onSuccess:()=>{s.invalidateQueries({queryKey:["gateAttachments",t]})}})}const Z=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"];function ee(t){const s=t.toLowerCase();return Z.some(r=>s.includes(r))}function ce({config:t}){const s=I(),r=E(),{entryId:n,entryIdNumber:d,isEditMode:f}=Y(),c=A.useRef(null),C=t.totalSteps,g=`step${t.totalSteps-1}`,[S,y]=A.useState(null),{data:o,isLoading:T}=J(d),u=W(d||0),k=async l=>{const a=l.target.files;if(!(!a||a.length===0||!d)){y(null);for(const i of Array.from(a))try{await u.mutateAsync(i)}catch(m){y(m.message||`Failed to upload ${i.name}`)}c.current&&(c.current.value="")}},_=()=>{c.current?.click()},$=()=>{s(f&&n?`${t.routePrefix}/edit/${n}/${g}`:`${t.routePrefix}/new/${g}?entryId=${n}`)},P=()=>{r.invalidateQueries({queryKey:["vehicleEntries"]}),s(t.routePrefix)},q=()=>{s(f&&n?`${t.routePrefix}/edit/${n}/review`:`${t.routePrefix}/new/review?entryId=${n}`)};return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx(Q,{currentStep:C,totalSteps:t.totalSteps,title:t.headerTitle,error:S}),T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(M,{children:[e.jsx(F,{children:e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Attachments"]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed border-muted-foreground/25 p-8 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:_,children:[e.jsx(z,{className:"h-10 w-10 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Click to upload files"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Images, documents, and other files"})]}),u.isPending&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Uploading..."]})]}),e.jsx("input",{ref:c,type:"file",multiple:!0,className:"hidden",onChange:k}),o&&o.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:[o.length," attachment",o.length!==1?"s":""," uploaded"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:o.map(l=>{const a=l.file,i=l.file_name||a.split("/").pop()||"File",m=ee(a);return e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"group relative rounded-lg border bg-card overflow-hidden block hover:ring-2 hover:ring-primary/50 transition-all",children:[m?e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:a,alt:i,className:"h-full w-full object-cover",onError:N=>{const j=N.currentTarget;j.style.display="none";const p=j.parentElement;if(p){p.classList.add("flex","items-center","justify-center","bg-muted");const h=document.createElement("div");h.innerHTML="ðŸ“„",h.className="text-4xl",p.appendChild(h)}}})}):e.jsx("div",{className:"aspect-square flex items-center justify-center bg-muted",children:e.jsx(D,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsx("p",{className:"text-xs font-medium truncate flex-1",title:i,children:i}),e.jsx(B,{className:"h-3 w-3 shrink-0 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]})]},l.id)})})]}),(!o||o.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-2",children:"No attachments yet. Upload files or skip to continue."})]})})]})}),e.jsx(G,{onPrevious:$,onCancel:P,onNext:q,isSaving:u.isPending,nextLabel:"Review"})]})}export{ce as S};
