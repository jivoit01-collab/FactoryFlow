import{H as j,J as N,K as T,a as xe,r as h,j as t,k as X,C as J,b as be,c as ge,e as Z,L as m,I as x,M as v,P as ee,B as R,X as te,Q as ve}from"./index-DcDZk0Ze.js";import{A as fe}from"./status.constants-CIikCqTl.js";import{b as je}from"./validation.constants-C18ePHzl.js";import{i as Ne,a as Se,g as we,b as ie}from"./error-qMYEww3Q.js";import{u as Ce}from"./useScrollToError-DxuoU2J8.js";import{a as re}from"./useMutation-BN6FooZ9.js";import{u as Ae}from"./poReceipt.queries-XW4qAy5W.js";import{a as ke}from"./vehicleEntry.queries-CX2qplUl.js";import{F as ae}from"./FillDataAlert-zrU0MhJD.js";import{S as Oe}from"./StepFooter-DSr_Mu4e.js";import{S as Fe}from"./StepHeader-D7WzSZBO.js";import{S as $e}from"./StepLoadingSpinner-CTNjd-hl.js";import"./driver.schema-DZt_XaHY.js";import"./vehicle.schema-BmxwMEOL.js";import{W as qe}from"./wizard.constants-DfnuBX7K.js";import{u as Ie}from"./useEntryId-CLccz1rl.js";import{F as De}from"./file-text-rZJa_sVN.js";import{P as L}from"./paperclip-MOKApe6G.js";import{U as se}from"./upload-DMuHiIhW.js";import{C as Ee}from"./circle-alert-pYJT2wnS.js";import"./triangle-alert-By8DO8dc.js";import"./circle-x-BsDPaKe1.js";import"./circle-check-D4IQpWN7.js";import"./clock-BJCtD_-t.js";import"./arrow-left-Do7ni92_.js";import"./schemas-D8ebsZBL.js";const U={async get(d){try{return(await j.get(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_GET(d))).data}catch(o){if(o.status===404)return null;throw o}},async getById(d){return(await j.get(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_BY_ID(d))).data},async create(d,o){return(await j.post(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_CREATE(d),o)).data},async update(d,o){return(await j.post(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_CREATE(d),o)).data},async submit(d){const{slipId:o,certificateOfAnalysis:u,certificateOfQuantity:S}=d,b=new FormData;return u&&b.append("certificate_of_analysis",u),S&&b.append("certificate_of_quantity",S),(await j.post(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_SUBMIT(o),b,{headers:{"Content-Type":"multipart/form-data"}})).data},async list(d){return(await j.get(N.QUALITY_CONTROL_V2.ARRIVAL_SLIP_LIST,{params:d})).data}};function Re(){const d=T();return re({mutationFn:({poItemReceiptId:o,data:u})=>U.create(o,u),onSuccess:(o,{poItemReceiptId:u})=>{d.invalidateQueries({queryKey:["arrivalSlip",u]}),d.invalidateQueries({queryKey:["arrivalSlips"]}),d.invalidateQueries({queryKey:["gateEntryFullView"]})}})}function Le(){const d=T();return re({mutationFn:o=>U.submit(o),onSuccess:()=>{d.invalidateQueries({queryKey:["arrivalSlip"]}),d.invalidateQueries({queryKey:["arrivalSlips"]}),d.invalidateQueries({queryKey:["gateEntryFullView"]}),d.invalidateQueries({queryKey:["pendingInspections"]})}})}function ot(){const d=xe(),o=T(),{entryId:u,entryIdNumber:S,isEditMode:b}=Ie(),M=qe.STEPS.ARRIVAL_SLIP,{data:F=[],isLoading:V,error:w}=Ae(S||null),{data:Q,isLoading:le}=ke(S||null),B=Re(),K=Le(),[_,C]=h.useState([]),[c,g]=h.useState({});Ce(c);const[ne,ce]=h.useState(!1),[$,de]=h.useState(!1),[Y,H]=h.useState(!1),[oe,ue]=h.useState(!b),f=b&&!$;h.useEffect(()=>{if(F.length>0&&Q){const e=new Date().toISOString().slice(0,16),s=[];for(const i of F)for(const a of i.items)a.id&&s.push({id:a.id,po_item_code:a.po_item_code,item_name:a.item_name,ordered_qty:a.ordered_qty,received_qty:a.received_qty,uom:a.uom,supplier_name:i.supplier_name,po_number:i.po_number,existingSlip:null,isSubmitted:!1,slipId:null,certificateOfAnalysisFile:null,certificateOfQuantityFile:null,formData:{particulars:`${a.item_name}`,arrival_datetime:e,party_name:i.supplier_name,billing_qty:a.received_qty.toString(),billing_uom:a.uom,truck_no_as_per_bill:Q.vehicle?.vehicle_number||"",commercial_invoice_no:"",eway_bill_no:"",bilty_no:"",has_certificate_of_analysis:!0,has_certificate_of_quantity:!1,remarks:""}});C(s)}},[F,Q]),h.useEffect(()=>{(async()=>{if(_.length===0||!f)return;const s=[..._];let i=!1;for(let a=0;a<s.length;a++){const n=s[a];if(!n.existingSlip)try{const r=await U.get(n.id);r&&(s[a]={...n,existingSlip:r,isSubmitted:r.status===fe.SUBMITTED,slipId:r.id,formData:{particulars:r.particulars,arrival_datetime:r.arrival_datetime?.slice(0,16)||"",party_name:r.party_name,billing_qty:r.billing_qty,billing_uom:r.billing_uom,truck_no_as_per_bill:r.truck_no_as_per_bill,commercial_invoice_no:r.commercial_invoice_no||"",eway_bill_no:r.eway_bill_no||"",bilty_no:r.bilty_no||"",has_certificate_of_analysis:r.has_certificate_of_analysis,has_certificate_of_quantity:r.has_certificate_of_quantity,remarks:r.remarks||""}},i=!0)}catch{}}i?C(s):s.length>0&&H(!0),ue(!0)})()},[_.length,f]);const y=(e,s,i)=>{C(a=>a.map(n=>{if(n.id!==e)return n;const r={...n,formData:{...n.formData,[s]:i}};if(s==="has_certificate_of_analysis"&&i===!1){r.certificateOfAnalysisFile=null;const O=A.current[e];O&&(O.value="")}if(s==="has_certificate_of_quantity"&&i===!1){r.certificateOfQuantityFile=null;const O=k.current[e];O&&(O.value="")}return r})),c[`${e}_${s}`]&&g(a=>{const n={...a};return delete n[`${e}_${s}`],n})},A=h.useRef({}),k=h.useRef({}),q=h.useRef(new Map);h.useEffect(()=>{const e=q.current;return()=>{e.forEach(s=>URL.revokeObjectURL(s))}},[]);const I=e=>(q.current.has(e)||q.current.set(e,URL.createObjectURL(e)),q.current.get(e)),z=e=>{if(e.startsWith("http"))return e;try{return`${new URL(ve.apiBaseUrl).origin}${e}`}catch{return e}},pe=/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i,D=e=>pe.test(e),E=(e,s,i)=>{C(n=>n.map(r=>r.id===e?{...r,[s]:i}:r));const a=`${e}_${s}`;c[a]&&g(n=>{const r={...n};return delete r[a],r})},W=()=>{de(!0),H(!1),g({})},me=()=>{d(b&&u?`/gate/raw-materials/edit/${u}/step3`:`/gate/raw-materials/new/step3?entryId=${u}`)},_e=e=>{const s={};e.formData.particulars.trim()||(s[`${e.id}_particulars`]="Particulars is required"),e.formData.arrival_datetime||(s[`${e.id}_arrival_datetime`]="Arrival date/time is required"),e.formData.party_name.trim()||(s[`${e.id}_party_name`]="Party name is required"),(!e.formData.billing_qty||parseFloat(e.formData.billing_qty)<=0)&&(s[`${e.id}_billing_qty`]="Billing quantity is required"),e.formData.billing_uom.trim()||(s[`${e.id}_billing_uom`]="Billing UOM is required"),e.formData.truck_no_as_per_bill.trim()?je.vehicleNumber.test(e.formData.truck_no_as_per_bill.trim().toUpperCase())||(s[`${e.id}_truck_no_as_per_bill`]="Please enter a valid vehicle number (e.g., MH12AB1234)"):s[`${e.id}_truck_no_as_per_bill`]="Truck number is required";const i=e.existingSlip?.attachments?.some(n=>n.attachment_type.toLowerCase()==="certificate_of_analysis");!e.certificateOfAnalysisFile&&!i&&(s[`${e.id}_certificateOfAnalysisFile`]="Certificate of Analysis (COA) is required");const a=e.existingSlip?.attachments?.some(n=>n.attachment_type.toLowerCase()==="certificate_of_quantity");return e.formData.has_certificate_of_quantity&&!e.certificateOfQuantityFile&&!a&&(s[`${e.id}_certificateOfQuantityFile`]="Please upload Certificate of Quantity file"),s},he=async()=>{if(!u){g({general:"Entry ID is missing. Please go back to step 1."});return}if(f&&_.every(s=>s.isSubmitted)){d(`/gate/raw-materials/edit/${u}/step5`);return}let e={};for(const s of _)if(!s.isSubmitted){const i=_e(s);e={...e,...i}}if(Object.keys(e).length>0){g(e);return}g({});try{const s=[];for(const i of _)if(!i.isSubmitted)try{const a={particulars:i.formData.particulars,arrival_datetime:new Date(i.formData.arrival_datetime).toISOString(),weighing_required:!0,party_name:i.formData.party_name,billing_qty:parseFloat(i.formData.billing_qty),billing_uom:i.formData.billing_uom,truck_no_as_per_bill:i.formData.truck_no_as_per_bill,commercial_invoice_no:i.formData.commercial_invoice_no.trim()||"-",eway_bill_no:i.formData.eway_bill_no,bilty_no:i.formData.bilty_no,has_certificate_of_analysis:!0,has_certificate_of_quantity:i.formData.has_certificate_of_quantity,remarks:i.formData.remarks},n=await B.mutateAsync({poItemReceiptId:i.id,data:a});await K.mutateAsync({slipId:n.id,certificateOfAnalysis:i.certificateOfAnalysisFile||void 0,certificateOfQuantity:i.certificateOfQuantityFile||void 0}),s.push(i.id)}catch(a){throw s.length>0&&C(n=>n.map(r=>s.includes(r.id)?{...r,isSubmitted:!0}:r)),a}ce(!0),d(b?`/gate/raw-materials/edit/${u}/step5`:`/gate/raw-materials/new/step5?entryId=${u}`)}catch(s){const i=s;if(i.errors){const a={};Object.entries(i.errors).forEach(([n,r])=>{Array.isArray(r)&&r.length>0&&(a[n]=r[0])}),g(a)}else g({general:i.message||"Failed to save arrival slips"})}},P=Ne(w),ye=Se(w),G=f&&!V&&(F.length===0||P);if(V||le||f&&_.length>0&&!oe)return t.jsx($e,{});const p=B.isPending||K.isPending,l=Y&&!$;return t.jsxs("div",{className:"space-y-6 pb-6",children:[t.jsx(Fe,{currentStep:M,error:ye?we():c.general||(w&&!P?ie(w,"Failed to load PO receipts"):null)}),G&&!$&&t.jsx(ae,{message:P?ie(w,"PO receipts not found"):"No PO receipts found. Please go back to Step 3 to add PO receipts.",onFillData:W}),Y&&!$&&t.jsx(ae,{message:"Arrival slip not found",onFillData:W}),_.length>0&&_.every(e=>e.isSubmitted)&&t.jsxs("div",{className:"rounded-md bg-green-50 p-4 text-sm text-green-800 flex items-center gap-2",children:[t.jsx(X,{className:"h-5 w-5"}),"All arrival slips have been submitted to QA. Click Next to proceed to Weighment."]}),t.jsxs("div",{className:"space-y-6",children:[_.map((e,s)=>t.jsxs(J,{className:e.isSubmitted||l?"opacity-75":"",children:[t.jsxs(be,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(ge,{className:"flex items-center gap-2",children:[t.jsx(De,{className:"h-5 w-5"}),t.jsxs("span",{children:["Arrival Slip ",s+1,": ",e.item_name]})]}),e.isSubmitted&&t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[t.jsx(X,{className:"h-3 w-3"}),"Submitted"]})]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["PO: ",e.po_number," | Item Code: ",e.po_item_code," | Received Qty:"," ",e.received_qty," ",e.uom]})]}),t.jsx(Z,{children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`particulars-${e.id}`,children:["Particulars ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`particulars-${e.id}`,placeholder:"Material description",value:e.formData.particulars,onChange:i=>y(e.id,"particulars",i.target.value),disabled:e.isSubmitted||p||l,className:v(c[`${e.id}_particulars`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),c[`${e.id}_particulars`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_particulars`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`arrival_datetime-${e.id}`,children:["Arrival Date/Time ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`arrival_datetime-${e.id}`,type:"datetime-local",value:e.formData.arrival_datetime,onChange:i=>y(e.id,"arrival_datetime",i.target.value),disabled:e.isSubmitted||p||l,className:v(c[`${e.id}_arrival_datetime`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),c[`${e.id}_arrival_datetime`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_arrival_datetime`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`party_name-${e.id}`,children:["Party Name ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`party_name-${e.id}`,placeholder:"Supplier name",value:e.formData.party_name,onChange:i=>y(e.id,"party_name",i.target.value),disabled:e.isSubmitted||p||l,className:v(c[`${e.id}_party_name`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),c[`${e.id}_party_name`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_party_name`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`billing_qty-${e.id}`,children:["Billing Quantity ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`billing_qty-${e.id}`,type:"number",step:"0.001",min:"0",placeholder:"0",value:e.formData.billing_qty,onChange:i=>y(e.id,"billing_qty",i.target.value),disabled:e.isSubmitted||p||l,className:v(c[`${e.id}_billing_qty`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),c[`${e.id}_billing_qty`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_billing_qty`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`billing_uom-${e.id}`,children:["Billing UOM ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`billing_uom-${e.id}`,placeholder:"Pcs, Kg, etc.",value:e.formData.billing_uom,onChange:i=>y(e.id,"billing_uom",i.target.value),disabled:e.isSubmitted||p||l,className:v(c[`${e.id}_billing_uom`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),c[`${e.id}_billing_uom`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_billing_uom`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`truck_no_as_per_bill-${e.id}`,children:["Truck No. (as per Bill) ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`truck_no_as_per_bill-${e.id}`,placeholder:"MH12AB1234",value:e.formData.truck_no_as_per_bill,onChange:i=>{const a=i.target.value.toUpperCase().replace(/\s/g,"");y(e.id,"truck_no_as_per_bill",a)},disabled:e.isSubmitted||p||l,className:v(c[`${e.id}_truck_no_as_per_bill`]&&"border-destructive",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50")}),c[`${e.id}_truck_no_as_per_bill`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_truck_no_as_per_bill`]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:`commercial_invoice_no-${e.id}`,children:["Commercial Invoice No. ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:`commercial_invoice_no-${e.id}`,placeholder:"Invoice number (use - if not available)",value:e.formData.commercial_invoice_no,onChange:i=>y(e.id,"commercial_invoice_no",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:`eway_bill_no-${e.id}`,children:"E-way Bill No."}),t.jsx(x,{id:`eway_bill_no-${e.id}`,placeholder:"E-way bill number",value:e.formData.eway_bill_no,onChange:i=>y(e.id,"eway_bill_no",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:`bilty_no-${e.id}`,children:"Bilty No."}),t.jsx(x,{id:`bilty_no-${e.id}`,placeholder:"Bilty/LR number",value:e.formData.bilty_no,onChange:i=>y(e.id,"bilty_no",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-3",children:[t.jsx(m,{htmlFor:`remarks-${e.id}`,children:"Remarks"}),t.jsx(x,{id:`remarks-${e.id}`,placeholder:"Any additional remarks",value:e.formData.remarks,onChange:i=>y(e.id,"remarks",i.target.value),disabled:e.isSubmitted||p||l,className:e.isSubmitted||l?"cursor-not-allowed opacity-50":""})]}),t.jsxs("div",{className:"space-y-3 md:col-span-2 lg:col-span-3",children:[t.jsx(m,{className:"text-sm font-semibold",children:"Certifications"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"rounded-md border p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ee,{id:`has_certificate_of_analysis-${e.id}`,checked:!0,disabled:!0}),t.jsxs(m,{htmlFor:`has_certificate_of_analysis-${e.id}`,className:"text-sm font-medium",children:["Certificate of Analysis (COA) ",t.jsx("span",{className:"text-destructive",children:"*"})]})]}),t.jsxs("div",{className:"space-y-2",children:[e.certificateOfAnalysisFile?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:e.certificateOfAnalysisFile.name}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 shrink-0",onClick:()=>{E(e.id,"certificateOfAnalysisFile",null);const i=A.current[e.id];i&&(i.value="")},children:t.jsx(te,{className:"h-3.5 w-3.5"})})]}),D(e.certificateOfAnalysisFile.name)&&t.jsxs("a",{href:I(e.certificateOfAnalysisFile),target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:I(e.certificateOfAnalysisFile),alt:"COA preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]}):(()=>{const i=e.existingSlip?.attachments?.find(a=>a.attachment_type.toLowerCase()==="certificate_of_analysis");if(i){const a=z(i.file),n=i.file_name||i.file.split("/").pop()||"COA uploaded",r=D(n);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:n}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"outline",size:"sm",className:"h-7 text-xs shrink-0",onClick:()=>A.current[e.id]?.click(),children:"Replace"})]}),r&&t.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:a,alt:"COA preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]})}return t.jsxs("div",{className:v("flex items-center gap-3 rounded-md border-2 border-dashed px-3 py-3 cursor-pointer transition-colors",c[`${e.id}_certificateOfAnalysisFile`]?"border-destructive/50 hover:border-destructive":"border-muted-foreground/25 hover:border-primary/50",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50"),onClick:()=>{!e.isSubmitted&&!l&&A.current[e.id]?.click()},children:[t.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Click to upload COA file"})]})})(),t.jsx("input",{ref:i=>{A.current[e.id]=i},type:"file",accept:"image/*,.pdf",className:"hidden",onChange:i=>{const a=i.target.files?.[0]||null;E(e.id,"certificateOfAnalysisFile",a)},disabled:e.isSubmitted||p||l}),c[`${e.id}_certificateOfAnalysisFile`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_certificateOfAnalysisFile`]})]})]}),t.jsxs("div",{className:"rounded-md border p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ee,{id:`has_certificate_of_quantity-${e.id}`,checked:e.formData.has_certificate_of_quantity,onCheckedChange:i=>y(e.id,"has_certificate_of_quantity",i===!0),disabled:e.isSubmitted||p||l}),t.jsx(m,{htmlFor:`has_certificate_of_quantity-${e.id}`,className:"text-sm font-medium cursor-pointer",children:"Certificate of Quantity (COQ)"})]}),e.formData.has_certificate_of_quantity&&t.jsxs("div",{className:"space-y-2",children:[e.certificateOfQuantityFile?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:e.certificateOfQuantityFile.name}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 shrink-0",onClick:()=>{E(e.id,"certificateOfQuantityFile",null);const i=k.current[e.id];i&&(i.value="")},children:t.jsx(te,{className:"h-3.5 w-3.5"})})]}),D(e.certificateOfQuantityFile.name)&&t.jsxs("a",{href:I(e.certificateOfQuantityFile),target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:I(e.certificateOfQuantityFile),alt:"COQ preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]}):(()=>{const i=e.existingSlip?.attachments?.find(a=>a.attachment_type.toLowerCase()==="certificate_of_quantity");if(i){const a=z(i.file),n=i.file_name||i.file.split("/").pop()||"COQ uploaded",r=D(n);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2 text-sm",children:[t.jsx(L,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),t.jsx("span",{className:"truncate flex-1",children:n}),!e.isSubmitted&&!l&&t.jsx(R,{type:"button",variant:"outline",size:"sm",className:"h-7 text-xs shrink-0",onClick:()=>k.current[e.id]?.click(),children:"Replace"})]}),r&&t.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden rounded-md border block group",children:[t.jsx("img",{src:a,alt:"COQ preview",className:"w-full h-36 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center transition-colors",children:t.jsx("span",{className:"text-white text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to open"})})]})]})}return t.jsxs("div",{className:v("flex items-center gap-3 rounded-md border-2 border-dashed px-3 py-3 cursor-pointer transition-colors",c[`${e.id}_certificateOfQuantityFile`]?"border-destructive/50 hover:border-destructive":"border-muted-foreground/25 hover:border-primary/50",(e.isSubmitted||l)&&"cursor-not-allowed opacity-50"),onClick:()=>{!e.isSubmitted&&!l&&k.current[e.id]?.click()},children:[t.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Click to upload COQ file"})]})})(),t.jsx("input",{ref:i=>{k.current[e.id]=i},type:"file",accept:"image/*,.pdf",className:"hidden",onChange:i=>{const a=i.target.files?.[0]||null;E(e.id,"certificateOfQuantityFile",a)},disabled:e.isSubmitted||p||l}),c[`${e.id}_certificateOfQuantityFile`]&&t.jsx("p",{className:"text-sm text-destructive",children:c[`${e.id}_certificateOfQuantityFile`]})]})]})]})]})]})})]},e.id)),_.length===0&&!G&&t.jsx(J,{children:t.jsx(Z,{className:"py-8",children:t.jsxs("div",{className:"text-center text-muted-foreground",children:[t.jsx(Ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No PO item receipts found to create arrival slips."}),t.jsx("p",{className:"text-sm mt-2",children:"Please go back to Step 3 to add PO receipts first."})]})})})]}),t.jsx(Oe,{onPrevious:me,onCancel:()=>{o.invalidateQueries({queryKey:["vehicleEntries"]}),d("/gate/raw-materials")},onNext:he,showUpdate:!1,isSaving:p||ne,isEditMode:f,isUpdateMode:!1,nextLabel:_.every(e=>e.isSubmitted)?"Next":"Submit to QA and Continue"})]})}export{ot as default};
