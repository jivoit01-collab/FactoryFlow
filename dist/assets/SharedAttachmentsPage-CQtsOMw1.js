import{y as I,H as j,J as v,K as A,a as _,r as b,j as e,C as F,b as M,c as H,e as L}from"./index-DfliZ1OU.js";import{u as U,a as R}from"./useMutation-BW1s3MWF.js";import{S as G}from"./StepFooter-Dsx4NhZD.js";import{S as K}from"./StepHeader-CErtjsYJ.js";import"./driver.schema-DZt_XaHY.js";import"./vehicle.schema-BmxwMEOL.js";import{u as Q}from"./useEntryId-gLpAato9.js";import{P as Y,U as D}from"./upload-B5DX4_43.js";import{F as B}from"./file-text-Dt6VIQgo.js";const O=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],J=I("external-link",O),E={async getAll(t){const s=await j.get(v.GATE_ATTACHMENTS.BY_ENTRY(t));return Array.isArray(s.data)?s.data:[]},async upload(t,s){const r=new FormData;return r.append("file",s),(await j.post(v.GATE_ATTACHMENTS.BY_ENTRY(t),r,{headers:{"Content-Type":"multipart/form-data"}})).data}};function V(t){return U({queryKey:["gateAttachments",t],queryFn:()=>E.getAll(t),enabled:!!t})}function X(t){const s=A();return R({mutationFn:r=>E.upload(t,r),onSuccess:()=>{s.invalidateQueries({queryKey:["gateAttachments",t]})}})}const z=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"];function W(t){const s=t.toLowerCase();return z.some(r=>s.includes(r))}function le({config:t}){const s=_(),r=A(),{entryId:n,entryIdNumber:d,isEditMode:h}=Q(),c=b.useRef(null),w=t.totalSteps,f=`step${t.totalSteps-1}`,[C,g]=b.useState(null),{data:i,isLoading:S}=V(d),u=X(d||0),T=async l=>{const a=l.target.files;if(!(!a||a.length===0||!d)){g(null);for(const o of Array.from(a))try{await u.mutateAsync(o)}catch(m){g(m.message||`Failed to upload ${o.name}`)}c.current&&(c.current.value="")}},P=()=>{c.current?.click()},k=()=>{s(h&&n?`${t.routePrefix}/edit/${n}/${f}`:`${t.routePrefix}/new/${f}?entryId=${n}`)},$=()=>{r.invalidateQueries({queryKey:["vehicleEntries"]}),s(t.routePrefix)},q=()=>{s(h&&n?`${t.routePrefix}/edit/${n}/review`:`${t.routePrefix}/new/review?entryId=${n}`)};return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx(K,{currentStep:w,totalSteps:t.totalSteps,title:t.headerTitle,error:C}),S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(F,{children:[e.jsx(M,{children:e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Attachments"]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed border-muted-foreground/25 p-8 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:P,children:[e.jsx(D,{className:"h-10 w-10 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Click to upload files"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Images, documents, and other files"})]}),u.isPending&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Uploading..."]})]}),e.jsx("input",{ref:c,type:"file",multiple:!0,className:"hidden",onChange:T}),i&&i.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:[i.length," attachment",i.length!==1?"s":""," uploaded"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:i.map(l=>{const a=l.file,o=l.file_name||a.split("/").pop()||"File",m=W(a);return e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"group relative rounded-lg border bg-card overflow-hidden block hover:ring-2 hover:ring-primary/50 transition-all",children:[m?e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:a,alt:o,className:"h-full w-full object-cover",onError:y=>{const N=y.currentTarget;N.style.display="none";const p=N.parentElement;if(p){p.classList.add("flex","items-center","justify-center","bg-muted");const x=document.createElement("div");x.innerHTML="ðŸ“„",x.className="text-4xl",p.appendChild(x)}}})}):e.jsx("div",{className:"aspect-square flex items-center justify-center bg-muted",children:e.jsx(B,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsx("p",{className:"text-xs font-medium truncate flex-1",title:o,children:o}),e.jsx(J,{className:"h-3 w-3 shrink-0 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]})]},l.id)})})]}),(!i||i.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-2",children:"No attachments yet. Upload files or skip to continue."})]})})]})}),e.jsx(G,{onPrevious:k,onCancel:$,onNext:q,isSaving:u.isPending,nextLabel:"Review"})]})}export{le as S};
