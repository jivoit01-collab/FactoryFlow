import{y as W,H as _e,J as fe,K as $e,j as e,B as g,au as be,V as We,z as Ae,r as v,aw as f,a as Ye,W as ze,M as R,C as O,b as L,c as F,e as M,L as _,I as j,as as X}from"./index-JnW3N6op.js";import{F as G}from"./status.constants-CJWhPO2G.js";import{u as Je}from"./useScrollToError-Dzu4yKvT.js";import{u as Xe,a as Ze}from"./useMutation-C9YW0HdO.js";import{I as es,c as ss,d as as,e as ts,f as rs,g as ns,h as is,i as ls,j as cs}from"./inspection.queries-CO70SXgo.js";import{u as os,M as ds}from"./MaterialTypeSelect-C3SGJ3Ks.js";import{a as B,W as Z,F as ee}from"./qc.constants-BuQ5_X1j.js";import{A as je}from"./arrow-left-B-WnATuh.js";import{C as ms}from"./circle-alert-B3DHRK2z.js";import{F as se}from"./file-text-BNoGvln5.js";import{P as ge}from"./paperclip-DsDMIPP-.js";import{E as ve}from"./external-link-C3CPf2Qo.js";import{C as Ne}from"./circle-check-mtCX7JUS.js";import{C as ps}from"./circle-x-BVp7eNSX.js";import{S as us}from"./send-DDzRNFBa.js";import"./triangle-alert-W4uHi97g.js";import"./clock-BFV9p9F4.js";import"./SearchableSelect-COmPc9Hx.js";import"./plus-BEMEKndW.js";import"./materialType.queries-ZWzLYls-.js";import"./user-check-BJCK2R0w.js";const hs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],xs=W("pencil",hs);const _s=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],fs=W("printer",_s);const js=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],gs=W("save",js);const vs=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],ye=W("undo-2",vs),ke={async getById(n){return(await _e.get(fe.QUALITY_CONTROL_V2.ARRIVAL_SLIP_BY_ID(n))).data},async sendBack(n,h){return(await _e.post(fe.QUALITY_CONTROL_V2.ARRIVAL_SLIP_SEND_BACK(n),h||{})).data}},$={all:["qc-arrivalSlips"],detail:n=>[...$.all,"detail",n]};function Ns(n){return Xe({queryKey:$.detail(n),queryFn:()=>ke.getById(n),enabled:!!n})}function ys(){const n=$e();return Ze({mutationFn:({slipId:h,data:N})=>ke.sendBack(h,N),onSuccess:(h,{slipId:N})=>{n.invalidateQueries({queryKey:$.all}),n.invalidateQueries({queryKey:$.detail(N)}),n.invalidateQueries({queryKey:es.all})}})}const bs={chemist:{title:"Approved by QC Chemist",subtitle:"Inspection has been approved and forwarded to QC Manager"},manager:{title:"Approved by QC Manager",subtitle:"Quality control inspection is now complete"}};function As({type:n,onNavigateToDashboard:h,onNavigateToHome:N}){const y=bs[n];return e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background",children:[e.jsx("div",{className:"relative mb-8",children:e.jsxs("svg",{className:"h-32 w-32 text-green-500",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"animate-draw-circle",style:{strokeDasharray:283,strokeDashoffset:283}}),e.jsx("path",{d:"M30 50 L45 65 L70 35",fill:"none",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-draw-check",style:{strokeDasharray:60,strokeDashoffset:60}})]})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold text-foreground opacity-0 animate-fade-in-delay-1",children:y.title}),e.jsx("p",{className:"mb-12 text-muted-foreground opacity-0 animate-fade-in-delay-2",children:y.subtitle}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row opacity-0 animate-fade-in-delay-3",children:[e.jsxs(g,{size:"lg",onClick:h,className:"min-w-[200px]",children:[e.jsx(be,{className:"mr-2 h-5 w-5"}),"QC Dashboard"]}),e.jsxs(g,{size:"lg",variant:"outline",onClick:N,className:"min-w-[200px]",children:[e.jsx(We,{className:"mr-2 h-5 w-5"}),"Home"]})]})]})}function ks(n){const{hasAnyPermission:h}=Ae();return v.useMemo(()=>{const N=h([f.INSPECTION.CREATE]),y=h([f.INSPECTION.CREATE,f.INSPECTION.EDIT]),A=h([f.INSPECTION.SUBMIT]),S=h([f.APPROVAL.APPROVE_AS_CHEMIST]),V=h([f.APPROVAL.APPROVE_AS_QAM]),t=h([f.APPROVAL.REJECT,f.APPROVAL.APPROVE_AS_CHEMIST,f.APPROVAL.APPROVE_AS_QAM]),Q=!n||n.workflow_status===B.DRAFT,d=n?.workflow_status===B.SUBMITTED,H=n?.workflow_status===B.QA_CHEMIST_APPROVED,m=n?.is_locked??!1,D=n?.workflow_status===B.QAM_APPROVED||n?.workflow_status===B.REJECTED;return{canCreateInspection:N,canEditInspection:y,canSubmitInspection:A,canApproveAsChemist:S,canApproveAsQAM:V,canReject:t,showSaveButton:!m&&Q&&y,showSubmitButton:n&&Q&&!m&&A,showChemistApproval:d&&S,showQAMApproval:H&&V,showRejectButton:(d||H)&&t,canEditFields:!m&&Q&&y,isCompleted:D,isLocked:m}},[n,h])}function ws(){const{hasAnyPermission:n}=Ae();return v.useMemo(()=>({canCreate:n([f.ARRIVAL_SLIP.CREATE]),canEdit:n([f.ARRIVAL_SLIP.CREATE,f.ARRIVAL_SLIP.EDIT]),canSubmit:n([f.ARRIVAL_SLIP.SUBMIT]),canView:n([f.ARRIVAL_SLIP.VIEW]),canSendBack:n([f.ARRIVAL_SLIP.SEND_BACK])}),[n])}function Ws(){const n=Ye(),{slipId:h,inspectionId:N}=ze(),y=window.location.pathname.includes("/new"),A=h?parseInt(h):N?parseInt(N):null,[S,V]=v.useState(!1),{data:t,isLoading:Q}=ss(A),{data:d,isLoading:H}=Ns(A),[m,D]=v.useState({inspection_date:new Date().toISOString().split("T")[0],description_of_material:"",sap_code:"",supplier_name:"",manufacturer_name:"",supplier_batch_lot_no:"",unit_packing:"",purchase_order_no:"",internal_lot_no:"",invoice_bill_no:"",vehicle_no:"",material_type_id:0,remarks:""}),[U,ae]=v.useState({}),[q,we]=v.useState(""),[te,Ce]=v.useState(G.ACCEPTED),[k,o]=v.useState({}),[re,ne]=v.useState(null);Je(k);const{data:P=[]}=os(m.material_type_id||null),ie=as(),le=ts(),ce=rs(),oe=ns(),de=is(),me=ls(),pe=cs(),Y=ys(),[z,Ee]=v.useState("");v.useEffect(()=>{if(t){D({inspection_date:t.inspection_date,description_of_material:t.description_of_material,sap_code:t.sap_code,supplier_name:t.supplier_name,manufacturer_name:t.manufacturer_name,supplier_batch_lot_no:t.supplier_batch_lot_no,unit_packing:t.unit_packing,purchase_order_no:t.purchase_order_no,internal_lot_no:t.internal_lot_no,invoice_bill_no:t.invoice_bill_no,vehicle_no:t.vehicle_no,material_type_id:t.material_type,remarks:t.remarks});const s={};t.parameter_results?.forEach(a=>{s[a.parameter_master]={result_value:a.result_value,result_numeric:a.result_numeric||void 0,is_within_spec:a.is_within_spec??void 0,remarks:a.remarks}}),ae(s)}},[t]),v.useEffect(()=>{d&&!t&&y&&D(s=>({...s,description_of_material:d.item_name||s.description_of_material,sap_code:d.po_item_code||s.sap_code,supplier_name:d.party_name||s.supplier_name,unit_packing:d.billing_qty&&d.billing_uom?`${d.billing_qty} ${d.billing_uom}`:s.unit_packing,vehicle_no:d.truck_no_as_per_bill||s.vehicle_no,invoice_bill_no:d.commercial_invoice_no||s.invoice_bill_no,remarks:d.remarks||s.remarks}))},[d,t,y]);const b=(s,a)=>{D(i=>({...i,[s]:a})),k[s]&&o(i=>{const l={...i};return delete l[s],l})},E=(s,a,i)=>{ae(r=>({...r,[s]:{...r[s],result_value:r[s]?.result_value||"",remarks:r[s]?.remarks||"",[a]:i}}));const l=`param_${s}`;k[l]&&o(r=>{const x={...r};return delete x[l],x})},K=(s,a,i,l,r)=>{if(E(s,"result_value",a),i==="NUMERIC"||i==="RANGE"){const x=parseFloat(a);if(!isNaN(x)&&(E(s,"result_numeric",x),i==="RANGE"&&l!=null&&r!=null)){const T=typeof l=="string"?parseFloat(l):l,I=typeof r=="string"?parseFloat(r):r;!isNaN(T)&&!isNaN(I)&&E(s,"is_within_spec",x>=T&&x<=I)}}else i==="BOOLEAN"&&E(s,"is_within_spec",a==="Pass")},ue=s=>{switch(s){case"NUMERIC":return"Enter numeric value";case"RANGE":return"Enter numeric value";case"BOOLEAN":return"Select Pass or Fail";default:return"Enter text value"}},Se=async()=>{if(A)try{o({});const s={};m.material_type_id||(s.material_type_id="Please select a material type");const a=P.filter(l=>l.is_mandatory);for(const l of a)U[l.id]?.result_value?.trim()||(s[`param_${l.id}`]=`${l.parameter_name} result is required`);if(Object.keys(s).length>0){o(s);return}let i=t?.id;if(t?await le.mutateAsync({slipId:A,data:m}):i=(await ie.mutateAsync({slipId:A,data:m})).id,i&&Object.keys(U).length>0){const l=Object.entries(U).map(([r,x])=>({parameter_master_id:parseInt(r),result_value:x.result_value||"",result_numeric:x.result_numeric,is_within_spec:x.is_within_spec??!0,remarks:x.remarks||""}));await ce.mutateAsync({inspectionId:i,results:l})}V(!1)}catch(s){const a=s;if(a.errors){const i={};Object.entries(a.errors).forEach(([l,r])=>{i[l]=r[0]}),o(i)}else o({general:a.message||"Failed to save inspection"})}},Ie=async()=>{if(!t){o({general:"Please save the inspection first"});return}try{o({}),await oe.mutateAsync(t.id)}catch(s){const a=s;if(a.errors){const i={};Object.entries(a.errors).forEach(([l,r])=>{i[l]=r[0]}),o(i)}else o({general:a.message||"Failed to submit inspection"})}},Re=async()=>{if(t)try{o({}),await de.mutateAsync({id:t.id,data:{remarks:q}}),ne("chemist")}catch(s){const a=s;if(a.errors){const i={};Object.entries(a.errors).forEach(([l,r])=>{i[l]=r[0]}),o(i)}else o({general:a.message||"Failed to approve"})}},Pe=async()=>{if(t)try{o({}),await me.mutateAsync({id:t.id,data:{remarks:q,final_status:te}}),ne("manager")}catch(s){const a=s;if(a.errors){const i={};Object.entries(a.errors).forEach(([l,r])=>{i[l]=r[0]}),o(i)}else o({general:a.message||"Failed to approve"})}},Te=async()=>{if(t){if(!q.trim()){o({approval_remarks:"Please provide a reason for rejection"});return}try{o({}),await pe.mutateAsync({id:t.id,data:{remarks:q}})}catch(s){const a=s;if(a.errors){const i={};Object.entries(a.errors).forEach(([l,r])=>{i[l]=r[0]}),o(i)}else o({general:a.message||"Failed to reject"})}}},Oe=async()=>{if(A)try{o({}),await Y.mutateAsync({slipId:A,data:z.trim()?{remarks:z.trim()}:void 0}),n("/qc/pending")}catch(s){const a=s;if(a.errors){const i={};Object.entries(a.errors).forEach(([l,r])=>{i[l]=r[0]}),o(i)}else o({general:a.message||"Failed to send back arrival slip"})}},{canEditInspection:Le,showSubmitButton:Fe,showChemistApproval:Me,showQAMApproval:Be,showRejectButton:Ve,canEditFields:Qe,isLocked:De}=ks(t),{canSendBack:Ue}=ws(),qe=Ue&&d?.status==="SUBMITTED"&&!t&&y,Ge=!t||t.workflow_status===B.DRAFT,p=Qe&&(!t||S),He=t&&Ge&&Le&&!S&&!De,Ke=Fe&&!S,he=Me,J=Be,xe=Ve,c=ie.isPending||le.isPending||ce.isPending||oe.isPending||de.isPending||me.isPending||pe.isPending||Y.isPending;return re?e.jsx(As,{type:re,onNavigateToDashboard:()=>n("/qc"),onNavigateToHome:()=>n("/")}):Q||H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between print-no-break",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>n("/qc/pending"),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(be,{className:"h-8 w-8"}),y?"New Inspection":"Inspection Details"]})]}),t&&e.jsxs("div",{className:"flex items-center gap-4 ml-10",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Report No: ",t.report_no]}),e.jsx("span",{className:R("px-2 py-1 rounded-full text-xs font-medium",Z[t.workflow_status].bgColor,Z[t.workflow_status].color),children:Z[t.workflow_status].label}),t.final_status!==G.PENDING&&e.jsx("span",{className:R("px-2 py-1 rounded-full text-xs font-medium",ee[t.final_status].bgColor,ee[t.final_status].color),children:ee[t.final_status].label})]})]})}),k.general&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4"}),k.general]}),e.jsxs(O,{children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Inspection Information"]})}),e.jsx(M,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Description of Material"}),e.jsx(j,{value:m.description_of_material||"",onChange:s=>b("description_of_material",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"SAP Code"}),e.jsx(j,{value:m.sap_code||"",onChange:s=>b("sap_code",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Supplier Name"}),e.jsx(j,{value:m.supplier_name||"",onChange:s=>b("supplier_name",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Unit Packing"}),e.jsx(j,{value:m.unit_packing||"",onChange:s=>b("unit_packing",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Vehicle No."}),e.jsx(j,{value:m.vehicle_no||"",onChange:s=>b("vehicle_no",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Commercial Invoice No."}),e.jsx(j,{value:m.invoice_bill_no||"",onChange:s=>b("invoice_bill_no",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Inspection Date"}),e.jsx(j,{type:"date",value:m.inspection_date||"",onChange:s=>b("inspection_date",s.target.value),disabled:!p||c})]}),e.jsx(ds,{label:"Material Type",required:!0,value:m.material_type_id||void 0,onChange:s=>b("material_type_id",s?.id||0),disabled:!p||c||!!t,error:k.material_type_id}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Internal Lot No."}),e.jsx(j,{value:m.internal_lot_no||"",onChange:s=>b("internal_lot_no",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Supplier Batch/Lot No."}),e.jsx(j,{value:m.supplier_batch_lot_no||"",onChange:s=>b("supplier_batch_lot_no",s.target.value),disabled:!p||c})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-3",children:[e.jsx(_,{children:"Remarks"}),e.jsx(X,{value:m.remarks||"",onChange:s=>b("remarks",s.target.value),disabled:!p||c,rows:2})]})]})})]}),d&&d.attachments?.some(s=>s.attachment_type==="CERTIFICATE_OF_ANALYSIS")&&e.jsxs(O,{className:"print-page-break",children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Certificate of Analysis (COA)"]})}),e.jsx(M,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:d.attachments.filter(s=>s.attachment_type==="CERTIFICATE_OF_ANALYSIS").map(s=>{const a=/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i.test(s.file);return e.jsx("a",{href:s.file,target:"_blank",rel:"noopener noreferrer",className:"block border rounded-lg overflow-hidden hover:ring-2 hover:ring-primary transition-all",children:a?e.jsx("img",{src:s.file,alt:"Certificate of Analysis",className:"w-full print-attachment-img"}):e.jsxs("div",{className:"w-full h-48 flex flex-col items-center justify-center gap-2 bg-muted/30 text-muted-foreground",children:[e.jsx(se,{className:"h-8 w-8"}),e.jsx("span",{className:"text-xs",children:"View File"}),e.jsx(ve,{className:"h-3 w-3"})]})},s.id)})})})]}),d&&d.attachments?.some(s=>s.attachment_type==="CERTIFICATE_OF_QUANTITY")&&e.jsxs(O,{className:"print-page-break",children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Certificate of Quantity (COQ)"]})}),e.jsx(M,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:d.attachments.filter(s=>s.attachment_type==="CERTIFICATE_OF_QUANTITY").map(s=>{const a=/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i.test(s.file);return e.jsx("a",{href:s.file,target:"_blank",rel:"noopener noreferrer",className:"block border rounded-lg overflow-hidden hover:ring-2 hover:ring-primary transition-all",children:a?e.jsx("img",{src:s.file,alt:"Certificate of Quantity",className:"w-full print-attachment-img"}):e.jsxs("div",{className:"w-full h-48 flex flex-col items-center justify-center gap-2 bg-muted/30 text-muted-foreground",children:[e.jsx(se,{className:"h-8 w-8"}),e.jsx("span",{className:"text-xs",children:"View File"}),e.jsx(ve,{className:"h-3 w-3"})]})},s.id)})})})]}),((t?.parameter_results?.length??0)>0||P.length>0)&&e.jsxs(O,{children:[e.jsx(L,{children:e.jsx(F,{children:"QC Parameters"})}),e.jsxs(M,{children:[e.jsx("div",{className:"md:hidden space-y-4",children:(t?.parameter_results||P).map(s=>{const a="parameter_master"in s?s.parameter_master:s.id,i=s.parameter_name,l=s.standard_value,r=s.parameter_type,x=s.min_value,T=s.max_value,I="is_mandatory"in s?s.is_mandatory:P.find(u=>u.id===a)?.is_mandatory??!1,w=k[`param_${a}`],C=U[a]||{result_value:"",is_within_spec:!0,remarks:""};return e.jsxs("div",{className:R("border rounded-lg p-3 space-y-3",w&&"border-destructive"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-sm",children:[i,I&&e.jsx("span",{className:"text-destructive",children:" *"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:C.is_within_spec??!0,onChange:u=>E(a,"is_within_spec",u.target.checked),disabled:!p||c||r==="BOOLEAN"||r==="RANGE",className:"h-4 w-4 rounded border-gray-300"}),e.jsx("span",{className:"text-muted-foreground",children:"Within Spec"})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Standard: ",l]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(_,{className:"text-xs",children:["Result",I&&e.jsx("span",{className:"text-destructive",children:" *"})]}),r==="BOOLEAN"?e.jsxs("select",{value:C.result_value,onChange:u=>K(a,u.target.value,r),disabled:!p||c,className:R("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",w&&"border-destructive"),children:[e.jsx("option",{value:"",children:"Select Pass or Fail"}),e.jsx("option",{value:"Pass",children:"Pass"}),e.jsx("option",{value:"Fail",children:"Fail"})]}):e.jsx(j,{type:r==="NUMERIC"||r==="RANGE"?"number":"text",step:r==="NUMERIC"||r==="RANGE"?"any":void 0,value:C.result_value,onChange:u=>K(a,u.target.value,r,x,T),disabled:!p||c,className:R("w-full",w&&"border-destructive"),placeholder:ue(r)}),w&&e.jsx("p",{className:"text-xs text-destructive",children:w})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs",children:"Remarks"}),e.jsx(j,{value:C.remarks,onChange:u=>E(a,"remarks",u.target.value),disabled:!p||c,className:"w-full",placeholder:"Optional"})]})]},a)})}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Parameter"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Standard Value"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Result"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Within Spec"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Remarks"})]})}),e.jsx("tbody",{children:(t?.parameter_results||P).map(s=>{const a="parameter_master"in s?s.parameter_master:s.id,i=s.parameter_name,l=s.standard_value,r=s.parameter_type,x=s.min_value,T=s.max_value,I="is_mandatory"in s?s.is_mandatory:P.find(u=>u.id===a)?.is_mandatory??!1,w=k[`param_${a}`],C=U[a]||{result_value:"",is_within_spec:!0,remarks:""};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium",children:[i,I&&e.jsx("span",{className:"text-destructive",children:" *"})]})}),e.jsx("td",{className:"p-3 text-muted-foreground",children:l}),e.jsxs("td",{className:"p-3",children:[r==="BOOLEAN"?e.jsxs("select",{value:C.result_value,onChange:u=>K(a,u.target.value,r),disabled:!p||c,className:R("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",w&&"border-destructive"),children:[e.jsx("option",{value:"",children:"Select Pass or Fail"}),e.jsx("option",{value:"Pass",children:"Pass"}),e.jsx("option",{value:"Fail",children:"Fail"})]}):e.jsx(j,{type:r==="NUMERIC"||r==="RANGE"?"number":"text",step:r==="NUMERIC"||r==="RANGE"?"any":void 0,value:C.result_value,onChange:u=>K(a,u.target.value,r,x,T),disabled:!p||c,className:R("w-full",w&&"border-destructive"),placeholder:ue(r)}),w&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:w})]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",checked:C.is_within_spec??!0,onChange:u=>E(a,"is_within_spec",u.target.checked),disabled:!p||c||r==="BOOLEAN"||r==="RANGE",className:"h-4 w-4 rounded border-gray-300"})}),e.jsx("td",{className:"p-3",children:e.jsx(j,{value:C.remarks,onChange:u=>E(a,"remarks",u.target.value),disabled:!p||c,className:"w-full",placeholder:"Optional"})})]},a)})})]})})]})]}),(he||J||xe)&&e.jsxs(O,{className:"border-primary/50",children:[e.jsx(L,{children:e.jsx(F,{children:"Approval"})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Remarks"}),e.jsx(X,{value:q,onChange:s=>we(s.target.value),placeholder:"Enter approval/rejection remarks",rows:3}),k.approval_remarks&&e.jsx("p",{className:"text-sm text-destructive",children:k.approval_remarks})]}),J&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Final Status"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:te,onChange:s=>Ce(s.target.value),children:[e.jsx("option",{value:G.ACCEPTED,children:"Accepted"}),e.jsx("option",{value:G.REJECTED,children:"Rejected"}),e.jsx("option",{value:G.HOLD,children:"Hold"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[he&&e.jsxs(g,{onClick:Re,disabled:c,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Approve as Chemist"]}),J&&e.jsxs(g,{onClick:Pe,disabled:c,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Approve as Manager"]}),xe&&e.jsxs(g,{variant:"destructive",onClick:Te,disabled:c,children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})]}),qe&&e.jsxs(O,{className:"border-orange-500/50",children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2 text-orange-700 dark:text-orange-400",children:[e.jsx(ye,{className:"h-5 w-5"}),"Send Back to Gate"]})}),e.jsxs(M,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send this arrival slip back to the gate person for correction. They will be notified and can edit and resubmit the slip."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Remarks (optional)"}),e.jsx(X,{value:z,onChange:s=>Ee(s.target.value),placeholder:"Explain what needs to be corrected...",rows:3})]}),e.jsxs(g,{variant:"outline",className:"border-orange-500 text-orange-700 hover:bg-orange-50 dark:text-orange-400 dark:hover:bg-orange-950",onClick:Oe,disabled:c,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),Y.isPending?"Sending Back...":"Send Back to Gate"]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-between print-hide",children:[e.jsxs(g,{variant:"outline",onClick:()=>n("/qc/pending"),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex gap-4",children:[t&&e.jsxs(g,{variant:"outline",onClick:()=>window.print(),children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Print"]}),He&&e.jsxs(g,{variant:"outline",onClick:()=>V(!0),children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Update"]}),p&&e.jsxs(g,{onClick:Se,disabled:c,children:[e.jsx(gs,{className:"h-4 w-4 mr-2"}),c?"Saving...":"Save"]}),Ke&&!S&&e.jsxs(g,{onClick:Ie,disabled:c,children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Submit for Approval"]})]})]})]})}export{Ws as default};
