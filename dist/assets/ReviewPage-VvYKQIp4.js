import{H as L,J as A,K as Q,a as ee,r as g,j as e,B as n,C as d,b as x,c as h,e as m,L as r,T as se,U as te,V as re,M as ae}from"./index-Dt2C4nB0.js";import{E as k,F as N}from"./status.constants-DbtYTm7V.js";import{a as F,g as ie,b as ce}from"./error-qMYEww3Q.js";import{u as le}from"./useScrollToError-DSpt8KQW.js";import{u as ne,a as de}from"./useMutation-CDDQmGrZ.js";import{s as P}from"./securityCheck.api-DzRqne0n.js";import{u as me}from"./useEntryId-Cr_tC90i.js";import{C as q}from"./circle-alert-BZMTPmrZ.js";import{A as I}from"./arrow-left-Cj_jRa_X.js";import{F as R}from"./file-check-CrnXXSl3.js";import{C as oe}from"./clock-D8_7Klbq.js";import{S as M}from"./shield-check-BB9R6lNT.js";import{S as xe}from"./scale-DJvtCiip.js";import{P as V}from"./package-Clc_8uBy.js";import{C as y}from"./circle-check-BQRHLbFZ.js";import{C as he}from"./circle-x-CH15e8_Z.js";import"./triangle-alert-DNT4m7gu.js";const K={async get(t){return(await L.get(A.GATE_CORE.FULL_VIEW(t))).data},async complete(t){await L.post(A.GATE_CORE.COMPLETE(t))}};function ue(t){return ne({queryKey:["gateEntryFullView",t],queryFn:()=>K.get(t),enabled:!!t})}function ge(){const t=Q();return de({mutationFn:i=>K.complete(i),onSuccess:()=>{t.invalidateQueries({queryKey:["gateEntryFullView"]}),t.invalidateQueries({queryKey:["vehicleEntries"]}),t.invalidateQueries({queryKey:["grpo","pending"]})}})}function O({status:t}){const i=()=>{switch(t.toUpperCase()){case k.COMPLETED:return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case k.DRAFT:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400";case"PASSED":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";case"FAILED":case N.REJECTED:case"QC REJECTED":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";case N.PENDING:case N.HOLD:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400";case N.ACCEPTED:case"QC ACCEPTED":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400"}};return e.jsx("span",{className:ae("px-2 py-1 rounded-full text-xs font-medium",i()),children:t})}function j({value:t}){return t?e.jsx(y,{className:"h-5 w-5 text-green-500"}):e.jsx(he,{className:"h-5 w-5 text-red-500"})}function je({onNavigateToDashboard:t,onNavigateToHome:i}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background",children:[e.jsx("div",{className:"relative mb-8",children:e.jsxs("svg",{className:"h-32 w-32 text-green-500",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"animate-draw-circle",style:{strokeDasharray:283,strokeDashoffset:283}}),e.jsx("path",{d:"M30 50 L45 65 L70 35",fill:"none",stroke:"currentColor",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-draw-check",style:{strokeDasharray:60,strokeDashoffset:60}})]})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold text-foreground opacity-0 animate-fade-in-delay-1",children:"Entry Completed!"}),e.jsx("p",{className:"mb-12 text-muted-foreground opacity-0 animate-fade-in-delay-2",children:"Gate entry has been successfully completed"}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row opacity-0 animate-fade-in-delay-3",children:[e.jsxs(n,{size:"lg",onClick:t,className:"min-w-[200px]",children:[e.jsx(V,{className:"mr-2 h-5 w-5"}),"Raw Material Dashboard"]}),e.jsxs(n,{size:"lg",variant:"outline",onClick:i,className:"min-w-[200px]",children:[e.jsx(re,{className:"mr-2 h-5 w-5"}),"Home"]})]})]})}function Pe(){const t=ee(),i=Q(),{entryId:o,entryIdNumber:p,isEditMode:G}=me(),[C,f]=g.useState(!1),[_,E]=g.useState(!1),[W,B]=g.useState(!1),[S,H]=g.useState(!1),v=()=>{i.invalidateQueries({queryKey:["vehicleEntries"]}),i.invalidateQueries({queryKey:["gateEntryFullView"]}),t("/gate/raw-materials")},U=()=>{i.invalidateQueries({queryKey:["vehicleEntries"]}),i.invalidateQueries({queryKey:["gateEntryFullView"]}),t("/")},[b,l]=g.useState({});le(b);const{data:s,isLoading:J,error:T}=ue(p),$=ge(),D=()=>{t(G&&o?`/gate/raw-materials/edit/${o}/attachments`:`/gate/raw-materials/new/attachments?entryId=${o}`)},z=async()=>{if(!o){l({general:"Entry ID is missing."});return}l({}),f(!0);try{const a=await P.get(p);if(!a.id){l({general:"Security check data not found. Please complete security check first."}),f(!1);return}await P.submit(a.id),H(!0),i.invalidateQueries({queryKey:["gateEntryFullView",p]})}catch(a){const u=a,c=u.message||u.detail||"Failed to submit security check";l({general:c})}finally{f(!1)}},Y=async()=>{if(!o){l({general:"Entry ID is missing."});return}l({}),E(!0);try{await $.mutateAsync(p),B(!0)}catch(a){F(a)?l({general:"Cannot complete the entry at the moment. Please try again later."}):l({general:ce(a,"Failed to complete gate entry")})}finally{E(!1)}},X=a=>new Date(a).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});if(W)return e.jsx(je,{onNavigateToDashboard:v,onNavigateToHome:U});if(J)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})});if(T){const a=F(T)?ie():"Failed to load gate entry details. Please try again.";return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"rounded-md bg-destructive/15 p-4 text-sm text-destructive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:a})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(n,{type:"button",variant:"outline",onClick:D,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Previous"]})})]})}if(!s)return null;const w=s.gate_entry.status===k.COMPLETED;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(R,{className:"h-8 w-8"}),"Final Review"]}),e.jsx("p",{className:"text-muted-foreground",children:"Review all details before completing the gate entry"})]}),b.general&&e.jsxs("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),b.general]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Gate Entry Information"]}),e.jsx(O,{status:s.gate_entry.status})]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Entry Number"}),e.jsx("p",{className:"font-medium",children:s.gate_entry.entry_no})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Created At"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}),X(s.gate_entry.created_at)]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Locked"}),e.jsx("p",{className:"font-medium",children:s.gate_entry.is_locked?"Yes":"No"})]})]})})]}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Vehicle Details"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Vehicle Number"}),e.jsx("p",{className:"font-medium",children:s.vehicle.vehicle_number})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Vehicle Type"}),e.jsx("p",{className:"font-medium",children:s.vehicle.vehicle_type.name})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Capacity"}),e.jsxs("p",{className:"font-medium",children:[s.vehicle.capacity_ton," Tons"]})]})]})})]}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Driver Details"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Driver Name"}),e.jsx("p",{className:"font-medium",children:s.driver.name})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Mobile Number"}),e.jsx("p",{className:"font-medium",children:s.driver.mobile_no})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"License Number"}),e.jsx("p",{className:"font-medium",children:s.driver.license_no})]})]})})]}),s.security_check&&e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Security Check"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.vehicle_condition_ok}),e.jsx("span",{className:"text-sm",children:"Vehicle Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.tyre_condition_ok}),e.jsx("span",{className:"text-sm",children:"Tyre Condition OK"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.fire_extinguisher_available}),e.jsx("span",{className:"text-sm",children:"Fire Extinguisher Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.alcohol_test_done}),e.jsx("span",{className:"text-sm",children:"Alcohol Test Done"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.security_check.alcohol_test_passed}),e.jsx("span",{className:"text-sm",children:"Alcohol Test Passed"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Inspected By"}),e.jsx("p",{className:"font-medium",children:s.security_check.inspected_by})]})]}),s.security_check.remarks&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Remarks"}),e.jsx("p",{className:"text-sm",children:s.security_check.remarks})]})]})]}),s.weighment&&e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Weighment Details"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Gross Weight"}),e.jsx("p",{className:"font-medium text-lg",children:s.weighment.gross_weight!=null?`${s.weighment.gross_weight.toLocaleString()} kg`:"—"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Tare Weight"}),e.jsx("p",{className:"font-medium text-lg",children:s.weighment.tare_weight!=null?`${s.weighment.tare_weight.toLocaleString()} kg`:"—"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Net Weight"}),e.jsx("p",{className:"font-medium text-lg text-primary",children:s.weighment.net_weight!=null?`${s.weighment.net_weight.toLocaleString()} kg`:"—"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Weighbridge Slip No."}),e.jsx("p",{className:"font-medium",children:s.weighment.weighbridge_slip_no||"—"})]})]})})]}),s.po_receipts.length>0&&e.jsxs(d,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Purchase Order Receipts"]})}),e.jsx(m,{className:"space-y-6",children:s.po_receipts.map((a,u)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"PO Number"}),e.jsx("p",{className:"font-medium",children:a.po_number})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Supplier Code"}),e.jsx("p",{className:"font-medium",children:a.supplier_code})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Supplier Name"}),e.jsx("p",{className:"font-medium",children:a.supplier_name})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground text-xs",children:"Created By"}),e.jsx("p",{className:"font-medium",children:a.created_by})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-2",children:"Item"}),e.jsx("th",{className:"text-right p-2",children:"Ordered"}),e.jsx("th",{className:"text-right p-2",children:"Received"}),e.jsx("th",{className:"text-right p-2",children:"Remaining"}),e.jsx("th",{className:"text-center p-2",children:"UOM"}),e.jsx("th",{className:"text-center p-2 min-w-[120px]",children:"QC Status"})]})}),e.jsx("tbody",{children:a.items.map((c,Z)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:c.item_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c.item_code})]})}),e.jsx("td",{className:"text-right p-2",children:c.ordered_qty.toLocaleString()}),e.jsx("td",{className:"text-right p-2",children:c.received_qty.toLocaleString()}),e.jsx("td",{className:"text-right p-2",children:c.short_qty>0?c.short_qty.toLocaleString():"0"}),e.jsx("td",{className:"text-center p-2",children:c.uom}),e.jsx("td",{className:"text-center p-2",children:c.qc_status?e.jsx(O,{status:c.qc_status.display}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})})]},Z))})]})})]},u))})]}),!w&&e.jsx(d,{className:"border-primary/50",children:e.jsx(m,{className:"pt-6",children:s.security_check?.is_submitted||S?e.jsxs("div",{className:"flex items-center gap-3 text-green-600 dark:text-green-400",children:[e.jsx(y,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Security check submitted. Ready to complete entry."})]}):e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-base font-medium",children:"Security Inspection Pending"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Submit security check to proceed with completing the entry"})]})})})})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-4 sm:flex-row sm:justify-between",children:[e.jsxs(n,{type:"button",variant:"outline",onClick:D,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Previous"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:v,children:"Cancel"}),!w&&e.jsx(e.Fragment,{children:!s?.security_check?.is_submitted&&!S?e.jsxs(n,{type:"button",onClick:z,disabled:C,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),C?"Submitting...":"Submit Security"]}):e.jsxs(n,{type:"button",onClick:Y,disabled:_,children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),_?"Completing...":"Complete Entry"]})}),w&&e.jsxs(n,{type:"button",onClick:v,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Entry Completed"]})]})]})]})}export{Pe as default};
