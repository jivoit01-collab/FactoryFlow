import{a as D,E as R,r as f,F as E,j as e,B as a,I}from"./index-DfliZ1OU.js";import{D as T}from"./DateRangePicker-B12SU7Ow.js";import"./driver.schema-DZt_XaHY.js";import"./vehicle.schema-BmxwMEOL.js";import{b as P}from"./inspection.queries-BqD9FJvW.js";import{W as N}from"./qc.constants-CybBlgGQ.js";import{A as L}from"./arrow-left-C_yHQVur.js";import{R as g,S as O}from"./shield-x-Blar3H8O.js";import{S as F}from"./search-CUCXSdgn.js";import{C as B}from"./circle-alert-BrmK50Th.js";import"./validation.constants-C18ePHzl.js";import"./schemas-D8ebsZBL.js";import"./useMutation-BW1s3MWF.js";import"./circle-x-BWFndibb.js";import"./circle-check-BJLvV6uA.js";import"./user-check-CPop6-5F.js";import"./send-DpuB9V4d.js";import"./file-text-Dt6VIQgo.js";import"./clock-T0iSBFYK.js";const c={all:{label:"All",title:"All Inspections",description:"All inspections"},actionable:{label:"Actionable",title:"Pending Actions",description:"Items requiring attention"},pending:{label:"Pending",title:"Pending Inspections",description:"Arrival slips awaiting QC inspection"},draft:{label:"Draft",title:"Draft Inspections",description:"Inspections started but not submitted"},approved:{label:"Approved",title:"Approved Inspections",description:"Completed and approved inspections"},rejected:{label:"Rejected",title:"Rejected Inspections",description:"Rejected inspections"}},z=Object.keys(c),G={NOT_STARTED:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",DRAFT:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",SUBMITTED:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",QA_CHEMIST_APPROVED:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",QAM_APPROVED:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",REJECTED:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"};function M(r){return r.inspection_id?`/qc/inspections/${r.arrival_slip_id}`:`/qc/inspections/${r.arrival_slip_id}/new`}function ie(){const r=D(),[v,b]=R(),[l,y]=f.useState(""),{dateRange:m,dateRangeAsDateObjects:_,setDateRange:j}=E(),k=f.useMemo(()=>({from_date:m.from,to_date:m.to}),[m]),x=v.get("status")||"all",n=c[x]||c.all,{data:i=[],isLoading:u,error:o,refetch:p}=P(x,k),d=f.useMemo(()=>{if(!l.trim())return i;const t=l.toLowerCase();return i.filter(s=>s.entry_no?.toLowerCase().includes(t)||s.report_no?.toLowerCase().includes(t)||s.internal_lot_no?.toLowerCase().includes(t)||N[s.workflow_status]?.label?.toLowerCase().includes(t))},[i,l]),h=o,w=h?.status===403,C=t=>{b(t==="all"?{}:{status:t})},A=t=>{if(!t)return"-";try{return new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(a,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>r("/qc"),children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:n.title})]}),e.jsx("p",{className:"text-muted-foreground",children:n.description})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsx(T,{date:_,onDateChange:t=>{t&&"from"in t?j(t):j(void 0)}}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>p(),className:"w-full sm:w-auto",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(I,{placeholder:"Search by entry no., report no., lot no., or status...",value:l,onChange:t=>y(t.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:z.map(t=>e.jsx(a,{variant:x===t?"default":"outline",size:"sm",className:"h-8",onClick:()=>C(t),children:c[t].label},t))}),w&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-destructive/50 bg-destructive/5",children:[e.jsx(O,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permission Denied"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:h?.message||"You do not have permission to view pending inspections."})]}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>p(),children:e.jsx(g,{className:"h-4 w-4"})})]}),o&&!w&&e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border border-yellow-500/50 bg-yellow-50 dark:bg-yellow-900/10",children:[e.jsx(B,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-400",children:"Failed to Load"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:h?.message||"An error occurred while loading inspections."})]}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>p(),children:e.jsx(g,{className:"h-4 w-4"})})]}),u&&e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}),!u&&!o&&d.length===0&&e.jsx("div",{className:"flex items-center justify-center h-24 text-sm text-muted-foreground border rounded-lg",children:i.length===0?`No ${n.label.toLowerCase()} inspections`:"No inspections match your search"}),!u&&!o&&d.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:[n.label," (",d.length,")"]})}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-w-full",children:e.jsxs("table",{className:"w-full min-w-[700px]",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Gate Entry No."}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Report No."}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Internal Lot No."}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Date/Time"})]})}),e.jsx("tbody",{children:d.map(t=>{const s=N[t.workflow_status],S=G[t.workflow_status]||"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";return e.jsxs("tr",{className:"border-t hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>r(M(t)),children:[e.jsx("td",{className:"p-3 text-sm font-medium",children:t.entry_no||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.report_no||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.internal_lot_no||"-"}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${S}`,children:s?.label||t.workflow_status})}),e.jsx("td",{className:"p-3 text-sm text-muted-foreground",children:A(t.submitted_at||t.created_at)})]},t.arrival_slip_id)})})]})})})]})]})}export{ie as default};
