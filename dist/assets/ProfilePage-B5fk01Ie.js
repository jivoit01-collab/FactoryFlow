import{r as h,j as s,D as I,m as T,n as F,o as U,p as B,L as _,I as S,q as R,B as f,f as H,t as M,u as V,a as q,C as P,b as G,v as J,w as W,e as E,c as D,S as Y,i as $,x as z,R as K}from"./index-DqK2RTI7.js";import{B as N}from"./badge-DJwXceDW.js";import{u as Q,a as X}from"./zod-nOE27hPp.js";import{u as Z}from"./useScrollToError-CrWAoRb7.js";import{V as u,a as l}from"./validation.constants-C18ePHzl.js";import{o as ss,s as A}from"./schemas-D8ebsZBL.js";import{E as L}from"./eye-off-sd_Tjijr.js";import{E as O}from"./eye-BGVdqDw0.js";const es=ss({old_password:A().min(1,u.required("Current password")).min(l.password.min,u.minLength("Current password",l.password.min)).max(l.password.max,u.maxLength("Current password",l.password.max)),new_password:A().min(1,u.required("New password")).min(l.password.min,u.minLength("New password",l.password.min)).max(l.password.max,u.maxLength("New password",l.password.max))}).refine(e=>e.old_password!==e.new_password,{message:"New password must be different from current password",path:["new_password"]}),as={old_password:"",new_password:""};function rs({open:e,onOpenChange:r}){const[a,o]=h.useState(!1),[g,i]=h.useState(null),[n,d]=h.useState(!1),[x,b]=h.useState(!1),[p,t]=h.useState(!1),{register:c,handleSubmit:j,formState:{errors:w},reset:y}=Q({resolver:X(es),defaultValues:as});Z(w);const k=async C=>{o(!0),i(null),d(!1);try{await H.changePassword(C.old_password,C.new_password),d(!0),setTimeout(()=>{y(),d(!1),r(!1)},2e3)}catch(m){m&&typeof m=="object"&&"message"in m&&"status"in m||m instanceof Error?i(m.message):i("Failed to change password. Please try again.")}finally{o(!1)}},v=()=>{a||(y(),i(null),d(!1),r(!1))};return s.jsx(I,{open:e,onOpenChange:v,children:s.jsxs(T,{className:"sm:max-w-[425px]",children:[s.jsxs(F,{children:[s.jsx(U,{children:"Change Password"}),s.jsx(B,{children:"Enter your current password and choose a new password to update your account."})]}),s.jsxs("form",{onSubmit:j(k),className:"space-y-4",children:[g&&s.jsx("div",{className:"rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive",children:g}),n&&s.jsx("div",{className:"rounded-md border border-green-500/50 bg-green-500/10 p-3 text-sm text-green-600 dark:text-green-400",children:"Password changed successfully!"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(_,{htmlFor:"old_password",children:"Current Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(S,{id:"old_password",type:x?"text":"password",placeholder:"Enter your current password",...c("old_password"),disabled:a||n,className:"pr-10"}),s.jsx("button",{type:"button",onClick:()=>b(!x),disabled:a||n,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":x?"Hide password":"Show password",children:x?s.jsx(L,{className:"h-4 w-4"}):s.jsx(O,{className:"h-4 w-4"})})]}),w.old_password&&s.jsx("p",{className:"text-sm text-destructive",children:w.old_password.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(_,{htmlFor:"new_password",children:"New Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(S,{id:"new_password",type:p?"text":"password",placeholder:"Enter your new password",...c("new_password"),disabled:a||n,className:"pr-10"}),s.jsx("button",{type:"button",onClick:()=>t(!p),disabled:a||n,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":p?"Hide password":"Show password",children:p?s.jsx(L,{className:"h-4 w-4"}):s.jsx(O,{className:"h-4 w-4"})})]}),w.new_password&&s.jsx("p",{className:"text-sm text-destructive",children:w.new_password.message})]}),s.jsxs(R,{children:[s.jsx(f,{type:"button",variant:"outline",onClick:v,disabled:a,children:"Cancel"}),s.jsx(f,{type:"submit",disabled:a||n,children:a?"Changing...":n?"Success!":"Change Password"})]})]})]})})}function ts(e,r){if(e){const a=e.trim().split(/\s+/);return a.length>=2?(a[0][0]+a[a.length-1][0]).toUpperCase():e.substring(0,2).toUpperCase()}return r?r.substring(0,2).toUpperCase():"U"}function os(e){try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return e}}function ns(e){const r={};return e.forEach(a=>{const[o]=a.split(".");r[o]||(r[o]=[]),r[o].push(a)}),r}function ls(e){return e.split(".").slice(1).join(".").split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}function fs(){const{user:e,permissions:r,logout:a,currentCompany:o}=M(),g=V(),i=q(),[n,d]=h.useState(!1);if(!e)return s.jsx("div",{className:"flex h-screen items-center justify-center",children:s.jsx("p",{className:"text-muted-foreground",children:"Loading user data..."})});const x=ns(r),b=ts(e.full_name,e.email),p=async()=>{try{await $.updateCurrentCompany(null),g(z()),i(K.COMPANY_SELECTION.path,{replace:!0})}catch(t){console.error("Failed to change company:",t)}};return s.jsxs("div",{className:"container mx-auto max-w-4xl p-4 sm:p-6",children:[s.jsxs(P,{children:[s.jsx(G,{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[s.jsxs("div",{className:"flex flex-col items-center gap-4 sm:flex-row sm:items-start sm:gap-6",children:[s.jsx(J,{className:"h-20 w-20 border-2 sm:h-24 sm:w-24",children:s.jsx(W,{className:"text-xl font-bold sm:text-2xl",children:b})}),s.jsxs("div",{className:"flex w-full flex-col gap-2 text-center sm:w-auto sm:text-left",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs text-muted-foreground sm:text-sm",children:"employee_code"}),s.jsx("p",{className:"text-sm font-medium break-words sm:text-base",children:e.employee_code||"N/A"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs text-muted-foreground sm:text-sm",children:"employee name"}),s.jsx("p",{className:"text-sm font-medium break-words sm:text-base",children:e.full_name})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs text-muted-foreground sm:text-sm",children:"email"}),s.jsx("p",{className:"text-sm font-medium break-words sm:text-base",children:e.email})]}),s.jsxs("div",{className:"flex flex-wrap justify-center gap-2 pt-2 sm:justify-start",children:[e.is_active&&s.jsx(N,{variant:"outline",className:"border-green-500 text-green-500 text-xs",children:"Active"}),e.is_staff&&s.jsx(N,{variant:"outline",className:"border-blue-500 text-blue-500 text-xs",children:"Staff"})]}),s.jsxs("div",{className:"space-y-1 pt-2",children:[s.jsx("p",{className:"text-xs text-muted-foreground sm:text-sm",children:"Joined On:"}),s.jsx("p",{className:"text-sm font-medium break-words sm:text-base",children:os(e.date_joined)})]})]})]}),s.jsxs("div",{className:"flex w-full flex-col gap-2 sm:w-auto",children:[s.jsx(f,{variant:"outline",onClick:()=>d(!0),className:"w-full sm:w-auto",children:"Change Password"}),o&&s.jsx(f,{variant:"outline",onClick:p,className:"w-full sm:w-auto",children:"Change Company"}),s.jsx(f,{variant:"outline",onClick:a,className:"w-full border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground sm:w-auto",children:"Logout"})]})]})}),s.jsxs(E,{className:"space-y-6 p-4 sm:p-6",children:[s.jsxs("div",{children:[s.jsx(D,{className:"mb-4 text-lg sm:text-xl",children:"Roles"}),s.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-4 lg:grid-cols-3",children:e.companies.map(t=>{const c=o?.company_id===t.company_id;return s.jsxs(P,{className:`border relative ${c?"border-primary border-2 bg-primary/5 ring-2 ring-primary/20":""}`,children:[c&&s.jsx(N,{className:"absolute -top-2 -right-2 bg-primary text-primary-foreground text-[10px] px-1.5 py-0.5",children:"Current"}),s.jsxs(E,{className:"flex flex-col items-center justify-center p-3 text-center sm:p-4",children:[s.jsx("p",{className:"text-base font-semibold sm:text-lg",children:t.role}),s.jsx("p",{className:"text-xs text-muted-foreground sm:text-sm break-words",children:t.company_name})]})]},t.company_id)})})]}),s.jsx(Y,{}),s.jsxs("div",{children:[s.jsx(D,{className:"mb-4 text-lg sm:text-xl",children:"Permissions"}),s.jsx("div",{className:"space-y-4 sm:space-y-6",children:Object.entries(x).map(([t,c])=>s.jsxs("div",{children:[s.jsx("h3",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground sm:mb-3 sm:text-sm",children:t}),s.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(j=>s.jsx(N,{variant:"outline",className:"px-2 py-1 text-xs sm:px-3 sm:py-1",children:ls(j)},j))})]},t))})]})]})]}),s.jsx(rs,{open:n,onOpenChange:d})]})}export{fs as default};
