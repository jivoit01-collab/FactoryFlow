import{a as k,r as u,j as e,B as p,at as F,C as N,e as y,L as i,b as O,c as L,D as I,m as Q,n as R,o as B,I as m,N as U,q as V}from"./index-Dm3Xfjnt.js";import{u as z}from"./useScrollToError-uCbWP-L8.js";import{u as G,a as H,b as X,c as W,M as Y}from"./MaterialTypeSelect-BadZ-Cga.js";import{P as E}from"./qc.constants-BchmX-Kf.js";import{A as $}from"./arrow-left-RhgS-m-T.js";import{P as J}from"./plus-dJ8NaNTB.js";import{S as K}from"./square-pen-CM41InDf.js";import{T as Z}from"./trash-2-CovTIHgP.js";import{C as ee}from"./circle-alert-CkjslOaL.js";import"./useMutation-C59p_qU8.js";import"./SearchableSelect-kktrv1CU.js";import"./materialType.queries-DTWaJOtO.js";import"./circle-x-gTIzRI_j.js";import"./circle-check-4K5RQOA0.js";import"./user-check-DTF_egBE.js";import"./send-DUKN0Er9.js";import"./file-text-BURbwi2j.js";import"./clock-xVG4dxTu.js";function fe(){const q=k(),[n,T]=u.useState(null),{data:o=[],isLoading:w}=G(n),[A,_]=u.useState(!1),[x,v]=u.useState(null),[t,r]=u.useState({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:1,is_mandatory:!0}),[d,c]=u.useState({}),[j,g]=u.useState("");z(d);const C=H(),b=X(),P=W(),S=a=>{if(a)v(a),r({parameter_code:a.parameter_code,parameter_name:a.parameter_name,standard_value:a.standard_value,parameter_type:a.parameter_type,min_value:a.min_value||void 0,max_value:a.max_value||void 0,uom:a.uom,sequence:a.sequence,is_mandatory:a.is_mandatory});else{v(null);const s=o.length>0?Math.max(...o.map(h=>h.sequence))+1:1;r({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:s,is_mandatory:!0})}c({}),g(""),_(!0)},f=()=>{_(!1),v(null),r({parameter_code:"",parameter_name:"",standard_value:"",parameter_type:"TEXT",uom:"",sequence:1,is_mandatory:!0}),c({}),g("")},M=async()=>{if(!n&&!x){c({general:"Please select a material type first"});return}if(!t.parameter_code.trim()){c({parameter_code:"Code is required"});return}if(!t.parameter_name.trim()){c({parameter_name:"Name is required"});return}if(o.find(s=>s.sequence===t.sequence&&s.id!==x?.id)){g(`Sequence ${t.sequence} is already in use.`);return}try{c({}),x?await b.mutateAsync({id:x.id,data:t}):await C.mutateAsync({materialTypeId:n,data:t}),f()}catch(s){c({general:s.message||"Failed to save parameter"})}},D=async a=>{if(confirm("Are you sure you want to delete this parameter?"))try{await P.mutateAsync(a)}catch(s){alert(s.message||"Failed to delete parameter")}},l=C.isPending||b.isPending;return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>q("/qc"),children:e.jsx($,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(F,{className:"h-8 w-8"}),"QC Parameters"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Configure inspection parameters for each material type"})]})}),e.jsx(N,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{className:"min-w-fit",children:"Material Type:"}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx(Y,{value:n||void 0,onChange:a=>T(a?a.id:null),placeholder:"Select Material Type"})}),n&&e.jsxs(p,{onClick:()=>S(),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Parameter"]})]})})}),n&&e.jsxs(N,{children:[e.jsx(O,{children:e.jsxs(L,{children:["Parameters (",o.length,")"]})}),e.jsx(y,{children:w?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):o.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:'No parameters found. Click "Add Parameter" to create one.'}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"#"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Code"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Standard Value"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"UOM"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Mandatory"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(a=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-3",children:a.sequence}),e.jsx("td",{className:"p-3 font-medium",children:a.parameter_code}),e.jsx("td",{className:"p-3",children:a.parameter_name}),e.jsx("td",{className:"p-3",children:a.standard_value}),e.jsx("td",{className:"p-3 text-muted-foreground",children:E[a.parameter_type]}),e.jsx("td",{className:"p-3",children:a.uom||"-"}),e.jsx("td",{className:"p-3 text-center",children:a.is_mandatory?"Yes":"No"}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>S(a),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>D(a.id),disabled:P.isPending,children:e.jsx(Z,{className:"h-4 w-4"})})]})})]},a.id))})]})})})]}),!n&&e.jsx(N,{children:e.jsx(y,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(ee,{className:"h-12 w-12 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Select a Material Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a material type above to view and manage its QC parameters."})]})]})})}),e.jsx(I,{open:A,onOpenChange:a=>{a||f()},children:e.jsxs(Q,{className:"max-w-lg",children:[e.jsx(R,{children:e.jsx(B,{children:x?"Edit Parameter":"Add Parameter"})}),d.general&&e.jsx("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:d.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Code"}),e.jsx(m,{value:t.parameter_code,onChange:a=>{const s=a.target.value.toUpperCase().replace(/\s/g,"");r(h=>({...h,parameter_code:s}))},placeholder:"e.g., WEIGHT",disabled:l}),d.parameter_code&&e.jsx("p",{className:"text-sm text-destructive",children:d.parameter_code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Sequence"}),e.jsx(m,{type:"number",value:t.sequence,onChange:a=>{r(s=>({...s,sequence:parseInt(a.target.value)||1})),j&&g("")},disabled:l,className:j?"border-destructive focus-visible:ring-destructive":""}),j&&e.jsx("p",{className:"text-sm text-destructive",children:j})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Name"}),e.jsx(m,{value:t.parameter_name,onChange:a=>r(s=>({...s,parameter_name:a.target.value})),placeholder:"e.g., Weight",disabled:l}),d.parameter_name&&e.jsx("p",{className:"text-sm text-destructive",children:d.parameter_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Standard Value"}),e.jsx(m,{value:t.standard_value,onChange:a=>r(s=>({...s,standard_value:a.target.value})),placeholder:t.parameter_type==="NUMERIC"?"e.g., 1.35":t.parameter_type==="BOOLEAN"?"e.g., Pass / Fail":t.parameter_type==="RANGE"?"e.g., 1.25 â€“ 1.45":"e.g., Smooth finish",disabled:l})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Type"}),e.jsx("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:t.parameter_type,onChange:a=>r(s=>({...s,parameter_type:a.target.value})),disabled:l,children:Object.entries(E).map(([a,s])=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"UOM"}),e.jsx(m,{value:t.uom,onChange:a=>r(s=>({...s,uom:a.target.value})),placeholder:"e.g., grams",disabled:l})]})]}),t.parameter_type==="RANGE"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Min Value"}),e.jsx(m,{type:"number",step:"0.0001",value:t.min_value||"",onChange:a=>r(s=>({...s,min_value:a.target.value?parseFloat(a.target.value):void 0})),disabled:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Max Value"}),e.jsx(m,{type:"number",step:"0.0001",value:t.max_value||"",onChange:a=>r(s=>({...s,max_value:a.target.value?parseFloat(a.target.value):void 0})),disabled:l})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"is_mandatory",checked:t.is_mandatory,onCheckedChange:a=>r(s=>({...s,is_mandatory:a===!0})),disabled:l}),e.jsx(i,{htmlFor:"is_mandatory",className:"font-normal cursor-pointer",children:"Mandatory parameter"})]})]}),e.jsxs(V,{children:[e.jsx(p,{variant:"outline",onClick:f,disabled:l,children:"Cancel"}),e.jsx(p,{onClick:M,disabled:l,children:l?"Saving...":"Save"})]})]})})]})}export{fe as default};
