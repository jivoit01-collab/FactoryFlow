import{y as A,F as j,G as v,H as C,a as k,r as b,j as e,C as q,b as M,c as H,e as L}from"./index-DpV7uZj9.js";import{u as R,a as U}from"./useMutation-DX1k4_5x.js";import{S as G}from"./StepFooter-Co2gSIL4.js";import{S as Q}from"./StepHeader-BqU45Fsk.js";import"./driver.schema-DO7pkEio.js";import"./vehicle.schema-Cw9NqPJ5.js";import{u as Y}from"./useEntryId-UySKIzZ0.js";import{F as D}from"./file-text-BP5l3tk-.js";const K=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],B=A("paperclip",K);const O=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],X=A("upload",O),E={async getAll(t){const s=await j.get(v.GATE_ATTACHMENTS.BY_ENTRY(t));return Array.isArray(s.data)?s.data:[]},async upload(t,s){const r=new FormData;return r.append("file",s),(await j.post(v.GATE_ATTACHMENTS.BY_ENTRY(t),r,{headers:{"Content-Type":"multipart/form-data"}})).data}};function z(t){return R({queryKey:["gateAttachments",t],queryFn:()=>E.getAll(t),enabled:!!t})}function J(t){const s=C();return U({mutationFn:r=>E.upload(t,r),onSuccess:()=>{s.invalidateQueries({queryKey:["gateAttachments",t]})}})}const V=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"];function W(t){const s=t.toLowerCase();return V.some(r=>s.includes(r))}function le({config:t}){const s=k(),r=C(),{entryId:a,entryIdNumber:d,isEditMode:h}=Y(),c=b.useRef(null),S=t.totalSteps,f=`step${t.totalSteps-1}`,[w,g]=b.useState(null),{data:n,isLoading:T}=z(d),u=J(d||0),P=async o=>{const i=o.target.files;if(!(!i||i.length===0||!d)){g(null);for(const l of Array.from(i))try{await u.mutateAsync(l)}catch(m){g(m.message||`Failed to upload ${l.name}`)}c.current&&(c.current.value="")}},$=()=>{c.current?.click()},I=()=>{s(h&&a?`${t.routePrefix}/edit/${a}/${f}`:`${t.routePrefix}/new/${f}?entryId=${a}`)},_=()=>{r.invalidateQueries({queryKey:["vehicleEntries"]}),s(t.routePrefix)},F=()=>{s(h&&a?`${t.routePrefix}/edit/${a}/review`:`${t.routePrefix}/new/review?entryId=${a}`)};return e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx(Q,{currentStep:S,totalSteps:t.totalSteps,title:t.headerTitle,error:w}),T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(q,{children:[e.jsx(M,{children:e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Attachments"]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed border-muted-foreground/25 p-8 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:$,children:[e.jsx(X,{className:"h-10 w-10 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Click to upload files"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Images, documents, and other files"})]}),u.isPending&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Uploading..."]})]}),e.jsx("input",{ref:c,type:"file",multiple:!0,className:"hidden",onChange:P}),n&&n.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:[n.length," attachment",n.length!==1?"s":""," uploaded"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:n.map(o=>{const i=o.file,l=o.file_name||i.split("/").pop()||"File",m=W(i);return e.jsxs("div",{className:"group relative rounded-lg border bg-card overflow-hidden",children:[m?e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:i,alt:l,className:"h-full w-full object-cover",onError:y=>{const N=y.currentTarget;N.style.display="none";const p=N.parentElement;if(p){p.classList.add("flex","items-center","justify-center","bg-muted");const x=document.createElement("div");x.innerHTML="ðŸ“„",x.className="text-4xl",p.appendChild(x)}}})}):e.jsx("div",{className:"aspect-square flex items-center justify-center bg-muted",children:e.jsx(D,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx("div",{className:"p-2",children:e.jsx("p",{className:"text-xs font-medium truncate",title:l,children:l})})]},o.id)})})]}),(!n||n.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-2",children:"No attachments yet. Upload files or skip to continue."})]})})]})}),e.jsx(G,{onPrevious:I,onCancel:_,onNext:F,isSaving:u.isPending,nextLabel:"Review"})]})}export{le as S};
