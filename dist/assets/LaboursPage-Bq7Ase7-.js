import{a as z,r as n,j as e,B as c,I as o,C as O,b as B,c as R,e as U,L as d,M as V}from"./index-DcDZk0Ze.js";import{b as H}from"./validation.constants-C18ePHzl.js";import{u as X}from"./useScrollToError-DxuoU2J8.js";import{g as G,j as J,e as K,q as Q,r as W}from"./personGateIn.queries-6WOKRFQk.js";import{C as y}from"./ContractorSelect-C5VABFOt.js";import"./driver.schema-DZt_XaHY.js";import"./vehicle.schema-BmxwMEOL.js";import{A as Y}from"./arrow-left-Do7ni92_.js";import{P as Z}from"./plus-CZjyi12_.js";import{S as $}from"./search-BuDSPJxu.js";import{C as ee}from"./circle-check-D4IQpWN7.js";import{C as te}from"./circle-x-BsDPaKe1.js";import{P as se}from"./pen-BOiCZmKC.js";import{T as ae}from"./trash-2--I4afkt_.js";import"./useMutation-BN6FooZ9.js";import"./SearchableSelect-8Ls5hP1n.js";import"./schemas-D8ebsZBL.js";function be(){const k=z(),[m,L]=n.useState(""),[f,S]=n.useState(void 0),[A,h]=n.useState(!1),[u,b]=n.useState(null),[a,r]=n.useState({name:"",contractor:0,mobile:"",id_proof_no:"",skill_type:"",permit_valid_till:"",is_active:!0}),[i,p]=n.useState({});X(i);const{data:P=[],isLoading:E,refetch:_}=G(m,f),{data:T=[]}=J(),j=K(),v=Q(),C=W(),w=P.filter(t=>t.name.toLowerCase().includes(m.toLowerCase())||t.mobile?.toLowerCase().includes(m.toLowerCase())||t.skill_type?.toLowerCase().includes(m.toLowerCase())),g=()=>{r({name:"",contractor:0,mobile:"",id_proof_no:"",skill_type:"",permit_valid_till:"",is_active:!0}),b(null),p({})},F=t=>{b(t),r({name:t.name,contractor:t.contractor,mobile:t.mobile||"",id_proof_no:t.id_proof_no||"",skill_type:t.skill_type||"",permit_valid_till:t.permit_valid_till||"",is_active:t.is_active}),h(!0)},M=async()=>{const t={};if(a.name.trim()||(t.name="Name is required"),a.contractor||(t.contractor="Contractor is required"),a.mobile?.trim()&&!H.phone.test(a.mobile.trim())&&(t.mobile="Please enter a valid 10-digit phone number"),Object.keys(t).length>0){p(t);return}try{u?await v.mutateAsync({id:u.id,data:a}):await j.mutateAsync(a),h(!1),g(),_()}catch(s){const l=s;if(l.errors){const x={};Object.entries(l.errors).forEach(([q,N])=>{Array.isArray(N)&&N.length>0&&(x[q]=N[0])}),p(x)}}},D=async t=>{if(window.confirm("Are you sure you want to delete this labour?"))try{await C.mutateAsync(t),_()}catch(s){console.error("Failed to delete:",s)}},I=t=>T.find(l=>l.id===t)?.contractor_name||"-";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>k("/gate/visitor-labour"),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Labours"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage labour records"})]})]}),e.jsxs(c,{onClick:()=>{g(),h(!0)},children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Add Labour"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx($,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Search labours...",value:m,onChange:t=>L(t.target.value),className:"pl-10"})]}),e.jsx("div",{className:"w-64",children:e.jsx(y,{value:f?String(f):void 0,onChange:t=>{S(t||void 0)},placeholder:"All Contractors",activeOnly:!1})})]}),A&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs(O,{className:"w-full max-w-md mx-4",children:[e.jsx(B,{children:e.jsx(R,{children:u?"Edit Labour":"Add Labour"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Name *"}),e.jsx(o,{value:a.name,onChange:t=>r(s=>({...s,name:t.target.value})),placeholder:"Enter name",className:"mt-1"}),i.name&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:i.name})]}),e.jsx("div",{children:e.jsx(y,{value:a.contractor?String(a.contractor):void 0,onChange:t=>{r(s=>({...s,contractor:t}))},label:"Contractor",required:!0,error:i.contractor})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Mobile"}),e.jsx(o,{value:a.mobile||"",onChange:t=>{const s=t.target.value.replace(/[^0-9]/g,"").slice(0,10);r(l=>({...l,mobile:s})),i.mobile&&p(l=>{const x={...l};return delete x.mobile,x})},placeholder:"9876543210",maxLength:10,className:V("mt-1",i.mobile&&"border-destructive")}),i.mobile&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:i.mobile})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Skill Type"}),e.jsx(o,{value:a.skill_type||"",onChange:t=>r(s=>({...s,skill_type:t.target.value})),placeholder:"e.g., Mason",className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"ID Proof No"}),e.jsx(o,{value:a.id_proof_no||"",onChange:t=>r(s=>({...s,id_proof_no:t.target.value})),placeholder:"ID number",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Permit Valid Till"}),e.jsx(o,{type:"date",value:a.permit_valid_till||"",onChange:t=>r(s=>({...s,permit_valid_till:t.target.value})),className:"mt-1"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:a.is_active,onChange:t=>r(s=>({...s,is_active:t.target.checked})),className:"rounded"}),e.jsx(d,{htmlFor:"is_active",className:"text-sm font-normal",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{h(!1),g()},className:"flex-1",children:"Cancel"}),e.jsx(c,{onClick:M,disabled:j.isPending||v.isPending,className:"flex-1",children:j.isPending||v.isPending?"Saving...":u?"Update":"Add"})]})]})]})}),E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):w.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground rounded-md border",children:e.jsx("p",{className:"text-lg",children:"No labours found"})}):e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[700px]",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Name"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Contractor"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Mobile"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Skill"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Permit Till"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-right text-sm font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:w.map(t=>e.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[e.jsx("td",{className:"p-3 text-sm font-medium",children:t.name}),e.jsx("td",{className:"p-3 text-sm",children:t.contractor_name||I(t.contractor)}),e.jsx("td",{className:"p-3 text-sm",children:t.mobile||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.skill_type||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.permit_valid_till||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.is_active?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(ee,{className:"h-3 w-3"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600 dark:text-red-400",children:[e.jsx(te,{className:"h-3 w-3"}),"Inactive"]})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>F(t),children:e.jsx(se,{className:"h-3 w-3"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>D(t.id),disabled:C.isPending,children:e.jsx(ae,{className:"h-3 w-3 text-red-500"})})]})})]},t.id))})]})})})]})}export{be as default};
